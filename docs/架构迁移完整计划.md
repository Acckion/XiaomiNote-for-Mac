# MiNote macOS æ¶æ„è¿ç§»å®Œæ•´è®¡åˆ’

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**ç›®æ ‡**: å°†ç°æœ‰ä»£ç ä»å•ä¾‹æ¨¡å¼å®Œå…¨è¿ç§»åˆ°ä¾èµ–æ³¨å…¥æ¶æ„  
**é¢„è®¡æ—¶é—´**: 6-8 å‘¨  
**é£é™©ç­‰çº§**: ä¸­ç­‰  
**å›æ»šç­–ç•¥**: æ¯ä¸ªé˜¶æ®µéƒ½å¯ç‹¬ç«‹å›æ»š

---

## ğŸ¯ è¿ç§»ç›®æ ‡

### å½“å‰çŠ¶æ€
- âŒ 45+ ä¸ªå•ä¾‹æ¨¡å¼
- âŒ NotesViewModel ä¸Šå¸å¯¹è±¡ (4,530 è¡Œ)
- âŒ ç´§è€¦åˆ,éš¾ä»¥æµ‹è¯•
- âŒ éšè—ä¾èµ–

### ç›®æ ‡çŠ¶æ€
- âœ… ä¾èµ–æ³¨å…¥æ¶æ„
- âœ… æ¨¡å—åŒ– ViewModel (æ¯ä¸ª < 500 è¡Œ)
- âœ… æ¾è€¦åˆ,æ˜“äºæµ‹è¯•
- âœ… æ˜¾å¼ä¾èµ–

---

## ğŸ“Š è¿ç§»èŒƒå›´åˆ†æ

### éœ€è¦è¿ç§»çš„å•ä¾‹ (45 ä¸ª)

#### 1. æ ¸å¿ƒæœåŠ¡ (8 ä¸ª) - ä¼˜å…ˆçº§: ğŸ”´ æœ€é«˜

- [ ] `MiNoteService.shared` â†’ `NoteServiceProtocol`
- [ ] `DatabaseService.shared` â†’ `NoteStorageProtocol`
- [ ] `SyncService.shared` â†’ `SyncServiceProtocol`
- [ ] `NetworkMonitor.shared` â†’ `NetworkMonitorProtocol`
- [ ] `MemoryCacheManager.shared` â†’ `CacheServiceProtocol`
- [ ] `AudioPlayerService.shared` â†’ `AudioServiceProtocol`
- [ ] `AudioRecorderService.shared` â†’ `AudioServiceProtocol`
- [ ] `ImageCacheService.shared` â†’ `ImageServiceProtocol`

#### 2. çŠ¶æ€ç®¡ç†å™¨ (9 ä¸ª) - ä¼˜å…ˆçº§: ğŸŸ¡ é«˜
- [ ] `AppStateManager.shared`
- [ ] `ViewStateCoordinator.shared`
- [ ] `ViewOptionsManager.shared`
- [ ] `AuthenticationStateManager.shared`
- [ ] `OnlineStateManager.shared`
- [ ] `SaveQueueManager.shared`
- [ ] `AudioPanelStateManager.shared`
- [ ] `ToolbarVisibilityManager.shared`
- [ ] `WindowManager.shared`

#### 3. æ“ä½œé˜Ÿåˆ— (5 ä¸ª) - ä¼˜å…ˆçº§: ğŸŸ¡ é«˜
- [ ] `UnifiedOperationQueue.shared`
- [ ] `OperationProcessor.shared`
- [ ] `OfflineOperationQueue.shared`
- [ ] `OfflineOperationProcessor.shared`
- [ ] `NoteOperationCoordinator.shared`

#### 4. è¾…åŠ©æœåŠ¡ (12 ä¸ª) - ä¼˜å…ˆçº§: ğŸŸ¢ ä¸­

- [ ] `LocalStorageService.shared`
- [ ] `NetworkRequestManager.shared`
- [ ] `NetworkLogger.shared`
- [ ] `NetworkErrorHandler.shared`
- [ ] `NetworkRecoveryHandler.shared`
- [ ] `ErrorRecoveryService.shared`
- [ ] `StartupSequenceManager.shared`
- [ ] `ScheduledTaskManager.shared`
- [ ] `SilentCookieRefreshManager.shared`
- [ ] `PrivateNotesPasswordManager.shared`
- [ ] `IdMappingRegistry.shared`
- [ ] `SyncGuard.shared`

#### 5. ç¼–è¾‘å™¨ç›¸å…³ (6 ä¸ª) - ä¼˜å…ˆçº§: ğŸŸ¢ ä¸­
- [ ] `EditorPreferencesService.shared`
- [ ] `XiaoMiFormatConverter.shared`
- [ ] `XMLNormalizer.shared`
- [ ] `TitleExtractionService.shared`
- [ ] `ImageStorageManager.shared`
- [ ] `FormatManager.shared`

#### 6. å…¶ä»– (5 ä¸ª) - ä¼˜å…ˆçº§: ğŸ”µ ä½
- [ ] `MenuManager.shared`
- [ ] `MenuActionHandler.shared`
- [ ] `NoteMoveHelper.shared`
- [ ] `AudioUploadService.shared`
- [ ] `AudioCacheService.shared`

### éœ€è¦æ‹†åˆ†çš„å¤§å‹ç±»

#### NotesViewModel (4,530 è¡Œ) â†’ æ‹†åˆ†ä¸º 7 ä¸ª ViewModel

- [ ] NoteListViewModel (300-400 è¡Œ) - åˆ—è¡¨å±•ç¤º
- [ ] NoteEditorViewModel (400-500 è¡Œ) - ç¼–è¾‘åŠŸèƒ½
- [ ] SyncCoordinator (300-400 è¡Œ) - åŒæ­¥åè°ƒ
- [ ] AuthenticationViewModel (200-300 è¡Œ) - è®¤è¯çŠ¶æ€
- [ ] SearchViewModel (200-300 è¡Œ) - æœç´¢åŠŸèƒ½
- [ ] FolderViewModel (200-300 è¡Œ) - æ–‡ä»¶å¤¹ç®¡ç†
- [ ] AudioPanelViewModel (200-300 è¡Œ) - éŸ³é¢‘åŠŸèƒ½

---

## ğŸ—“ï¸ è¿ç§»é˜¶æ®µè§„åˆ’

### Phase 7.1: å‡†å¤‡å·¥ä½œ (1 å‘¨)

#### ç›®æ ‡
- å®Œå–„æ–°æ¶æ„åŸºç¡€è®¾æ–½
- å»ºç«‹è¿ç§»å·¥å…·å’Œè„šæœ¬
- åˆ›å»ºè¿ç§»æµ‹è¯•å¥—ä»¶

#### ä»»åŠ¡æ¸…å•

**1. å®Œå–„ ServiceLocator é…ç½®**
- [x] åœ¨ AppDelegate ä¸­è°ƒç”¨ `ServiceLocator.shared.configure()`
- [x] éªŒè¯æ‰€æœ‰æœåŠ¡éƒ½å·²æ³¨å†Œ
- [x] æ·»åŠ æœåŠ¡æ³¨å†Œæ—¥å¿—

**2. åˆ›å»ºè¿ç§»è¾…åŠ©å·¥å…·**

- [x] åˆ›å»ºå•ä¾‹ä½¿ç”¨æ£€æµ‹è„šæœ¬ (`scripts/detect_singletons.rb`)
- [x] åˆ›å»ºä¾èµ–æ³¨å…¥è½¬æ¢è„šæœ¬ (`scripts/convert_to_di.rb`)
- [x] åˆ›å»ºè¿ç§»è¿›åº¦è¿½è¸ªå·¥å…·

**3. å»ºç«‹æµ‹è¯•åŸºç¡€è®¾æ–½**
- [x] ä¸ºæ‰€æœ‰æ–° ViewModel åˆ›å»ºå•å…ƒæµ‹è¯•
- [x] åˆ›å»ºé›†æˆæµ‹è¯•å¥—ä»¶
- [x] å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯•

**4. æ–‡æ¡£å‡†å¤‡**
- [x] åˆ›å»ºè¿ç§»æŒ‡å—æ–‡æ¡£
- [x] æ›´æ–°æ¶æ„æ–‡æ¡£
- [x] å‡†å¤‡å›æ»šæ–¹æ¡ˆæ–‡æ¡£

**éªŒæ”¶æ ‡å‡†**
- âœ… ServiceLocator åœ¨åº”ç”¨å¯åŠ¨æ—¶æ­£ç¡®åˆå§‹åŒ–
- âœ… æ‰€æœ‰å·¥å…·è„šæœ¬å¯ä»¥æ­£å¸¸è¿è¡Œ
- âœ… æµ‹è¯•å¥—ä»¶è¦†ç›–ç‡ > 80%
- âœ… æ–‡æ¡£å®Œæ•´ä¸”æ¸…æ™°

---

### Phase 7.2: æ ¸å¿ƒæœåŠ¡è¿ç§» (2 å‘¨)

#### ç›®æ ‡
- è¿ç§» 8 ä¸ªæ ¸å¿ƒæœåŠ¡å•ä¾‹
- ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
- å»ºç«‹è¿ç§»æ¨¡å¼

#### è¿ç§»é¡ºåº (æŒ‰ä¾èµ–å…³ç³»)


**Week 1: åŸºç¡€æœåŠ¡**

1. **NetworkMonitor (Day 1-2)**
   - [x] åˆ›å»º NetworkMonitorProtocol é€‚é…å™¨
   - [x] åœ¨ ServiceLocator ä¸­æ³¨å†Œ
   - [x] è¿ç§»æ‰€æœ‰ä½¿ç”¨ç‚¹
   - [x] è¿è¡Œæµ‹è¯•éªŒè¯

2. **CacheService (Day 2-3)**
   - [x] è¿ç§» MemoryCacheManager
   - [x] æ›´æ–°æ‰€æœ‰ç¼“å­˜è°ƒç”¨
   - [x] éªŒè¯ç¼“å­˜åŠŸèƒ½

3. **NoteStorage (Day 3-5)**
   - [x] è¿ç§» DatabaseService
   - [x] æ›´æ–°æ‰€æœ‰æ•°æ®åº“æ“ä½œ
   - [x] è¿è¡Œæ•°æ®å®Œæ•´æ€§æµ‹è¯•

**Week 2: ç½‘ç»œå’ŒåŒæ­¥æœåŠ¡**

4. **NoteService (Day 6-8)**
   - [x] è¿ç§» MiNoteService
   - [x] æ›´æ–°æ‰€æœ‰ç½‘ç»œè¯·æ±‚
   - [x] éªŒè¯ API è°ƒç”¨

5. **SyncService (Day 8-10)**
   - [x] è¿ç§» SyncService
   - [x] æ›´æ–°åŒæ­¥é€»è¾‘
   - [x] æµ‹è¯•åŒæ­¥åŠŸèƒ½

6. **AudioService & ImageService (Day 10-12)**
   - [x] è¿ç§»éŸ³é¢‘æœåŠ¡
   - [x] è¿ç§»å›¾ç‰‡æœåŠ¡
   - [x] éªŒè¯åª’ä½“åŠŸèƒ½

#### è¿ç§»æ¨¡å¼ç¤ºä¾‹


**æ­¥éª¤ 1: åˆ›å»ºé€‚é…å™¨ (å¦‚æœéœ€è¦)**
```swift
// å¦‚æœç°æœ‰å•ä¾‹ä¸æ–°åè®®ä¸å®Œå…¨åŒ¹é…,åˆ›å»ºé€‚é…å™¨
extension MiNoteService: NoteServiceProtocol {
    // å®ç°åè®®æ–¹æ³•
}
```

**æ­¥éª¤ 2: åœ¨ ServiceLocator ä¸­æ³¨å†Œ**
```swift
// Sources/Core/DependencyInjection/ServiceLocator.swift
public func configure() {
    // ... å…¶ä»–æœåŠ¡
    
    // æ³¨å†Œç¬”è®°æœåŠ¡ (ä½¿ç”¨ç°æœ‰å•ä¾‹ä½œä¸ºè¿‡æ¸¡)
    container.register(
        NoteServiceProtocol.self, 
        instance: MiNoteService.shared
    )
}
```

**æ­¥éª¤ 3: åˆ›å»ºä¾¿æ·è®¿é—®æ–¹æ³• (è¿‡æ¸¡æœŸ)**
```swift
// Sources/Core/DependencyInjection/ServiceLocator.swift
extension ServiceLocator {
    var noteService: NoteServiceProtocol {
        resolve(NoteServiceProtocol.self)
    }
}
```

**æ­¥éª¤ 4: é€æ­¥è¿ç§»ä½¿ç”¨ç‚¹**
```swift
// ä¹‹å‰
class SomeClass {
    func doSomething() {
        let notes = try await MiNoteService.shared.fetchNotes()
    }
}

// ä¹‹å (è¿‡æ¸¡æœŸ - ä½¿ç”¨ ServiceLocator)
class SomeClass {
    func doSomething() {
        let notes = try await ServiceLocator.shared.noteService.fetchNotes()
    }
}

// æœ€ç»ˆ (å®Œå…¨ä¾èµ–æ³¨å…¥)
class SomeClass {
    private let noteService: NoteServiceProtocol
    
    init(noteService: NoteServiceProtocol) {
        self.noteService = noteService
    }
    
    func doSomething() {
        let notes = try await noteService.fetchNotes()
    }
}
```

**éªŒæ”¶æ ‡å‡†**
- âœ… æ‰€æœ‰ 8 ä¸ªæ ¸å¿ƒæœåŠ¡å·²è¿ç§»
- âœ… ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™

---

### Phase 7.3: NotesViewModel æ‹†åˆ† (2 å‘¨)

#### ç›®æ ‡
- å°† NotesViewModel æ‹†åˆ†ä¸º 7 ä¸ªä¸“æ³¨çš„ ViewModel
- ä¿æŒå‘åå…¼å®¹
- é€æ­¥æ›¿æ¢æ—§ä»£ç 

#### Week 1: åˆ›å»ºæ–° ViewModel

**Day 1-2: NoteListViewModel**

- [ ] é‡æ–°æ·»åŠ  NoteListViewModel åˆ°é¡¹ç›®
- [ ] ä¿®å¤åè®®ä¸åŒ¹é…é—®é¢˜
- [ ] å®ç°åˆ—è¡¨å±•ç¤ºé€»è¾‘
- [ ] åˆ›å»ºå•å…ƒæµ‹è¯•

**Day 2-3: NoteEditorViewModel**
- [ ] é‡æ–°æ·»åŠ  NoteEditorViewModel
- [ ] å®ç°ç¼–è¾‘åŠŸèƒ½
- [ ] æ·»åŠ è‡ªåŠ¨ä¿å­˜é€»è¾‘
- [ ] åˆ›å»ºå•å…ƒæµ‹è¯•

**Day 3-4: SyncCoordinator**
- [ ] é‡æ–°æ·»åŠ  SyncCoordinator
- [ ] ä¿®å¤ SyncServiceProtocol é›†æˆ
- [ ] å®ç°åŒæ­¥åè°ƒé€»è¾‘
- [ ] åˆ›å»ºå•å…ƒæµ‹è¯•

**Day 4-5: å…¶ä»– ViewModel**
- [ ] AuthenticationViewModel
- [ ] SearchViewModel
- [ ] FolderViewModel
- [ ] AudioPanelViewModel

#### Week 2: é›†æˆå’Œæ›¿æ¢

**Day 6-7: åˆ›å»º AppCoordinator**
- [ ] é‡æ–°æ·»åŠ  AppCoordinator
- [ ] ä¿®å¤ä¾èµ–æ³¨å…¥é—®é¢˜
- [ ] å»ºç«‹ ViewModel é—´é€šä¿¡
- [ ] æµ‹è¯•åè°ƒé€»è¾‘

**Day 8-10: é€æ­¥æ›¿æ¢æ—§ ViewModel**

- [ ] åœ¨ AppDelegate ä¸­åˆ›å»º AppCoordinator å®ä¾‹
- [ ] é€ä¸ªåŠŸèƒ½æ›¿æ¢ NotesViewModel
- [ ] ä¿æŒæ—§ä»£ç ä½œä¸ºå¤‡ä»½
- [ ] éªŒè¯æ¯ä¸ªåŠŸèƒ½

**æ›¿æ¢ç­–ç•¥**
```swift
// AppDelegate.swift
class AppDelegate: NSObject, NSApplicationDelegate {
    // æ–°æ¶æ„ (é€æ­¥å¯ç”¨)
    private var appCoordinator: AppCoordinator?
    
    // æ—§æ¶æ„ (ä¿ç•™ä½œä¸ºå¤‡ä»½)
    private var notesViewModel: NotesViewModel?
    
    func applicationDidFinishLaunching(_ notification: Notification) {
        // é…ç½®æœåŠ¡
        ServiceLocator.shared.configure()
        
        // ä½¿ç”¨ç‰¹æ€§å¼€å…³æ§åˆ¶
        if FeatureFlags.useNewArchitecture {
            appCoordinator = AppCoordinator()
        } else {
            notesViewModel = NotesViewModel()
        }
    }
}
```

**éªŒæ”¶æ ‡å‡†**
- âœ… æ‰€æœ‰æ–° ViewModel å·²åˆ›å»ºå¹¶æµ‹è¯•
- âœ… AppCoordinator æ­£å¸¸å·¥ä½œ
- âœ… è‡³å°‘ 50% çš„åŠŸèƒ½å·²è¿ç§»åˆ°æ–° ViewModel
- âœ… å¯ä»¥é€šè¿‡ç‰¹æ€§å¼€å…³åˆ‡æ¢æ–°æ—§æ¶æ„

---

### Phase 7.4: çŠ¶æ€ç®¡ç†å™¨è¿ç§» (1 å‘¨)

#### ç›®æ ‡
- è¿ç§» 9 ä¸ªçŠ¶æ€ç®¡ç†å™¨
- ç»Ÿä¸€çŠ¶æ€ç®¡ç†æ¨¡å¼
- å‡å°‘çŠ¶æ€ç¢ç‰‡åŒ–

#### è¿ç§»æ¸…å•

**Day 1-2: æ ¸å¿ƒçŠ¶æ€ç®¡ç†å™¨**

- [ ] AppStateManager â†’ é›†æˆåˆ° AppCoordinator
- [ ] ViewStateCoordinator â†’ é›†æˆåˆ°å„ä¸ª ViewModel
- [ ] ViewOptionsManager â†’ åˆ›å»º ViewOptionsService

**Day 2-3: è®¤è¯å’Œç½‘ç»œçŠ¶æ€**
- [ ] AuthenticationStateManager â†’ é›†æˆåˆ° AuthenticationViewModel
- [ ] OnlineStateManager â†’ ä½¿ç”¨ NetworkMonitorProtocol

**Day 3-4: åŒæ­¥å’Œä¿å­˜çŠ¶æ€**
- [ ] SaveQueueManager â†’ é›†æˆåˆ° SyncCoordinator
- [ ] AudioPanelStateManager â†’ é›†æˆåˆ° AudioPanelViewModel

**Day 4-5: UI çŠ¶æ€**
- [ ] ToolbarVisibilityManager â†’ åˆ›å»º ToolbarStateService
- [ ] WindowManager â†’ ä¿æŒç‹¬ç«‹æˆ–åˆ›å»º WindowService

**è¿ç§»åŸåˆ™**
1. çŠ¶æ€åº”è¯¥å±äºæœ€ç›¸å…³çš„ ViewModel
2. è·¨ ViewModel çš„çŠ¶æ€é€šè¿‡ Coordinator ç®¡ç†
3. UI çŠ¶æ€å¯ä»¥ç‹¬ç«‹ä¸º Service

**éªŒæ”¶æ ‡å‡†**
- âœ… æ‰€æœ‰çŠ¶æ€ç®¡ç†å™¨å·²è¿ç§»æˆ–æ•´åˆ
- âœ… çŠ¶æ€ç®¡ç†æ›´åŠ é›†ä¸­å’Œæ¸…æ™°
- âœ… å‡å°‘äº†çŠ¶æ€åŒæ­¥é—®é¢˜

---

### Phase 7.5: æ“ä½œé˜Ÿåˆ—è¿ç§» (1 å‘¨)

#### ç›®æ ‡
- è¿ç§» 5 ä¸ªæ“ä½œé˜Ÿåˆ—å•ä¾‹
- ç»Ÿä¸€æ“ä½œé˜Ÿåˆ—ç®¡ç†
- ä¿æŒç¦»çº¿åŠŸèƒ½æ­£å¸¸

#### è¿ç§»æ¸…å•

**Day 1-2: ç»Ÿä¸€æ“ä½œé˜Ÿåˆ—**

- [ ] åˆ›å»º OperationQueueProtocol
- [ ] UnifiedOperationQueue â†’ å®ç°åè®®
- [ ] åœ¨ ServiceLocator ä¸­æ³¨å†Œ

**Day 2-3: æ“ä½œå¤„ç†å™¨**
- [ ] åˆ›å»º OperationProcessorProtocol
- [ ] OperationProcessor â†’ å®ç°åè®®
- [ ] é›†æˆåˆ° SyncCoordinator

**Day 3-4: ç¦»çº¿æ“ä½œ**
- [ ] OfflineOperationQueue â†’ æ•´åˆåˆ° UnifiedOperationQueue
- [ ] OfflineOperationProcessor â†’ æ•´åˆåˆ° OperationProcessor

**Day 4-5: åè°ƒå™¨**
- [ ] NoteOperationCoordinator â†’ é›†æˆåˆ° SyncCoordinator
- [ ] éªŒè¯ç¦»çº¿åŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**
- âœ… æ“ä½œé˜Ÿåˆ—å·²ç»Ÿä¸€ç®¡ç†
- âœ… ç¦»çº¿åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ“ä½œä¸ä¼šä¸¢å¤±æˆ–é‡å¤

---

### Phase 7.6: è¾…åŠ©æœåŠ¡è¿ç§» (1 å‘¨)

#### ç›®æ ‡
- è¿ç§» 12 ä¸ªè¾…åŠ©æœåŠ¡
- å®Œå–„æœåŠ¡å±‚
- æé«˜ä»£ç è´¨é‡

#### è¿ç§»æ¸…å•

**Day 1-2: ç½‘ç»œç›¸å…³æœåŠ¡**
- [ ] NetworkRequestManager â†’ æ•´åˆåˆ° NetworkClient
- [ ] NetworkLogger â†’ åˆ›å»º NetworkLoggingProtocol
- [ ] NetworkErrorHandler â†’ æ•´åˆåˆ° NetworkClient
- [ ] NetworkRecoveryHandler â†’ æ•´åˆåˆ° NetworkClient

**Day 2-3: é”™è¯¯å’Œå¯åŠ¨æœåŠ¡**

- [ ] ErrorRecoveryService â†’ åˆ›å»º ErrorRecoveryProtocol
- [ ] StartupSequenceManager â†’ é›†æˆåˆ° AppDelegate
- [ ] ScheduledTaskManager â†’ åˆ›å»º ScheduledTaskProtocol

**Day 3-4: åŒæ­¥ç›¸å…³æœåŠ¡**
- [ ] SilentCookieRefreshManager â†’ é›†æˆåˆ° AuthenticationService
- [ ] PrivateNotesPasswordManager â†’ åˆ›å»º PasswordManagerProtocol
- [ ] IdMappingRegistry â†’ é›†æˆåˆ° SyncService
- [ ] SyncGuard â†’ é›†æˆåˆ° SyncService

**Day 4-5: å­˜å‚¨æœåŠ¡**
- [ ] LocalStorageService â†’ æ•´åˆåˆ° NoteStorage

**éªŒæ”¶æ ‡å‡†**
- âœ… æ‰€æœ‰è¾…åŠ©æœåŠ¡å·²è¿ç§»
- âœ… æœåŠ¡èŒè´£æ›´åŠ æ¸…æ™°
- âœ… å‡å°‘äº†ä»£ç é‡å¤

---

### Phase 7.7: ç¼–è¾‘å™¨æœåŠ¡è¿ç§» (1 å‘¨)

#### ç›®æ ‡
- è¿ç§» 6 ä¸ªç¼–è¾‘å™¨ç›¸å…³æœåŠ¡
- ä¿æŒç¼–è¾‘å™¨åŠŸèƒ½å®Œæ•´
- æé«˜ç¼–è¾‘å™¨æ€§èƒ½

#### è¿ç§»æ¸…å•

**Day 1-2: é…ç½®å’Œè½¬æ¢æœåŠ¡**
- [ ] EditorPreferencesService â†’ åˆ›å»º EditorPreferencesProtocol
- [ ] XiaoMiFormatConverter â†’ åˆ›å»º FormatConverterProtocol

**Day 2-3: XML å’Œæ ‡é¢˜æœåŠ¡**

- [ ] XMLNormalizer â†’ åˆ›å»º XMLNormalizerProtocol
- [ ] TitleExtractionService â†’ åˆ›å»º TitleExtractionProtocol

**Day 3-5: å­˜å‚¨å’Œæ ¼å¼ç®¡ç†**
- [ ] ImageStorageManager â†’ é›†æˆåˆ° ImageService
- [ ] FormatManager â†’ åˆ›å»º FormatManagerProtocol

**éªŒæ”¶æ ‡å‡†**
- âœ… ç¼–è¾‘å™¨æœåŠ¡å·²è¿ç§»
- âœ… ç¼–è¾‘å™¨åŠŸèƒ½æ­£å¸¸
- âœ… æ ¼å¼è½¬æ¢å‡†ç¡®

---

### Phase 7.8: æ¸…ç†å’Œä¼˜åŒ– (1 å‘¨)

#### ç›®æ ‡
- ç§»é™¤æ‰€æœ‰æ—§å•ä¾‹
- æ¸…ç†å†—ä½™ä»£ç 
- ä¼˜åŒ–æ€§èƒ½

#### ä»»åŠ¡æ¸…å•

**Day 1-2: ç§»é™¤æ—§å•ä¾‹**
- [ ] ç¡®è®¤æ‰€æœ‰å•ä¾‹å·²è¿ç§»
- [ ] ç§»é™¤ `.shared` å±æ€§
- [ ] æ›´æ–°æ‰€æœ‰å¼•ç”¨

**Day 2-3: æ¸…ç† NotesViewModel**
- [ ] ç¡®è®¤æ‰€æœ‰åŠŸèƒ½å·²è¿ç§»åˆ°æ–° ViewModel
- [ ] ç§»é™¤æˆ–æ ‡è®°ä¸º @available(*, deprecated)
- [ ] æ›´æ–°æ–‡æ¡£

**Day 3-4: ä»£ç ä¼˜åŒ–**
- [ ] ç§»é™¤é‡å¤ä»£ç 
- [ ] ä¼˜åŒ–ä¾èµ–æ³¨å…¥æ€§èƒ½
- [ ] å‡å°‘å†…å­˜å ç”¨

**Day 4-5: æ–‡æ¡£æ›´æ–°**

- [ ] æ›´æ–°æ¶æ„æ–‡æ¡£
- [ ] æ›´æ–° API æ–‡æ¡£
- [ ] åˆ›å»ºè¿ç§»æ€»ç»“æŠ¥å‘Š

**éªŒæ”¶æ ‡å‡†**
- âœ… æ‰€æœ‰æ—§å•ä¾‹å·²ç§»é™¤
- âœ… ä»£ç åº“æ›´åŠ æ¸…æ™°
- âœ… æ–‡æ¡£å®Œæ•´æ›´æ–°

---

## ğŸ”§ è¿ç§»å·¥å…·å’Œè„šæœ¬

### 1. å•ä¾‹æ£€æµ‹è„šæœ¬

åˆ›å»º `scripts/detect_singletons.rb`:
```ruby
#!/usr/bin/env ruby

# æ£€æµ‹é¡¹ç›®ä¸­çš„å•ä¾‹ä½¿ç”¨
def detect_singletons(directory)
  singletons = []
  
  Dir.glob("#{directory}/**/*.swift").each do |file|
    content = File.read(file)
    
    # æ£€æµ‹ .shared æ¨¡å¼
    content.scan(/(\w+)\.shared/) do |match|
      singletons << {
        class: match[0],
        file: file,
        pattern: "#{match[0]}.shared"
      }
    end
  end
  
  singletons
end

# è¿è¡Œæ£€æµ‹
singletons = detect_singletons("Sources")

puts "å‘ç° #{singletons.length} ä¸ªå•ä¾‹ä½¿ç”¨:"
singletons.group_by { |s| s[:class] }.each do |klass, uses|
  puts "\n#{klass}.shared (#{uses.length} æ¬¡ä½¿ç”¨):"
  uses.each do |use|
    puts "  - #{use[:file]}"
  end
end
```

### 2. ä¾èµ–æ³¨å…¥è½¬æ¢è„šæœ¬

åˆ›å»º `scripts/convert_to_di.rb`:

```ruby
#!/usr/bin/env ruby

# å°†å•ä¾‹è°ƒç”¨è½¬æ¢ä¸º ServiceLocator è°ƒç”¨
def convert_to_service_locator(file_path, singleton_name, protocol_name)
  content = File.read(file_path)
  
  # æ›¿æ¢ Singleton.shared ä¸º ServiceLocator.shared.service
  service_name = protocol_name.gsub('Protocol', '').gsub(/([A-Z])/, '_\1').downcase[1..-1]
  content.gsub!(/#{singleton_name}\.shared/, "ServiceLocator.shared.#{service_name}")
  
  File.write(file_path, content)
  puts "âœ… å·²è½¬æ¢: #{file_path}"
end

# ä½¿ç”¨ç¤ºä¾‹
# convert_to_service_locator("Sources/ViewModel/SomeClass.swift", "MiNoteService", "NoteServiceProtocol")
```

### 3. è¿ç§»è¿›åº¦è¿½è¸ª

åˆ›å»º `docs/è¿ç§»è¿›åº¦è¿½è¸ª.md`:
```markdown
# è¿ç§»è¿›åº¦è¿½è¸ª

## æ€»ä½“è¿›åº¦: 0/45 (0%)

### æ ¸å¿ƒæœåŠ¡ (0/8)
- [ ] MiNoteService
- [ ] DatabaseService
- [ ] SyncService
- [ ] NetworkMonitor
- [ ] MemoryCacheManager
- [ ] AudioPlayerService
- [ ] AudioRecorderService
- [ ] ImageCacheService

### çŠ¶æ€ç®¡ç†å™¨ (0/9)
...

### æ“ä½œé˜Ÿåˆ— (0/5)
...

### è¾…åŠ©æœåŠ¡ (0/12)
...

### ç¼–è¾‘å™¨æœåŠ¡ (0/6)
...

### å…¶ä»– (0/5)
...
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

**æ¯ä¸ªæ–° ViewModel å¿…é¡»æœ‰:**

- åˆå§‹åŒ–æµ‹è¯•
- æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**: > 80%

### 2. é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯:**
- åº”ç”¨å¯åŠ¨æµç¨‹
- ç¬”è®° CRUD æ“ä½œ
- åŒæ­¥æµç¨‹
- ç¦»çº¿æ“ä½œ
- è®¤è¯æµç¨‹

### 3. æ€§èƒ½æµ‹è¯•

**æ€§èƒ½æŒ‡æ ‡:**
- åº”ç”¨å¯åŠ¨æ—¶é—´ < 2 ç§’
- ç¬”è®°åˆ—è¡¨åŠ è½½ < 500ms
- åŒæ­¥æ“ä½œ < 5 ç§’
- å†…å­˜å ç”¨ < 200MB

### 4. å›å½’æµ‹è¯•

**æ¯æ¬¡è¿ç§»åè¿è¡Œ:**
- æ‰€æœ‰ç°æœ‰æµ‹è¯•
- æ‰‹åŠ¨æµ‹è¯•å…³é”®åŠŸèƒ½
- æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ”„ å›æ»šç­–ç•¥

### æ¯ä¸ª Phase çš„å›æ»šæ–¹æ¡ˆ

**Phase 7.2 å›æ»š:**
```swift
// æ¢å¤ä½¿ç”¨æ—§å•ä¾‹
// åªéœ€æ³¨é‡Šæ‰ ServiceLocator æ³¨å†Œå³å¯
```

**Phase 7.3 å›æ»š:**
```swift
// ä½¿ç”¨ç‰¹æ€§å¼€å…³åˆ‡æ¢å›æ—§ ViewModel
FeatureFlags.useNewArchitecture = false
```

**å®Œå…¨å›æ»š:**
1. åˆ‡æ¢åˆ°è¿ç§»å‰çš„ Git åˆ†æ”¯
2. ä¿ç•™æ–°ä»£ç ä½œä¸ºå‚è€ƒ
3. é€æ­¥é‡æ–°åº”ç”¨å¿…è¦çš„ä¿®å¤

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡

- âœ… 0 ä¸ªå•ä¾‹æ¨¡å¼ (å½“å‰: 45)
- âœ… æœ€å¤§ç±»æ–‡ä»¶ < 500 è¡Œ (å½“å‰: 4,530)
- âœ… æµ‹è¯•è¦†ç›–ç‡ > 80% (å½“å‰: ~40%)
- âœ… å¾ªç¯å¤æ‚åº¦ < 10 (å½“å‰: ~25)

### è´¨é‡æŒ‡æ ‡
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ— æ€§èƒ½é€€åŒ–
- âœ… æ— æ–°å¢ bug
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡

### å¯ç»´æŠ¤æ€§æŒ‡æ ‡
- âœ… æ–°åŠŸèƒ½å¼€å‘æ—¶é—´å‡å°‘ 50%
- âœ… Bug ä¿®å¤æ—¶é—´å‡å°‘ 40%
- âœ… ä»£ç å®¡æŸ¥æ—¶é—´å‡å°‘ 30%
- âœ… æ–°äººä¸Šæ‰‹æ—¶é—´å‡å°‘ 60%

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### è¿ç§»å‰æ£€æŸ¥
- [ ] æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
- [ ] åˆ›å»ºè¿ç§»åˆ†æ”¯
- [ ] å¤‡ä»½å½“å‰ä»£ç 
- [ ] å›¢é˜Ÿæˆå‘˜äº†è§£è¿ç§»è®¡åˆ’

### æ¯ä¸ª Phase å®Œæˆåæ£€æŸ¥
- [ ] æ‰€æœ‰ä»»åŠ¡å®Œæˆ
- [ ] æ–°å¢æµ‹è¯•é€šè¿‡
- [ ] ç°æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

### è¿ç§»å®Œæˆåæ£€æŸ¥
- [ ] æ‰€æœ‰å•ä¾‹å·²ç§»é™¤
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½è¾¾æ ‡
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] å›¢é˜ŸåŸ¹è®­å®Œæˆ

---

## ğŸ¯ é‡Œç¨‹ç¢‘

### Milestone 1: åŸºç¡€è®¾æ–½å®Œå–„ (Week 1)
- ServiceLocator é…ç½®å®Œæˆ
- å·¥å…·è„šæœ¬å°±ç»ª
- æµ‹è¯•åŸºç¡€è®¾æ–½å»ºç«‹

### Milestone 2: æ ¸å¿ƒæœåŠ¡è¿ç§» (Week 3)
- 8 ä¸ªæ ¸å¿ƒæœåŠ¡å·²è¿ç§»
- åŸºæœ¬åŠŸèƒ½æ­£å¸¸

### Milestone 3: ViewModel é‡æ„ (Week 5)
- NotesViewModel å·²æ‹†åˆ†
- æ–°æ¶æ„å¯ç”¨

### Milestone 4: å…¨é¢è¿ç§» (Week 7)
- æ‰€æœ‰å•ä¾‹å·²è¿ç§»
- æ—§ä»£ç å·²æ¸…ç†

### Milestone 5: ä¼˜åŒ–å®Œæˆ (Week 8)
- æ€§èƒ½ä¼˜åŒ–å®Œæˆ
- æ–‡æ¡£æ›´æ–°å®Œæˆ
- è¿ç§»æˆåŠŸ ğŸ‰

---

## ğŸ“ æ”¯æŒå’Œèµ„æº

### æ–‡æ¡£
- æ¶æ„æ–‡æ¡£: `docs/Architecture.md`
- ç¼–ç è§„èŒƒ: `docs/CodingGuidelines.md`
- API æ–‡æ¡£: `docs/API.md`

### å·¥å…·
- å•ä¾‹æ£€æµ‹: `scripts/detect_singletons.rb`
- DI è½¬æ¢: `scripts/convert_to_di.rb`
- è¿›åº¦è¿½è¸ª: `docs/è¿ç§»è¿›åº¦è¿½è¸ª.md`

### è”ç³»æ–¹å¼
- æŠ€æœ¯é—®é¢˜: æŸ¥çœ‹æ–‡æ¡£æˆ–æ Issue
- æ¶æ„è®¨è®º: å›¢é˜Ÿä¼šè®®

---

**åˆ›å»ºæ—¥æœŸ**: 2026-01-22  
**æœ€åæ›´æ–°**: 2026-01-22  
**çŠ¶æ€**: å¾…å¼€å§‹  
**é¢„è®¡å®Œæˆ**: 2026-03-15
