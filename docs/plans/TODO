# 顶层重构收尾清单

> 更新日期：2026-02-26
> 关联文档：`docs/architecture-next.md`

## 当前状态

- 顶层架构重构主计划（spec124-spec136）已完成。
- 目录结构、组合根拆分、菜单 Command 化、关键链路测试已落地。

## 收尾项（非结构性重构）

- [x] 修复 Domain 规则违规：`Sources/Features/Notes/Domain/Note.swift` 已移除 `import AppKit`（2026-02-26）。
- [x] 同步 `docs/architecture-next.md` 的最终验收状态描述（2026-02-26）。
- [x] 清理历史计划文档中的“进行中”表述，统一改为“已完成（归档）”（2026-02-26）。

## 二次审计待重构项（2026-02-26）

### P1（优先）

- [ ] 清零 `MainWindowController+Actions.swift` 中遗留占位逻辑（`TODO(spec-121)`、`功能开发中` 弹窗、待实现分支），确保菜单动作无空壳路径。
- [ ] 补齐架构脚本对 NotificationCenter 边界的自动化校验，满足 DoD 中“EventBus/NotificationCenter 边界可脚本校验”。

### P2（高优先）

- [ ] 拆分 `MenuManager.swift`（1143 行）并清理禁用占位菜单项（`isEnabled = false` 的待实现入口）。
- [x] 收敛 `AppDelegate` 的 84 个 selector 转发方法，评估并落地命令注册表/映射表以降低维护成本。
- [ ] 拆分 `UnifiedOperationQueue.swift`（1115 行，45 个函数）为更小职责单元（查询/状态迁移/重试策略分离）。
- [ ] 拆分 `UnifiedFormatManager.swift`（1122 行，40 个函数）并收窄 public API 面。

### P3（优化）

- [ ] 拆分 `DebugSettingsView.swift`（1256 行）为多个 Settings 子面板。
- [ ] 拆分 `AudioPanelView.swift`（1135 行）为独立的播放/录制/上传 UI 组件。

## 已完成记录（摘要）

- [x] spec-124：菜单命令链 Command 化，`MenuActionHandler` 删除。
- [x] spec-125：ADR + 架构检查脚本 + CI 集成。
- [x] spec-126/127/128：Notes/Sync/Auth/Folders Vertical Slice。
- [x] spec-129：第一级 `.shared` 退出（NetworkMonitor/NetworkErrorHandler/NetworkLogger/PreviewHelper）。
- [x] spec-130：导入流程“真实写入”修复。
- [x] spec-131：RULE-001 扫描覆盖 `Features/*/Domain`。
- [x] spec-132：Command/导入/同步队列回归测试补齐。
- [x] spec-133：组合根按域拆分（Notes/Sync/Auth/Editor/Audio Assembler）。
- [x] spec-134：同步队列第二层治理（失败策略与可观测性增强）。
- [x] spec-135：`App/Bootstrap|Composition|Runtime` 与 `Shared/Kernel|UICommons` 骨架落地。
- [x] spec-136：Editor/Search/Audio 切片迁移完成。
