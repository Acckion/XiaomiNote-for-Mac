# æ¶æ„è¿ç§»æŒ‡å—

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2026-01-22  
**çŠ¶æ€**: è¿›è¡Œä¸­

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [è¿ç§»åŸåˆ™](#è¿ç§»åŸåˆ™)
3. [è¿ç§»æ­¥éª¤](#è¿ç§»æ­¥éª¤)
4. [å·¥å…·ä½¿ç”¨](#å·¥å…·ä½¿ç”¨)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†ä»å•ä¾‹æ¨¡å¼è¿ç§»åˆ°ä¾èµ–æ³¨å…¥æ¶æ„çš„è¯¦ç»†æ­¥éª¤å’Œæœ€ä½³å®è·µã€‚

### è¿ç§»ç›®æ ‡

- æ¶ˆé™¤æ‰€æœ‰å•ä¾‹æ¨¡å¼ï¼ˆ69 ä¸ªå•ä¾‹ï¼Œ723 æ¬¡ä½¿ç”¨ï¼‰
- å°† NotesViewModel (4,530 è¡Œ) æ‹†åˆ†ä¸º 7 ä¸ªä¸“æ³¨çš„ ViewModel
- å»ºç«‹æ¸…æ™°çš„ä¾èµ–æ³¨å…¥æ¶æ„
- æé«˜ä»£ç å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§

### è¿ç§»ç­–ç•¥

é‡‡ç”¨**æ¸è¿›å¼è¿ç§»**ç­–ç•¥ï¼š
- æ–°æ—§ç³»ç»Ÿå…±å­˜
- ä½¿ç”¨ç‰¹æ€§å¼€å…³æ§åˆ¶
- æ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹å›æ»š
- ä¿æŒåŠŸèƒ½å®Œæ•´æ€§

---

## è¿ç§»åŸåˆ™

### 1. å®‰å…¨ç¬¬ä¸€

- âœ… æ¯æ¬¡è¿ç§»å‰åˆ›å»º Git åˆ†æ”¯
- âœ… ä¿ç•™æ—§ä»£ç ä½œä¸ºå¤‡ä»½
- âœ… ä½¿ç”¨ç‰¹æ€§å¼€å…³æ§åˆ¶æ–°åŠŸèƒ½
- âœ… å……åˆ†æµ‹è¯•åå†åˆ é™¤æ—§ä»£ç 

### 2. æ¸è¿›å¼è¿ç§»

- âœ… ä»ä½é£é™©æ¨¡å—å¼€å§‹
- âœ… ä¸€æ¬¡è¿ç§»ä¸€ä¸ªæœåŠ¡
- âœ… éªŒè¯åŠŸèƒ½æ­£å¸¸åå†ç»§ç»­
- âœ… ä¸è¦ä¸€æ¬¡æ€§å¤§è§„æ¨¡é‡æ„

### 3. ä¿æŒåŠŸèƒ½å®Œæ•´

- âœ… è¿ç§»è¿‡ç¨‹ä¸­ä¸æ”¹å˜åŠŸèƒ½
- âœ… æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡
- âœ… æ€§èƒ½ä¸èƒ½æ˜æ˜¾ä¸‹é™
- âœ… ç”¨æˆ·ä½“éªŒä¸å—å½±å“

### 4. æ–‡æ¡£åŒæ­¥

- âœ… åŠæ—¶æ›´æ–°æ–‡æ¡£
- âœ… è®°å½•è¿ç§»å†³ç­–
- âœ… æ ‡è®°å·²å®Œæˆçš„ä»»åŠ¡
- âœ… åˆ†äº«ç»éªŒæ•™è®­

---

## è¿ç§»æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»ºåè®®æŠ½è±¡

å¦‚æœæœåŠ¡è¿˜æ²¡æœ‰åè®®ï¼Œé¦–å…ˆåˆ›å»ºåè®®ï¼š

```swift
// Sources/Service/Protocols/NoteServiceProtocol.swift
protocol NoteServiceProtocol {
    func fetchNotes() async throws -> [Note]
    func createNote(_ note: Note) async throws -> Note
    // ... å…¶ä»–æ–¹æ³•
}
```

### æ­¥éª¤ 2: è®©ç°æœ‰å•ä¾‹å®ç°åè®®

```swift
// Sources/Service/Network/MiNoteService.swift
extension MiNoteService: NoteServiceProtocol {
    // å¦‚æœæ–¹æ³•ç­¾åå·²åŒ¹é…ï¼Œæ— éœ€é¢å¤–å®ç°
    // å¦‚æœä¸åŒ¹é…ï¼Œåˆ›å»ºé€‚é…å™¨æ–¹æ³•
}
```

### æ­¥éª¤ 3: åœ¨ ServiceLocator ä¸­æ³¨å†Œ

```swift
// Sources/Core/DependencyInjection/ServiceLocator.swift
public func configure() {
    // ... å…¶ä»–æœåŠ¡
    
    // æ³¨å†Œç¬”è®°æœåŠ¡ï¼ˆä½¿ç”¨ç°æœ‰å•ä¾‹ä½œä¸ºè¿‡æ¸¡ï¼‰
    let noteService = MiNoteService.shared
    container.register(NoteServiceProtocol.self, instance: noteService)
}
```

### æ­¥éª¤ 4: æ·»åŠ ä¾¿æ·è®¿é—®æ–¹æ³•

```swift
// Sources/Core/DependencyInjection/ServiceLocator.swift
extension ServiceLocator {
    var noteService: NoteServiceProtocol {
        resolve(NoteServiceProtocol.self)
    }
}
```

### æ­¥éª¤ 5: è¿ç§»ä½¿ç”¨ç‚¹

#### é˜¶æ®µ 1: ä½¿ç”¨ ServiceLocatorï¼ˆè¿‡æ¸¡æœŸï¼‰

```swift
// ä¹‹å‰
class SomeClass {
    func doSomething() async {
        let notes = try await MiNoteService.shared.fetchNotes()
    }
}

// ä¹‹åï¼ˆè¿‡æ¸¡æœŸï¼‰
class SomeClass {
    func doSomething() async {
        let notes = try await ServiceLocator.shared.noteService.fetchNotes()
    }
}
```

#### é˜¶æ®µ 2: å®Œå…¨ä¾èµ–æ³¨å…¥ï¼ˆæœ€ç»ˆç›®æ ‡ï¼‰

```swift
// æœ€ç»ˆ
class SomeClass {
    private let noteService: NoteServiceProtocol
    
    init(noteService: NoteServiceProtocol) {
        self.noteService = noteService
    }
    
    func doSomething() async {
        let notes = try await noteService.fetchNotes()
    }
}
```

### æ­¥éª¤ 6: éªŒè¯å’Œæµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
xcodebuild test -project MiNoteMac.xcodeproj -scheme MiNoteMac

# æ£€æŸ¥ç¼–è¯‘
xcodebuild build -project MiNoteMac.xcodeproj -scheme MiNoteMac

# è¿è¡Œåº”ç”¨éªŒè¯åŠŸèƒ½
open MiNoteMac.app
```

### æ­¥éª¤ 7: æ›´æ–°è¿›åº¦

```bash
# æ ‡è®°ä»»åŠ¡å®Œæˆ
ruby scripts/track_migration_progress.rb complete "MiNoteService"

# æŸ¥çœ‹è¿›åº¦
ruby scripts/track_migration_progress.rb show
```

---

## å·¥å…·ä½¿ç”¨

### 1. å•ä¾‹æ£€æµ‹è„šæœ¬

æ£€æµ‹é¡¹ç›®ä¸­çš„æ‰€æœ‰å•ä¾‹ä½¿ç”¨ï¼š

```bash
ruby scripts/detect_singletons.rb
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ” æ‰«æç›®å½•: Sources
============================================================

ğŸ“Š æ£€æµ‹ç»“æœ
============================================================

æ€»è®¡å‘ç° 69 ä¸ªå•ä¾‹ç±»
æ€»è®¡ 723 æ¬¡ä½¿ç”¨

NetworkLogger.shared (132 æ¬¡ä½¿ç”¨)
  ğŸ“„ Sources/Service/Network/MiNoteService.swift:45
     NetworkLogger.shared.log("Fetching notes")
  ...
```

### 2. DI è½¬æ¢è„šæœ¬

æ‰¹é‡è½¬æ¢å•ä¾‹è°ƒç”¨ä¸º ServiceLocator è°ƒç”¨ï¼š

```bash
# é¢„è§ˆè½¬æ¢ï¼ˆä¸å®é™…ä¿®æ”¹æ–‡ä»¶ï¼‰
ruby scripts/convert_to_di.rb --dry-run MiNoteService

# å®é™…è½¬æ¢
ruby scripts/convert_to_di.rb MiNoteService

# è½¬æ¢æŒ‡å®šç›®å½•
ruby scripts/convert_to_di.rb MiNoteService Sources/ViewModel
```

### 3. è¿›åº¦è¿½è¸ªå·¥å…·

ç®¡ç†è¿ç§»è¿›åº¦ï¼š

```bash
# æ ‡è®°ä»»åŠ¡å®Œæˆ
ruby scripts/track_migration_progress.rb complete "æ ¸å¿ƒæœåŠ¡è¿ç§»"

# æ ‡è®°ä»»åŠ¡è¿›è¡Œä¸­
ruby scripts/track_migration_progress.rb progress "NotesViewModel æ‹†åˆ†"

# æ˜¾ç¤ºå½“å‰è¿›åº¦
ruby scripts/track_migration_progress.rb show

# ç”Ÿæˆè¿›åº¦æŠ¥å‘Š
ruby scripts/track_migration_progress.rb report
```

---

## å¸¸è§é—®é¢˜

### Q1: è¿ç§»åæ€§èƒ½ä¸‹é™æ€ä¹ˆåŠï¼Ÿ

**A**: 
1. ä½¿ç”¨æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·å¯¹æ¯”æ–°æ—§å®ç°
2. æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
3. è€ƒè™‘ä½¿ç”¨å•ä¾‹å®ä¾‹è€Œéæ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹
4. ä¼˜åŒ–çƒ­è·¯å¾„ä»£ç 

### Q2: å¦‚ä½•å¤„ç†å¾ªç¯ä¾èµ–ï¼Ÿ

**A**:
1. é‡æ–°è®¾è®¡ä¾èµ–å…³ç³»ï¼Œæ¶ˆé™¤å¾ªç¯
2. ä½¿ç”¨åè®®æŠ½è±¡æ‰“ç ´å¾ªç¯
3. è€ƒè™‘ä½¿ç”¨äº‹ä»¶æ€»çº¿æˆ–é€šçŸ¥
4. å°†å…±äº«çŠ¶æ€æå–åˆ°ç‹¬ç«‹çš„æœåŠ¡

### Q3: æµ‹è¯•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**:
1. æ£€æŸ¥ Mock æœåŠ¡æ˜¯å¦æ­£ç¡®é…ç½®
2. éªŒè¯ä¾èµ–æ³¨å…¥æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿æµ‹è¯•ä½¿ç”¨çš„æ˜¯ Mock è€ŒéçœŸå®æœåŠ¡
4. æŸ¥çœ‹æµ‹è¯•æ—¥å¿—å®šä½é—®é¢˜

### Q4: å¦‚ä½•å›æ»šè¿ç§»ï¼Ÿ

**A**:
1. ä½¿ç”¨ Git åˆ‡æ¢åˆ°è¿ç§»å‰çš„åˆ†æ”¯
2. å¦‚æœä½¿ç”¨ç‰¹æ€§å¼€å…³ï¼Œå…³é—­æ–°åŠŸèƒ½
3. æ¢å¤æ—§çš„å•ä¾‹è°ƒç”¨
4. è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½æ­£å¸¸

### Q5: è¿ç§»è¿‡ç¨‹ä¸­å‘ç° Bug æ€ä¹ˆåŠï¼Ÿ

**A**:
1. ç«‹å³åœæ­¢è¿ç§»
2. ä¿®å¤ Bug å¹¶æµ‹è¯•
3. æäº¤ Bug ä¿®å¤
4. ç»§ç»­è¿ç§»å·¥ä½œ

---

## æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

#### åè®®å‘½å
```swift
// âœ… å¥½çš„å‘½å
protocol NoteServiceProtocol { }
protocol SyncServiceProtocol { }

// âŒ é¿å…çš„å‘½å
protocol NoteService { }  // ä¸ç±»åå†²çª
protocol INoteService { }  // ä¸ç¬¦åˆ Swift é£æ ¼
```

#### å®ç°å‘½å
```swift
// âœ… å¥½çš„å‘½å
class DefaultNoteService: NoteServiceProtocol { }
class MockNoteService: NoteServiceProtocol { }

// âŒ é¿å…çš„å‘½å
class NoteServiceImpl: NoteServiceProtocol { }  // ä¸ç¬¦åˆ Swift é£æ ¼
```

### 2. ä¾èµ–æ³¨å…¥æ¨¡å¼

#### æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆæ¨èï¼‰
```swift
class NoteListViewModel {
    private let noteService: NoteServiceProtocol
    
    init(noteService: NoteServiceProtocol) {
        self.noteService = noteService
    }
}
```

#### å±æ€§æ³¨å…¥ï¼ˆé¿å…ï¼‰
```swift
// âŒ ä¸æ¨è
class NoteListViewModel {
    var noteService: NoteServiceProtocol!  // éšå¼è§£åŒ…ï¼Œä¸å®‰å…¨
}
```

### 3. æµ‹è¯•ç­–ç•¥

#### å•å…ƒæµ‹è¯•
```swift
final class NoteListViewModelTests: ViewModelTestCase {
    var sut: NoteListViewModel!
    var mockNoteService: MockNoteService!
    
    override func setUp() {
        super.setUp()
        mockNoteService = MockNoteService()
        sut = NoteListViewModel(noteService: mockNoteService)
    }
    
    func testFetchNotes() async throws {
        // Given
        let expectedNotes = [createTestNote()]
        mockNoteService.notesToReturn = expectedNotes
        
        // When
        try await sut.fetchNotes()
        
        // Then
        XCTAssertEqual(sut.notes, expectedNotes)
    }
}
```

#### é›†æˆæµ‹è¯•
```swift
final class NoteServiceIntegrationTests: BaseTestCase {
    func testNoteServiceWithRealDatabase() async throws {
        // ä½¿ç”¨çœŸå®çš„æ•°æ®åº“æœåŠ¡æµ‹è¯•
        let noteStorage = DefaultNoteStorage()
        let noteService = DefaultNoteService(storage: noteStorage)
        
        // æµ‹è¯•å®Œæ•´æµç¨‹
        let note = createTestNote()
        let savedNote = try await noteService.createNote(note)
        let fetchedNote = try await noteService.fetchNote(id: savedNote.id)
        
        XCTAssertEqual(savedNote.id, fetchedNote.id)
    }
}
```

### 4. é”™è¯¯å¤„ç†

```swift
// âœ… å¥½çš„é”™è¯¯å¤„ç†
class NoteService: NoteServiceProtocol {
    func fetchNotes() async throws -> [Note] {
        do {
            return try await networkClient.fetchNotes()
        } catch let error as NetworkError {
            // è½¬æ¢ä¸ºé¢†åŸŸé”™è¯¯
            throw NoteServiceError.networkError(error)
        } catch {
            throw NoteServiceError.unknown(error)
        }
    }
}

// âŒ é¿å…çš„é”™è¯¯å¤„ç†
class NoteService: NoteServiceProtocol {
    func fetchNotes() async throws -> [Note] {
        return try await networkClient.fetchNotes()  // ç›´æ¥æŠ›å‡ºåº•å±‚é”™è¯¯
    }
}
```

### 5. æ—¥å¿—è®°å½•

```swift
// âœ… å¥½çš„æ—¥å¿—è®°å½•
class NoteService: NoteServiceProtocol {
    func fetchNotes() async throws -> [Note] {
        print("ğŸ“ å¼€å§‹è·å–ç¬”è®°...")
        
        do {
            let notes = try await networkClient.fetchNotes()
            print("âœ… æˆåŠŸè·å– \(notes.count) æ¡ç¬”è®°")
            return notes
        } catch {
            print("âŒ è·å–ç¬”è®°å¤±è´¥: \(error)")
            throw error
        }
    }
}
```

---

## æ£€æŸ¥æ¸…å•

### è¿ç§»å‰
- [ ] åˆ›å»º Git åˆ†æ”¯
- [ ] è¿è¡Œæ‰€æœ‰æµ‹è¯•ç¡®ä¿é€šè¿‡
- [ ] å¤‡ä»½å½“å‰ä»£ç 
- [ ] é˜…è¯»ç›¸å…³æ–‡æ¡£

### è¿ç§»ä¸­
- [ ] åˆ›å»ºåè®®æŠ½è±¡
- [ ] å®ç°åè®®
- [ ] æ³¨å†Œåˆ° ServiceLocator
- [ ] è¿ç§»ä½¿ç”¨ç‚¹
- [ ] è¿è¡Œæµ‹è¯•
- [ ] éªŒè¯åŠŸèƒ½

### è¿ç§»å
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] åŠŸèƒ½éªŒè¯å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] æ ‡è®°ä»»åŠ¡å®Œæˆ
- [ ] æäº¤ä»£ç 

---

## å‚è€ƒèµ„æº

### æ–‡æ¡£
- [æ¶æ„è¿ç§»å®Œæ•´è®¡åˆ’](./æ¶æ„è¿ç§»å®Œæ•´è®¡åˆ’.md)
- [è¿ç§»è¿›åº¦è¿½è¸ª](./è¿ç§»è¿›åº¦è¿½è¸ª.md)
- [è¿ç§»è®¡åˆ’æ‰§è¡Œæ‘˜è¦](./è¿ç§»è®¡åˆ’æ‰§è¡Œæ‘˜è¦.md)
- [æ¶æ„æ–‡æ¡£](./Architecture.md)

### å·¥å…·
- å•ä¾‹æ£€æµ‹: `scripts/detect_singletons.rb`
- DI è½¬æ¢: `scripts/convert_to_di.rb`
- è¿›åº¦è¿½è¸ª: `scripts/track_migration_progress.rb`

### å‘½ä»¤
```bash
# æ£€æµ‹å•ä¾‹
ruby scripts/detect_singletons.rb

# è½¬æ¢å•ä¾‹
ruby scripts/convert_to_di.rb MiNoteService

# æŸ¥çœ‹è¿›åº¦
ruby scripts/track_migration_progress.rb show

# è¿è¡Œæµ‹è¯•
xcodebuild test -project MiNoteMac.xcodeproj -scheme MiNoteMac
```

---

**æœ€åæ›´æ–°**: 2026-01-22  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**: 1.0
