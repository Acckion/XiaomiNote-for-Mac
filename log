[VIEWMODEL] 应用变为前台
[VIEWMODEL] 启动自动同步定时器，间隔: 300.0秒
[MemoryCache] 更新缓存 - ID: 49013776..., 标题: 112你哈
[MemoryCache] 添加缓存 - ID: 48716783..., 标题: 测试图片上, 当前缓存数: 2
[PinnedNoteRowContent] 点击笔记 - ID: 48716783..., 当前选中: 49013776, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48716783932425280
[PinnedNoteRowContent] 设置 selectedNote 为 48716783...
[NotesListView] 📊 selectedNote 变化: 49013776 -> 48716783
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 49013776..., 标题: 112你哈
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 26
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 26
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 49013776... 切换到: 48716783...
[笔记切换] 📝 捕获的标题: 112你哈
[笔记切换] 📝 原始标题: 112你哈
[笔记切换] 📏 捕获的内容长度: 26
[笔记切换] 📏 lastSavedXMLContent 长度: 26
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 26
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 26 到 325
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48716783932425280
[StateTransition] noteSelection: folder(0 -> 0), note(49013776217424928 -> 48716783932425280)
[ViewStateCoordinator] 笔记选择完成: 测试图片上
[笔记切换] 📝 后台保存内容 - 长度: 26
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 26 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.04ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.09ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.05ms
[XMLNormalizer] 📏 规范化后内容长度: 26 字符
[XMLNormalizer] ⏱️ 总耗时: 0.22ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 26 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.00ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.04ms
[XMLNormalizer] 📏 规范化后内容长度: 26 字符
[XMLNormalizer] ⏱️ 总耗时: 0.10ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=26, 保存=26
[内容检测] 📏 规范化后长度: 当前=26, 保存=26
[内容检测] ⏱️ 检测耗时: 0.34ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.38ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48716783..., 标题: 测试图片上
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 测试图片上
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48716783..., 标题: 测试图片上
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 测试图片上
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48716783..., 标题: 测试图片上
[MemoryCache] 缓存命中 - ID: 48716783..., 标题: 测试图片上
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caaf8f00
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: jpg
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caafa080
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: jpg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpg - 不存在
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpg - 不存在
[ImageAttachment]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - folderId: '0'
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpg
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[ImageAttachment]   - imageDescription: 'nil'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: jpeg
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caaf9f40
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: png
[LocalStorage]   - fileType: jpeg
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 19
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext]   - nsAttributed.string: '11212134646
￼
￼
​
￼'
[LocalStorage]   - fileType: png
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: gif
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {12, 1}
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.png - 不存在
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.gif - 不存在
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[LocalStorage]   - fileType: jpg
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.png
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.gif
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: gif
[NativeEditorContext] 🖼️ 发现附件 2: ImageAttachment at range {14, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.gif
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpg
[NativeEditorContext] 🖼️ 发现附件 3: ImageAttachment at range {18, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[NativeEditorContext] 🖼️ 总共发现 3 个附件，其中 3 个是 ImageAttachment
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: gif
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.gif
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 11}: '11212134646'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 1}: '​'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 325, 转换后文本长度: 19
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 325
[NativeEditorView] 更新内容 - 当前长度: 2, 新长度: 19, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=19, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8537480> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48716783...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 325
[快速切换] ✅ 从缓存加载完成 - ID: 48716783..., 标题: 测试图片上, 内容长度: 325
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48716783...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48716783...
[NativeEditorContext] 验证内容持久化，预期内容长度: 325
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf8f00
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafa080
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf9f40
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 325
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 325
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48716783...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 325
[快速切换] ✅ 从缓存加载完成 - ID: 48716783..., 标题: 测试图片上, 内容长度: 325
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48716783...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48716783...
[NativeEditorContext] 验证内容持久化，预期内容长度: 325
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf8f00
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafa080
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf9f40
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 325
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 325
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ❌ 无法加载图片: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment] ❌ 仅尝试 images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.{format} 格式，未找到图片文件
[ImageAttachment] ❌ 无法加载图片: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment] ❌ 仅尝试 images/1315204657.mqD6sEiru5CFpGR0vUZaMA.{format} 格式，未找到图片文件
[ImageAttachment] ❌ 无法加载图片: 1315204657.WoQvt7-vevfMveZJFbPN4g
[ImageAttachment] ❌ 仅尝试 images/1315204657.WoQvt7-vevfMveZJFbPN4g.{format} 格式，未找到图片文件
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 19
[NativeEditorView]   - 加载前 范围 {0, 11}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11, 5}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {16, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {17, 2}: Helvetica, italic=false
[NativeTextView] setSelectedRange 被调用: location=19, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 11}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11, 5}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {16, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {17, 2}: Helvetica, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 14.60ms
[NativeEditorView] 更新内容 - 当前长度: 19, 新长度: 19, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=19, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=19, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caaf8f00
[ImageAttachment]   - imageBounds: (21.0, 195.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 12
[ImageAttachment]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caafa080
[ImageAttachment]   - imageBounds: (21.0, 345.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 14
[ImageAttachment]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caaf9f40
[ImageAttachment]   - imageBounds: (21.0, 524.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 18
[ImageAttachment]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caafb5c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: jpg
[ImageAttachment]   - 附件对象地址: 0x00000009caafb700
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpg
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpeg - 不存在
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[LocalStorage]   - fileType: jpg
[ImageAttachment]   - 附件对象地址: 0x00000009caafb840
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpg - 不存在
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpg
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fileType: gif
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.gif
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 19
[NativeEditorContext]   - nsAttributed.string: '11212134646
￼
￼
​
￼'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpeg - 不存在
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {12, 1}
[LocalStorage]   - fileType: jpg
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🖼️ 发现附件 2: ImageAttachment at range {14, 1}
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: png
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: jpeg
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[NativeEditorContext] 🖼️ 发现附件 3: ImageAttachment at range {18, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[NativeEditorContext] 🖼️ 总共发现 3 个附件，其中 3 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.png - 不存在
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpeg
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: png
[LocalStorage]   - fileType: gif
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.gif
[NativeEditorContext]   - 范围 {0, 11}: '11212134646'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: gif
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 1}: '​'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.gif
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 325, 转换后文本长度: 19
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 325
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caafb980
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: jpg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: jpeg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: png
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caafbac0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.png - 不存在
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - folderId: '0'
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.png
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caafbc00
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.WoQvt7-vevfMveZJFbPN4g
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[LocalStorage]   - fileType: gif
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.mqD6sEiru5CFpGR0vUZaMA.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.mqD6sEiru5CFpGR0vUZaMA.gif
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fileType: jpg
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: jpg
[NativeEditorContext]   - nsAttributed.length: 19
[NativeEditorContext]   - nsAttributed.string: '11212134646
￼
￼
​
￼'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpg - 不存在
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {12, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[NativeEditorContext] 🖼️ 发现附件 2: ImageAttachment at range {14, 1}
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[NativeEditorContext] 🖼️ 发现附件 3: ImageAttachment at range {18, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[NativeEditorContext] 🖼️ 总共发现 3 个附件，其中 3 个是 ImageAttachment
[LocalStorage]   - fileType: jpeg
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.WoQvt7-vevfMveZJFbPN4g
[保存状态] 📝 内容变化 - 设置为未保存
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fileType: gif
[LocalStorage]   - fullFileId: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[LocalStorage]   - fileType: gif
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.WoQvt7-vevfMveZJFbPN4g.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.WoQvt7-vevfMveZJFbPN4g.gif
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 11}: '11212134646'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 1}: '​'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 325, 转换后文本长度: 19
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 325
[NativeEditorWrapper] 初始加载内容 - 长度: 325
[NativeEditorView] 更新内容 - 当前长度: 19, 新长度: 19, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=19, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=19, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 19, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=19, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=18, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 372.0, 204.0, 154.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caafb980
[ImageAttachment]   - imageBounds: (21.0, 195.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 12
[ImageAttachment]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment]   - src: 'minote://image/1315204657.mqD6sEiru5CFpGR0vUZaMA'
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caafbac0
[ImageAttachment]   - imageBounds: (21.0, 345.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 14
[ImageAttachment]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment]   - src: 'minote://image/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caafbc00
[ImageAttachment]   - imageBounds: (21.0, 524.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 18
[ImageAttachment]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment]   - src: 'minote://image/1315204657.WoQvt7-vevfMveZJFbPN4g'
[ImageAttachment] ❌ 无法加载图片: 1315204657.mqD6sEiru5CFpGR0vUZaMA
[ImageAttachment] ❌ 仅尝试 images/1315204657.mqD6sEiru5CFpGR0vUZaMA.{format} 格式，未找到图片文件
[ImageAttachment] ❌ 无法加载图片: 1315204657.iTQ9Lbgh5CmBeiFYu9YVfA
[ImageAttachment] ❌ 仅尝试 images/1315204657.iTQ9Lbgh5CmBeiFYu9YVfA.{format} 格式，未找到图片文件
[ImageAttachment] ❌ 无法加载图片: 1315204657.WoQvt7-vevfMveZJFbPN4g
[ImageAttachment] ❌ 仅尝试 images/1315204657.WoQvt7-vevfMveZJFbPN4g.{format} 格式，未找到图片文件
[CursorFormatManager] 执行更新 - range: {19, 0}
[UnifiedFormatManager] detectFormatState - position: 19, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 19, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 19
[NativeEditorContext]   - 光标位置: 19
[NativeEditorContext]   - 选中范围: location=19, length=0
[NativeEditorContext]   ✅ 有效位置: 18
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 17
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSParagraphStyle", "NSFont", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: Helvetica
[NativeEditorContext]   - 字体大小: 12.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 12.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 48989473..., 标题: 旧版格式测试, 当前缓存数: 3
[PinnedNoteRowContent] 点击笔记 - ID: 48989473..., 当前选中: 48716783, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48989473924063264
[PinnedNoteRowContent] 设置 selectedNote 为 48989473...
[NotesListView] 📊 selectedNote 变化: 48716783 -> 48989473
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48716783..., 标题: 测试图片上
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafb980
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafbac0
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafbc00
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 325
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 325
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48716783... 切换到: 48989473...
[笔记切换] 📝 捕获的标题: 测试图片上
[笔记切换] 📝 原始标题: 测试图片上
[笔记切换] 📏 捕获的内容长度: 325
[笔记切换] 📏 lastSavedXMLContent 长度: 325
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.mqD6sEiru5CFpGR0vUZaMA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafb980
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iTQ9Lbgh5CmBeiFYu9YVfA'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafbac0
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.WoQvt7-vevfMveZJFbPN4g'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caafbc00
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 325
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 325 到 238
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48989473924063264
[StateTransition] noteSelection: folder(0 -> 0), note(48716783932425280 -> 48989473924063264)
[ViewStateCoordinator] 笔记选择完成: 旧版格式测试
[笔记切换] 📝 后台保存内容 - 长度: 325
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 325 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.16ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.04ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.16ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.32ms
[XMLNormalizer] 📏 规范化后内容长度: 250 字符
[XMLNormalizer] ⏱️ 总耗时: 0.72ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 325 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.11ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.04ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.14ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.32ms
[XMLNormalizer] 📏 规范化后内容长度: 250 字符
[XMLNormalizer] ⏱️ 总耗时: 0.63ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=325, 保存=325
[内容检测] 📏 规范化后长度: 当前=250, 保存=250
[内容检测] ⏱️ 检测耗时: 1.37ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 1.40ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48989473..., 标题: 旧版格式测试
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 旧版格式测试
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48989473..., 标题: 旧版格式测试
[保存状态] 🔄 笔记切换 - 重置为已保存
[MemoryCache] 缓存命中 - ID: 48989473..., 标题: 旧版格式测试
[快速切换] 📝 标题已更新: 旧版格式测试
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48989473..., 标题: 旧版格式测试
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: '111'
[XMLParser]   - 清理后: '111'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[XMLParser]   - description: '111'
[XMLParser]   - imgshow: '1'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ASTToAttributedStringConverter]   - description: '111'
[ASTToAttributedStringConverter]   - imgshow: '1'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: '111'
[ImageAttachment]   - imgshow: '1'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e440
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: jpg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e580
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpg - 不存在
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 5
[LocalStorage]   - fileType: jpg
[NativeEditorContext]   - nsAttributed.string: '
￼

￼'
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {1, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[NativeEditorContext] 🖼️ 发现附件 2: ImageAttachment at range {4, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[NativeEditorContext] 🖼️ 总共发现 2 个附件，其中 2 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fileType: jpeg
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: png
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: png
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.png - 不存在
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 238, 转换后文本长度: 5
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 238
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.gif
[NativeEditorView] 更新内容 - 当前长度: 19, 新长度: 5, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48989473...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 238
[快速切换] ✅ 从缓存加载完成 - ID: 48989473..., 标题: 旧版格式测试, 内容长度: 238
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48989473...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48989473...
[NativeEditorContext] 验证内容持久化，预期内容长度: 238
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[AttributedStringToASTConverter]   - imageDescription: '111'
[AttributedStringToASTConverter]   - imgshow: '1'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e440
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e580
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 238
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 238
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48989473...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 238
[快速切换] ✅ 从缓存加载完成 - ID: 48989473..., 标题: 旧版格式测试, 内容长度: 238
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48989473...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48989473...
[NativeEditorContext] 验证内容持久化，预期内容长度: 238
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[AttributedStringToASTConverter]   - imageDescription: '111'
[AttributedStringToASTConverter]   - imgshow: '1'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e440
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e580
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 238
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 238
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ❌ 无法加载图片: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] ❌ 仅尝试 images/1315204657.cFYt7E8dlMa6S8NUle35qQ.{format} 格式，未找到图片文件
[ImageAttachment] ❌ 无法加载图片: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment] ❌ 仅尝试 images/1315204657.ndABXG0hUb_58bwnnrJaJw.{format} 格式，未找到图片文件
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 5
[NativeEditorView]   - 加载前 范围 {0, 5}: Helvetica, italic=false
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 5}: Helvetica, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.69ms
[NativeEditorView] 更新内容 - 当前长度: 5, 新长度: 5, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e440
[ImageAttachment]   - imageBounds: (21.0, 696.0, 500.0, 666.0)
[ImageAttachment]   - characterIndex: 1
[ImageAttachment]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: '111'
[XMLParser]   - 清理后: '111'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[XMLParser]   - description: '111'
[XMLParser]   - imgshow: '1'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ASTToAttributedStringConverter]   - description: '111'
[ASTToAttributedStringConverter]   - imgshow: '1'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: '111'
[ImageAttachment]   - imgshow: '1'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24d7c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: jpg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24c8c0
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpg - 不存在
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 5
[NativeEditorContext]   - nsAttributed.string: '
￼

￼'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {1, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpeg
[NativeEditorContext] 🖼️ 发现附件 2: ImageAttachment at range {4, 1}
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg - 不存在
[LocalStorage]   - fileType: png
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpeg
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.png
[NativeEditorContext] 🖼️ 总共发现 2 个附件，其中 2 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg - 不存在
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: gif
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: png
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png - 不存在
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 238, 转换后文本长度: 5
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 238
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: '111'
[XMLParser]   - 清理后: '111'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[XMLParser]   - description: '111'
[XMLParser]   - imgshow: '1'
[XMLParser] 📝 解析图片: imgdes 属性不存在
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser]   - description: 'nil'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ASTToAttributedStringConverter]   - description: '111'
[ASTToAttributedStringConverter]   - imgshow: '1'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: '111'
[ImageAttachment]   - imgshow: '1'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24c640
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: jpg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ASTToAttributedStringConverter]   - description: 'nil'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'nil'
[ImageAttachment]   - imgshow: '0'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: jpeg
[ImageAttachment]   - 附件对象地址: 0x00000009c9542940
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 5
[NativeEditorContext]   - nsAttributed.string: '
￼

￼'
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {1, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[LocalStorage]   - fileType: jpg
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[NativeEditorContext] 🖼️ 发现附件 2: ImageAttachment at range {4, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext] 🖼️ 总共发现 2 个附件，其中 2 个是 ImageAttachment
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.ndABXG0hUb_58bwnnrJaJw
[LocalStorage]   - fileType: gif
[保存状态] 📝 内容变化 - 设置为未保存
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg - 不存在
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.ndABXG0hUb_58bwnnrJaJw.gif - 不存在
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: png
[LocalStorage] ❌ 加载失败: images/1315204657.ndABXG0hUb_58bwnnrJaJw.gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: gif
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 238, 转换后文本长度: 5
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 238
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif
[NativeEditorWrapper] 初始加载内容 - 长度: 238
[NativeEditorView] 更新内容 - 当前长度: 5, 新长度: 5, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=4, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 708.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009ca24c640
[ImageAttachment]   - imageBounds: (21.0, 696.0, 500.0, 666.0)
[ImageAttachment]   - characterIndex: 1
[ImageAttachment]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment]   - src: 'minote://image/1315204657.ndABXG0hUb_58bwnnrJaJw'
[ImageAttachment] ❌ 无法加载图片: 1315204657.ndABXG0hUb_58bwnnrJaJw
[ImageAttachment] ❌ 仅尝试 images/1315204657.ndABXG0hUb_58bwnnrJaJw.{format} 格式，未找到图片文件
[ImageAttachment] ❌ 无法加载图片: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] ❌ 仅尝试 images/1315204657.cFYt7E8dlMa6S8NUle35qQ.{format} 格式，未找到图片文件
[CursorFormatManager] 执行更新 - range: {5, 0}
[UnifiedFormatManager] detectFormatState - position: 5, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 5, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 5
[NativeEditorContext]   - 光标位置: 5
[NativeEditorContext]   - 选中范围: location=5, length=0
[NativeEditorContext]   ✅ 有效位置: 4
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 3
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSOriginalFont", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: Helvetica
[NativeEditorContext]   - 字体大小: 12.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 12.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 48989118..., 标题: 111测试1
, 当前缓存数: 4
[PinnedNoteRowContent] 点击笔记 - ID: 48989118..., 当前选中: 48989473, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48989118823154752
[PinnedNoteRowContent] 设置 selectedNote 为 48989118...
[NotesListView] 📊 selectedNote 变化: 48989473 -> 48989118
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48989473..., 标题: 旧版格式测试
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[AttributedStringToASTConverter]   - imageDescription: '111'
[AttributedStringToASTConverter]   - imgshow: '1'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24c640
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009c9542940
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 238
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 238
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48989473... 切换到: 48989118...
[笔记切换] 📝 捕获的标题: 旧版格式测试
[笔记切换] 📝 原始标题: 旧版格式测试
[笔记切换] 📏 捕获的内容长度: 238
[笔记切换] 📏 lastSavedXMLContent 长度: 238
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.ndABXG0hUb_58bwnnrJaJw'
[AttributedStringToASTConverter]   - imageDescription: '111'
[AttributedStringToASTConverter]   - imgshow: '1'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24c640
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: 'nil'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009c9542940
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 238
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 238 到 137
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48989118823154752
[StateTransition] noteSelection: folder(0 -> 0), note(48989473924063264 -> 48989118823154752)
[ViewStateCoordinator] 笔记选择完成: 111测试1

[笔记切换] 📝 后台保存内容 - 长度: 238
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 238 字符
[XMLNormalizer] 🔍 检查 imgdes: '111', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: '111'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.13ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.12ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.25ms
[XMLNormalizer] 📏 规范化后内容长度: 188 字符
[XMLNormalizer] ⏱️ 总耗时: 0.57ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 238 字符
[XMLNormalizer] 🔍 检查 imgdes: '111', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: '111'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.08ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.11ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.24ms
[XMLNormalizer] 📏 规范化后内容长度: 188 字符
[XMLNormalizer] ⏱️ 总耗时: 0.49ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=238, 保存=238
[内容检测] 📏 规范化后长度: 当前=188, 保存=188
[内容检测] ⏱️ 检测耗时: 1.08ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 1.11ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48989118..., 标题: 111测试1

[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 111测试1

[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48989118..., 标题: 111测试1

[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 111测试1

[MemoryCache] 缓存命中 - ID: 48989118..., 标题: 111测试1

[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48989118..., 标题: 111测试1

[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: 'description'
[XMLParser]   - 清理后: 'description'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[XMLParser]   - description: 'description'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ASTToAttributedStringConverter]   - description: 'description'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'description'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caaf97c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 7
[NativeEditorContext]   - nsAttributed.string: '￼

1212'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg - 存在
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {3, 4}: '1212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 137, 转换后文本长度: 7
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 137
[LocalStorage] ✅ 加载图片成功: 1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg, 大小: 2502606 字节
[LocalStorage] ✅ 加载成功: images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg
[NativeEditorView] 更新内容 - 当前长度: 5, 新长度: 7, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1ed80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48989118...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 137
[快速切换] ✅ 从缓存加载完成 - ID: 48989118..., 标题: 111测试1
, 内容长度: 137
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48989118...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48989118...
[NativeEditorContext] 验证内容持久化，预期内容长度: 137
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[AttributedStringToASTConverter]   - imageDescription: 'description'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf97c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 162
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 162
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48989118...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 137
[快速切换] ✅ 从缓存加载完成 - ID: 48989118..., 标题: 111测试1
, 内容长度: 137
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48989118...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48989118...
[NativeEditorContext] 验证内容持久化，预期内容长度: 137
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[AttributedStringToASTConverter]   - imageDescription: 'description'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf97c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 162
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 162
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ✅ 图片加载成功: 1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg, 尺寸: (3072.0, 4096.0)
[ImageAttachment] ✅ 已更新 self.image
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 7
[NativeEditorView]   - 加载前 范围 {0, 3}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {3, 4}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 3}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {3, 4}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 2.04ms
[NativeEditorView] 更新内容 - 当前长度: 7, 新长度: 7, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caaf97c0
[ImageAttachment]   - imageBounds: (0.0, 666.6666666666666, 500.0, 666.6666666666666)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: 'description'
[XMLParser]   - 清理后: 'description'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[XMLParser]   - description: 'description'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ASTToAttributedStringConverter]   - description: 'description'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'description'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caaf8f00
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[LocalStorage]   - fullFileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[NativeEditorContext]   - nsAttributed.length: 7
[NativeEditorContext]   - nsAttributed.string: '￼

1212'
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {3, 4}: '1212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg - 存在
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 137, 转换后文本长度: 7
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 137
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: 'description'
[XMLParser]   - 清理后: 'description'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[XMLParser]   - description: 'description'
[XMLParser]   - imgshow: '0'
[LocalStorage] ✅ 加载图片成功: 1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg, 大小: 2502606 字节
[LocalStorage] ✅ 加载成功: images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ASTToAttributedStringConverter]   - description: 'description'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'description'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caaf9cc0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 7
[NativeEditorContext]   - nsAttributed.string: '￼

1212'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpg - 不存在
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[LocalStorage] ❌ 加载失败: images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[LocalStorage]   - fullFileId: 1315204657.RSgsGMIo2QYlsy-vb_2lXw
[LocalStorage]   - fileType: jpeg
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg - 存在
[NativeEditorContext]   - 范围 {3, 4}: '1212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 137, 转换后文本长度: 7
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 137
[LocalStorage] ✅ 加载图片成功: 1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg, 大小: 2502606 字节
[LocalStorage] ✅ 加载成功: images/1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg
[NativeEditorWrapper] 初始加载内容 - 长度: 137
[NativeEditorView] 更新内容 - 当前长度: 7, 新长度: 7, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caaf9cc0
[ImageAttachment]   - imageBounds: (0.0, 150.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment]   - src: 'minote://image/1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[ImageAttachment] ✅ 图片加载成功: 1315204657.RSgsGMIo2QYlsy-vb_2lXw.jpeg, 尺寸: (3072.0, 4096.0)
[ImageAttachment] ✅ 已更新 self.image
[CursorFormatManager] 执行更新 - range: {7, 0}
[UnifiedFormatManager] detectFormatState - position: 7, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 7, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 7
[NativeEditorContext]   - 光标位置: 7
[NativeEditorContext]   - 选中范围: location=7, length=0
[NativeEditorContext]   ✅ 有效位置: 6
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 5
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 49006034..., 标题: ceshi, 当前缓存数: 5
[PinnedNoteRowContent] 点击笔记 - ID: 49006034..., 当前选中: 48989118, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 49006034077892704
[PinnedNoteRowContent] 设置 selectedNote 为 49006034...
[NotesListView] 📊 selectedNote 变化: 48989118 -> 49006034
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48989118..., 标题: 111测试1

[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[AttributedStringToASTConverter]   - imageDescription: 'description'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf9cc0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 162
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 162
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48989118... 切换到: 49006034...
[笔记切换] 📝 捕获的标题: 111测试1

[笔记切换] 📝 原始标题: 111测试1

[笔记切换] 📏 捕获的内容长度: 162
[笔记切换] 📏 lastSavedXMLContent 长度: 137
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.RSgsGMIo2QYlsy-vb_2lXw'
[AttributedStringToASTConverter]   - imageDescription: 'description'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf9cc0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 162
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 137 到 102
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=49006034077892704
[StateTransition] noteSelection: folder(0 -> 0), note(48989118823154752 -> 49006034077892704)
[ViewStateCoordinator] 笔记选择完成: ceshi
[笔记切换] 📝 后台保存内容 - 长度: 162
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 162 字符
[XMLNormalizer] 🔍 检查 imgdes: 'description', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: 'description'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.12ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.10ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.16ms
[XMLNormalizer] 📏 规范化后内容长度: 137 字符
[XMLNormalizer] ⏱️ 总耗时: 0.44ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 137 字符
[XMLNormalizer] 🔍 检查 imgdes: 'description', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: 'description'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.07ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.15ms
[XMLNormalizer] 📏 规范化后内容长度: 137 字符
[XMLNormalizer] ⏱️ 总耗时: 0.32ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=162, 保存=137
[内容检测] 📏 规范化后长度: 当前=137, 保存=137
[内容检测] ⏱️ 检测耗时: 0.78ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ℹ️ 原始内容有差异（25 字符），但规范化后相同 - 这是格式化差异
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 1.01ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 49006034..., 标题: ceshi
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: ceshi
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 49006034..., 标题: ceshi
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: ceshi
[MemoryCache] 缓存命中 - ID: 49006034..., 标题: ceshi
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 49006034..., 标题: ceshi
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: '“2”'
[XMLParser]   - 清理后: '“2”'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser]   - description: '“2”'
[XMLParser]   - imgshow: '“1”'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ASTToAttributedStringConverter]   - description: '“2”'
[ASTToAttributedStringConverter]   - imgshow: '“1”'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: '“2”'
[ImageAttachment]   - imgshow: '“1”'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24c8c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 1
[NativeEditorContext]   - nsAttributed.string: '￼'
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 102, 转换后文本长度: 1
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 102
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif
[NativeEditorView] 更新内容 - 当前长度: 7, 新长度: 1, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 49006034...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 102
[快速切换] ✅ 从缓存加载完成 - ID: 49006034..., 标题: ceshi, 内容长度: 102
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49006034...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49006034...
[NativeEditorContext] 验证内容持久化，预期内容长度: 102
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: '“2”'
[AttributedStringToASTConverter]   - imgshow: '“1”'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24c8c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 102
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 102
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 49006034...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 102
[快速切换] ✅ 从缓存加载完成 - ID: 49006034..., 标题: ceshi, 内容长度: 102
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49006034...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49006034...
[NativeEditorContext] 验证内容持久化，预期内容长度: 102
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: '“2”'
[AttributedStringToASTConverter]   - imgshow: '“1”'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24c8c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 102
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 102
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ❌ 无法加载图片: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] ❌ 仅尝试 images/1315204657.cFYt7E8dlMa6S8NUle35qQ.{format} 格式，未找到图片文件
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 1
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.69ms
[NativeEditorView] 更新内容 - 当前长度: 1, 新长度: 1, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009ca24c8c0
[ImageAttachment]   - imageBounds: (21.0, 515.0, 500.0, 499.0)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: '“2”'
[XMLParser]   - 清理后: '“2”'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser]   - description: '“2”'
[XMLParser]   - imgshow: '“1”'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ASTToAttributedStringConverter]   - description: '“2”'
[ASTToAttributedStringConverter]   - imgshow: '“1”'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: '“2”'
[ImageAttachment]   - imgshow: '“1”'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e1c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 1
[NativeEditorContext]   - nsAttributed.string: '￼'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 102, 转换后文本长度: 1
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: png
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 102
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png - 不存在
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: '“2”'
[XMLParser]   - 清理后: '“2”'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[XMLParser]   - description: '“2”'
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[XMLParser]   - imgshow: '“1”'
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: gif
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ASTToAttributedStringConverter]   - description: '“2”'
[ASTToAttributedStringConverter]   - imgshow: '“1”'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif - 不存在
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - folderId: '0'
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif
[ImageAttachment]   - imageDescription: '“2”'
[ImageAttachment]   - imgshow: '“1”'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e6c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 1
[NativeEditorContext]   - nsAttributed.string: '￼'
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[保存状态] 📝 内容变化 - 设置为未保存
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: png
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage]   - fullFileId: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.cFYt7E8dlMa6S8NUle35qQ.gif
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 102, 转换后文本长度: 1
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 102
[NativeEditorWrapper] 初始加载内容 - 长度: 102
[NativeEditorView] 更新内容 - 当前长度: 1, 新长度: 1, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 503.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e6c0
[ImageAttachment]   - imageBounds: (21.0, 515.0, 500.0, 499.0)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment]   - src: 'minote://image/1315204657.cFYt7E8dlMa6S8NUle35qQ'
[ImageAttachment] ❌ 无法加载图片: 1315204657.cFYt7E8dlMa6S8NUle35qQ
[ImageAttachment] ❌ 仅尝试 images/1315204657.cFYt7E8dlMa6S8NUle35qQ.{format} 格式，未找到图片文件
[CursorFormatManager] 执行更新 - range: {1, 0}
[UnifiedFormatManager] detectFormatState - position: 1, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 1, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 1
[NativeEditorContext]   - 光标位置: 1
[NativeEditorContext]   - 选中范围: location=1, length=0
[NativeEditorContext]   ✅ 有效位置: 0
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSFont", "NSAttachment"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: Helvetica
[NativeEditorContext]   - 字体大小: 12.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 12.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 48978102..., 标题: 新笔记, 当前缓存数: 6
[PinnedNoteRowContent] 点击笔记 - ID: 48978102..., 当前选中: 49006034, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48978102269526848
[PinnedNoteRowContent] 设置 selectedNote 为 48978102...
[NotesListView] 📊 selectedNote 变化: 49006034 -> 48978102
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 49006034..., 标题: ceshi
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: '“2”'
[AttributedStringToASTConverter]   - imgshow: '“1”'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e6c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 102
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 102
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 49006034... 切换到: 48978102...
[笔记切换] 📝 捕获的标题: ceshi
[笔记切换] 📝 原始标题: ceshi
[笔记切换] 📏 捕获的内容长度: 102
[笔记切换] 📏 lastSavedXMLContent 长度: 102
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.cFYt7E8dlMa6S8NUle35qQ'
[AttributedStringToASTConverter]   - imageDescription: '“2”'
[AttributedStringToASTConverter]   - imgshow: '“1”'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e6c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 102
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 102 到 485
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48978102269526848
[StateTransition] noteSelection: folder(0 -> 0), note(49006034077892704 -> 48978102269526848)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 102
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 102 字符
[XMLNormalizer] 🔍 检查 imgdes: '“2”', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: '“2”'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.12ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.16ms
[XMLNormalizer] 📏 规范化后内容长度: 77 字符
[XMLNormalizer] ⏱️ 总耗时: 0.39ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 102 字符
[XMLNormalizer] 🔍 检查 imgdes: '“2”', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: '“2”'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.04ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.15ms
[XMLNormalizer] 📏 规范化后内容长度: 77 字符
[XMLNormalizer] ⏱️ 总耗时: 0.29ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=102, 保存=102
[内容检测] 📏 规范化后长度: 当前=77, 保存=77
[内容检测] ⏱️ 检测耗时: 0.70ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.73ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48978102..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48978102..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[MemoryCache] 缓存命中 - ID: 48978102..., 标题: 新笔记
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48978102..., 标题: 新笔记
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: 'ces'
[XMLParser]   - 清理后: 'ces'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[XMLParser]   - description: 'ces'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ASTToAttributedStringConverter]   - description: 'ces'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'ces'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009caaf9f40
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[LocalStorage]   - fileType: jpg
[NativeEditorContext]   - nsAttributed.length: 53
[NativeEditorContext]   - nsAttributed.string: '￼113331
￼11111212
￼1212122
￼12121
1
1

2211
￼
3
1
1
￼'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpg
[NativeEditorContext] 🖼️ 发现附件 2: InteractiveCheckboxAttachment at range {8, 1}
[NativeEditorContext] 🖼️ 发现附件 3: InteractiveCheckboxAttachment at range {18, 1}
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {27, 1}
[NativeEditorContext] 🖼️ 发现附件 5: HorizontalRuleAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 发现附件 6: ImageAttachment at range {52, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[NativeEditorContext] 🖼️ 总共发现 6 个附件，其中 1 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg - 存在
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 6}: '113331'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9, 8}: '11111212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 7}: '1212122'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {28, 5}: '12121'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {34, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {36, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {39, 4}: '2211'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {46, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {48, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] ✅ 加载图片成功: 1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg, 大小: 161587 字节
[NativeEditorContext]   - 范围 {50, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] ✅ 加载成功: images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 485, 转换后文本长度: 53
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 485
[NativeEditorView] 更新内容 - 当前长度: 1, 新长度: 53, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=53, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48978102...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 485
[快速切换] ✅ 从缓存加载完成 - ID: 48978102..., 标题: 新笔记, 内容长度: 485
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48978102...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48978102...
[NativeEditorContext] 验证内容持久化，预期内容长度: 485
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[AttributedStringToASTConverter]   - imageDescription: 'ces'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf9f40
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 485
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 485
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48978102...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 485
[快速切换] ✅ 从缓存加载完成 - ID: 48978102..., 标题: 新笔记, 内容长度: 485
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48978102...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48978102...
[NativeEditorContext] 验证内容持久化，预期内容长度: 485
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[AttributedStringToASTConverter]   - imageDescription: 'ces'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009caaf9f40
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 485
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 485
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ✅ 图片加载成功: 1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg, 尺寸: (1920.0, 864.0)
[ImageAttachment] ✅ 已更新 self.image
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 53
[NativeEditorView]   - 加载前 范围 {0, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {1, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {9, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {17, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {19, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {26, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {28, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {33, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {34, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {35, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {36, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {37, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {39, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {43, 3}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {46, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {47, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {48, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {49, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载前 范围 {50, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {51, 2}: Helvetica, italic=false
[NativeTextView] setSelectedRange 被调用: location=53, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {1, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {9, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {17, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {19, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {26, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {28, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {33, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {34, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {35, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {36, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {37, 2}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {39, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {43, 3}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {46, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {47, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {48, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {49, 1}: Helvetica, italic=false
[NativeEditorView]   - 加载后 范围 {50, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {51, 2}: Helvetica, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 20.32ms
[NativeEditorView] 更新内容 - 当前长度: 53, 新长度: 53, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=53, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=53, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009caaf9f40
[ImageAttachment]   - imageBounds: (21.0, 570.0, 500.0, 225.00000000000003)
[ImageAttachment]   - characterIndex: 52
[ImageAttachment]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: 'ces'
[XMLParser]   - 清理后: 'ces'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[XMLParser]   - description: 'ces'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ASTToAttributedStringConverter]   - description: 'ces'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'ces'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24da40
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 53
[NativeEditorContext]   - nsAttributed.string: '￼113331
￼11111212
￼1212122
￼12121
1
1

2211
￼
3
1
1
￼'
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 2: InteractiveCheckboxAttachment at range {8, 1}
[NativeEditorContext] 🖼️ 发现附件 3: InteractiveCheckboxAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {27, 1}
[NativeEditorContext] 🖼️ 发现附件 5: HorizontalRuleAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 发现附件 6: ImageAttachment at range {52, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[NativeEditorContext] 🖼️ 总共发现 6 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 6}: '113331'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpg - 不存在
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] ❌ 加载失败: images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpg
[NativeEditorContext]   - 范围 {9, 8}: '11111212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[LocalStorage]   - fileType: jpeg
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 7}: '1212122'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {28, 5}: '12121'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg - 存在
[NativeEditorContext]   - 范围 {34, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {36, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {39, 4}: '2211'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {46, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {48, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {50, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] ✅ 加载图片成功: 1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg, 大小: 161587 字节
[LocalStorage] ✅ 加载成功: images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 485, 转换后文本长度: 53
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 485
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: 'ces'
[XMLParser]   - 清理后: 'ces'
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[XMLParser]   - description: 'ces'
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ASTToAttributedStringConverter]   - description: 'ces'
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: 'ces'
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e440
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 53
[NativeEditorContext]   - nsAttributed.string: '￼113331
￼11111212
￼1212122
￼12121
1
1

2211
￼
3
1
1
￼'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: InteractiveCheckboxAttachment at range {8, 1}
[NativeEditorContext] 🖼️ 发现附件 3: InteractiveCheckboxAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {27, 1}
[NativeEditorContext] 🖼️ 发现附件 5: HorizontalRuleAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 发现附件 6: ImageAttachment at range {52, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[NativeEditorContext] 🖼️ 总共发现 6 个附件，其中 1 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.iWIa7HjEEF53X3XD8vvm5Q
[LocalStorage]   - fileType: jpeg
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg - 存在
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[LocalStorage] ✅ 加载图片成功: 1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg, 大小: 161587 字节
[LocalStorage] ✅ 加载成功: images/1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 6}: '113331'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9, 8}: '11111212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 7}: '1212122'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {28, 5}: '12121'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {34, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {36, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {39, 4}: '2211'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {46, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {48, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {50, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 485, 转换后文本长度: 53
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 485
[NativeEditorWrapper] 初始加载内容 - 长度: 485
[NativeEditorView] 更新内容 - 当前长度: 53, 新长度: 53, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=53, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=53, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 53, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=53, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=52, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 343.0, 504.0, 229.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009ca24e440
[ImageAttachment]   - imageBounds: (21.0, 570.0, 500.0, 225.0)
[ImageAttachment]   - characterIndex: 52
[ImageAttachment]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment]   - src: 'minote://image/1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[ImageAttachment] ✅ 图片加载成功: 1315204657.iWIa7HjEEF53X3XD8vvm5Q.jpeg, 尺寸: (1920.0, 864.0)
[ImageAttachment] ✅ 已更新 self.image
[CursorFormatManager] 执行更新 - range: {53, 0}
[UnifiedFormatManager] detectFormatState - position: 53, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 53, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 53
[NativeEditorContext]   - 光标位置: 53
[NativeEditorContext]   - 选中范围: location=53, length=0
[NativeEditorContext]   ✅ 有效位置: 52
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 51
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSParagraphStyle", "NSOriginalFont", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: Helvetica
[NativeEditorContext]   - 字体大小: 12.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 12.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 49006032..., 标题: 新笔记, 当前缓存数: 7
[PinnedNoteRowContent] 点击笔记 - ID: 49006032..., 当前选中: 48978102, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 49006032516170336
[PinnedNoteRowContent] 设置 selectedNote 为 49006032...
[NotesListView] 📊 selectedNote 变化: 48978102 -> 49006032
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48978102..., 标题: 新笔记
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[AttributedStringToASTConverter]   - imageDescription: 'ces'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e440
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 485
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 485
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48978102... 切换到: 49006032...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 485
[笔记切换] 📏 lastSavedXMLContent 长度: 485
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.iWIa7HjEEF53X3XD8vvm5Q'
[AttributedStringToASTConverter]   - imageDescription: 'ces'
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009ca24e440
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 485
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 485 到 24
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=49006032516170336
[StateTransition] noteSelection: folder(0 -> 0), note(48978102269526848 -> 49006032516170336)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 485
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 485 字符
[XMLNormalizer] 🔍 检查 imgdes: 'ces', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: 'ces'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.11ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.29ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.39ms
[XMLNormalizer] 📏 规范化后内容长度: 460 字符
[XMLNormalizer] ⏱️ 总耗时: 0.89ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 485 字符
[XMLNormalizer] 🔍 检查 imgdes: 'ces', isEmpty: false
[XMLNormalizer] ✅ 保留 imgdes: 'ces'
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.29ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.38ms
[XMLNormalizer] 📏 规范化后内容长度: 460 字符
[XMLNormalizer] ⏱️ 总耗时: 0.81ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=485, 保存=485
[内容检测] 📏 规范化后长度: 当前=460, 保存=460
[内容检测] ⏱️ 检测耗时: 1.72ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ℹ️ 原始内容有差异（0 字符），但规范化后相同 - 这是格式化差异
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 1.76ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 49006032..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 49006032..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 49006032..., 标题: 新笔记
[MemoryCache] 缓存命中 - ID: 49006032..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 0
[NativeEditorContext]   - nsAttributed.string: ''
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 24, 转换后文本长度: 0
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 24
[NativeEditorView] 更新内容 - 当前长度: 53, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 49006032...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 24
[快速切换] ✅ 从缓存加载完成 - ID: 49006032..., 标题: 新笔记, 内容长度: 24
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49006032...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49006032...
[NativeEditorContext] 验证内容持久化，预期内容长度: 24
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 0
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 49006032...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 24
[快速切换] ✅ 从缓存加载完成 - ID: 49006032..., 标题: 新笔记, 内容长度: 24
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49006032...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49006032...
[NativeEditorContext] 验证内容持久化，预期内容长度: 24
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 0
[持久化验证] 原生编辑器验证结果: 失败
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 0.99ms
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 0
[NativeEditorContext]   - nsAttributed.string: ''
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 24, 转换后文本长度: 0
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 24
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 0
[NativeEditorContext]   - nsAttributed.string: ''
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 24, 转换后文本长度: 0
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 24
[NativeEditorWrapper] 初始加载内容 - 长度: 24
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {0, 0}
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 0, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 0
[NativeEditorContext]   - 光标位置: 0
[NativeEditorContext]   - 选中范围: location=0, length=0
[NativeEditorContext]   ⚠️ 文本为空，清除所有格式
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 49006046..., 标题: 测ceshi, 当前缓存数: 8
[PinnedNoteRowContent] 点击笔记 - ID: 49006046..., 当前选中: 49006032, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 49006046665916640
[PinnedNoteRowContent] 设置 selectedNote 为 49006046...
[NotesListView] 📊 selectedNote 变化: 49006032 -> 49006046
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 49006032..., 标题: 新笔记
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 0
[笔记切换] 📝 使用 currentXMLContent - 长度: 24
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 49006032... 切换到: 49006046...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 24
[笔记切换] 📏 lastSavedXMLContent 长度: 24
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 24 到 98
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=49006046665916640
[StateTransition] noteSelection: folder(0 -> 0), note(49006032516170336 -> 49006046665916640)
[ViewStateCoordinator] 笔记选择完成: 测ceshi
[笔记切换] 📝 后台保存内容 - 长度: 24
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 24 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.06ms
[XMLNormalizer] 📏 规范化后内容长度: 24 字符
[XMLNormalizer] ⏱️ 总耗时: 0.21ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 24 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.00ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.06ms
[XMLNormalizer] 📏 规范化后内容长度: 24 字符
[XMLNormalizer] ⏱️ 总耗时: 0.13ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=24, 保存=24
[内容检测] 📏 规范化后长度: 当前=24, 保存=24
[内容检测] ⏱️ 检测耗时: 0.36ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.39ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 49006046..., 标题: 测ceshi
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 测ceshi
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 49006046..., 标题: 测ceshi
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 测ceshi
[MemoryCache] 缓存命中 - ID: 49006046..., 标题: 测ceshi
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 49006046..., 标题: 测ceshi
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: ''
[XMLParser]   - 清理后: ''
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[XMLParser]   - description: ''
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ASTToAttributedStringConverter]   - description: ''
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: ''
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d4640
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 3
[NativeEditorContext]   - nsAttributed.string: '￼
1'
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {2, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg - 存在
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 98, 转换后文本长度: 3
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 98
[LocalStorage] ✅ 加载图片成功: 1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg, 大小: 1261146 字节
[LocalStorage] ✅ 加载成功: images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 3, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=beforeAttachment
[AttachmentSelectionManager] 光标在附件左边，显示普通光标
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=beforeAttachment
[AttachmentSelectionManager] 光标在附件左边，显示普通光标
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 49006046...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 98
[快速切换] ✅ 从缓存加载完成 - ID: 49006046..., 标题: 测ceshi, 内容长度: 98
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49006046...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49006046...
[NativeEditorContext] 验证内容持久化，预期内容长度: 98
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d4640
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 113
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 113
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 49006046...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 98
[快速切换] ✅ 从缓存加载完成 - ID: 49006046..., 标题: 测ceshi, 内容长度: 98
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49006046...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49006046...
[NativeEditorContext] 验证内容持久化，预期内容长度: 98
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d4640
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 113
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 113
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ✅ 图片加载成功: 1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg, 尺寸: (3072.0, 4096.0)
[ImageAttachment] ✅ 已更新 self.image
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 3
[NativeEditorView]   - 加载前 范围 {2, 1}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {2, 1}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.93ms
[NativeEditorView] 更新内容 - 当前长度: 3, 新长度: 3, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d4640
[ImageAttachment]   - imageBounds: (0.0, 666.6666666666666, 500.0, 666.6666666666666)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: ''
[XMLParser]   - 清理后: ''
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[XMLParser]   - description: ''
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ASTToAttributedStringConverter]   - description: ''
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: ''
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d5540
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 3
[NativeEditorContext]   - nsAttributed.string: '￼
1'
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {2, 1}: '1'
[LocalStorage]   - fullFileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[LocalStorage]   - fileType: jpeg
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg - 存在
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 98, 转换后文本长度: 3
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 98
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: ''
[XMLParser]   - 清理后: ''
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[XMLParser]   - description: ''
[XMLParser]   - imgshow: '0'
[LocalStorage] ✅ 加载图片成功: 1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg, 大小: 1261146 字节
[LocalStorage] ✅ 加载成功: images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ASTToAttributedStringConverter]   - description: ''
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: ''
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d52c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 3
[NativeEditorContext]   - nsAttributed.string: '￼
1'
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.rK-BVySgZSFqJYcpQF3AOQ
[LocalStorage]   - fileType: jpeg
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg - 存在
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {2, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 98, 转换后文本长度: 3
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 98
[NativeEditorWrapper] 初始加载内容 - 长度: 98
[LocalStorage] ✅ 加载图片成功: 1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg, 大小: 1261146 字节
[LocalStorage] ✅ 加载成功: images/1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg
[NativeEditorView] 更新内容 - 当前长度: 3, 新长度: 3, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 3, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d52c0
[ImageAttachment]   - imageBounds: (0.0, 150.0, 200.0, 150.0)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment]   - src: 'minote://image/1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[ImageAttachment] ✅ 图片加载成功: 1315204657.rK-BVySgZSFqJYcpQF3AOQ.jpeg, 尺寸: (3072.0, 4096.0)
[ImageAttachment] ✅ 已更新 self.image
[CursorFormatManager] 执行更新 - range: {3, 0}
[UnifiedFormatManager] detectFormatState - position: 3, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 3, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 3
[NativeEditorContext]   - 光标位置: 3
[NativeEditorContext]   - 选中范围: location=3, length=0
[NativeEditorContext]   ✅ 有效位置: 2
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 1
[NativeEditorContext]   📦 获取到 1 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSColor"]
[NativeEditorContext] ❌ 没有找到 .font 属性，无法继续检测
[NativeEditorContext] ========== 检测结束（无字体） ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 49005878..., 标题: 新笔记121, 当前缓存数: 9
[PinnedNoteRowContent] 点击笔记 - ID: 49005878..., 当前选中: 49006046, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 49005878953525472
[PinnedNoteRowContent] 设置 selectedNote 为 49005878...
[NotesListView] 📊 selectedNote 变化: 49006046 -> 49005878
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 49006046..., 标题: 测ceshi
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d52c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 113
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 113
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 49006046... 切换到: 49005878...
[笔记切换] 📝 捕获的标题: 测ceshi
[笔记切换] 📝 原始标题: 测ceshi
[笔记切换] 📏 捕获的内容长度: 113
[笔记切换] 📏 lastSavedXMLContent 长度: 98
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.rK-BVySgZSFqJYcpQF3AOQ'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d52c0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 113
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 98 到 29
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=49005878953525472
[StateTransition] noteSelection: folder(0 -> 0), note(49006046665916640 -> 49005878953525472)
[ViewStateCoordinator] 笔记选择完成: 新笔记121
[笔记切换] 📝 后台保存内容 - 长度: 113
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 113 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.11ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.07ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.14ms
[XMLNormalizer] 📏 规范化后内容长度: 88 字符
[XMLNormalizer] ⏱️ 总耗时: 0.37ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 98 字符
[XMLNormalizer] 🔍 检查 imgdes: '', isEmpty: true
[XMLNormalizer] ❌ 移除空 imgdes
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.13ms
[XMLNormalizer] 📏 规范化后内容长度: 88 字符
[XMLNormalizer] ⏱️ 总耗时: 0.27ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=113, 保存=98
[内容检测] 📏 规范化后长度: 当前=88, 保存=88
[内容检测] ⏱️ 检测耗时: 0.66ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ℹ️ 原始内容有差异（15 字符），但规范化后相同 - 这是格式化差异
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.91ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 49005878..., 标题: 新笔记121
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记121
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 49005878..., 标题: 新笔记121
[保存状态] 🔄 笔记切换 - 重置为已保存
[MemoryCache] 缓存命中 - ID: 49005878..., 标题: 新笔记121
[快速切换] 📝 标题已更新: 新笔记121
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 49005878..., 标题: 新笔记121
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 5
[NativeEditorContext]   - nsAttributed.string: '12123'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 5}: '12123'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 29, 转换后文本长度: 5
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 29
[NativeEditorView] 更新内容 - 当前长度: 3, 新长度: 5, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=3, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=3, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1ed80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 49005878...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 29
[快速切换] ✅ 从缓存加载完成 - ID: 49005878..., 标题: 新笔记121, 内容长度: 29
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49005878...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49005878...
[NativeEditorContext] 验证内容持久化，预期内容长度: 29
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 29
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 29
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 49005878...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 29
[快速切换] ✅ 从缓存加载完成 - ID: 49005878..., 标题: 新笔记121, 内容长度: 29
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49005878...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49005878...
[NativeEditorContext] 验证内容持久化，预期内容长度: 29
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 29
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 29
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 5
[NativeEditorView]   - 加载前 范围 {0, 5}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 5}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.69ms
[NativeEditorView] 更新内容 - 当前长度: 5, 新长度: 5, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 5
[NativeEditorContext]   - nsAttributed.string: '12123'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 5}: '12123'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 29, 转换后文本长度: 5
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 29
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 5
[NativeEditorContext]   - nsAttributed.string: '12123'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 5}: '12123'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 29, 转换后文本长度: 5
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 29
[NativeEditorWrapper] 初始加载内容 - 长度: 29
[NativeEditorView] 更新内容 - 当前长度: 5, 新长度: 5, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=5, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 5, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=5, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {5, 0}
[UnifiedFormatManager] detectFormatState - position: 5, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 5, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 5
[NativeEditorContext]   - 光标位置: 5
[NativeEditorContext]   - 选中范围: location=5, length=0
[NativeEditorContext]   ✅ 有效位置: 4
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 3
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSParagraphStyle", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 添加缓存 - ID: 49003902..., 标题: 未命名笔记_49003902292345696, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 49013776..., 标题: 112你哈
[MemoryCache] 添加缓存 - ID: 48986921..., 标题: 新笔记, 当前缓存数: 10
[预加载] 悬停预加载完成 - ID: 48986921...
[MemoryCache] 更新缓存 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[PinnedNoteRowContent] 点击笔记 - ID: 49003902..., 当前选中: 49005878, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 49003902292345696
[PinnedNoteRowContent] 设置 selectedNote 为 49003902...
[NotesListView] 📊 selectedNote 变化: 49005878 -> 49003902
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 49005878..., 标题: 新笔记121
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 29
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 29
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 49005878... 切换到: 49003902...
[笔记切换] 📝 捕获的标题: 新笔记121
[笔记切换] 📝 原始标题: 新笔记121
[笔记切换] 📏 捕获的内容长度: 29
[笔记切换] 📏 lastSavedXMLContent 长度: 29
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 29
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 29 到 97
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=49003902292345696
[StateTransition] noteSelection: folder(0 -> 0), note(49005878953525472 -> 49003902292345696)
[ViewStateCoordinator] 笔记选择完成: 未命名笔记_49003902292345696
[笔记切换] 📝 后台保存内容 - 长度: 29
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 29 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.07ms
[XMLNormalizer] 📏 规范化后内容长度: 29 字符
[XMLNormalizer] ⏱️ 总耗时: 0.21ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 29 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.06ms
[XMLNormalizer] 📏 规范化后内容长度: 29 字符
[XMLNormalizer] ⏱️ 总耗时: 0.14ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=29, 保存=29
[内容检测] 📏 规范化后长度: 当前=29, 保存=29
[内容检测] ⏱️ 检测耗时: 0.37ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.47ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[MemoryCache] 缓存命中 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: ''
[XMLParser]   - 清理后: ''
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[XMLParser]   - description: ''
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ASTToAttributedStringConverter]   - description: ''
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: ''
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d4640
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 1
[NativeEditorContext]   - nsAttributed.string: '￼'
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 97, 转换后文本长度: 1
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 97
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.gif
[NativeEditorView] 更新内容 - 当前长度: 5, 新长度: 1, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1ed80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 49003902...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 97
[快速切换] ✅ 从缓存加载完成 - ID: 49003902..., 标题: , 内容长度: 97
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49003902...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49003902...
[NativeEditorContext] 验证内容持久化，预期内容长度: 97
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d4640
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 87
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 87
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 49003902...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 97
[快速切换] ✅ 从缓存加载完成 - ID: 49003902..., 标题: , 内容长度: 97
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 49003902...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 49003902...
[NativeEditorContext] 验证内容持久化，预期内容长度: 97
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d4640
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 87
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 87
[持久化验证] 原生编辑器验证结果: 失败
[ImageAttachment] ❌ 无法加载图片: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment] ❌ 仅尝试 images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.{format} 格式，未找到图片文件
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 1
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.57ms
[NativeEditorView] 更新内容 - 当前长度: 1, 新长度: 1, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 创建高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d4640
[ImageAttachment]   - imageBounds: (21.0, 682.0, 500.0, 666.0)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: ''
[XMLParser]   - 清理后: ''
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[XMLParser]   - description: ''
[XMLParser]   - imgshow: '0'
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ASTToAttributedStringConverter]   - description: ''
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: ''
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d57c0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 1
[NativeEditorContext]   - nsAttributed.string: '￼'
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: jpeg
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 97, 转换后文本长度: 1
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 97
[LocalStorage]   - fileType: png
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[XMLParser] 📝 解析图片描述:
[XMLParser]   - 原始值: ''
[XMLParser]   - 清理后: ''
[XMLParser] 📝 创建 ImageNode:
[XMLParser]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[XMLParser]   - description: ''
[XMLParser]   - imgshow: '0'
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.gif
[ASTToAttributedStringConverter] 📝 转换图片:
[ASTToAttributedStringConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ASTToAttributedStringConverter]   - description: ''
[ASTToAttributedStringConverter]   - imgshow: '0'
[ImageAttachment] 📝 初始化（立即加载）:
[ImageAttachment]   - src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - folderId: '0'
[ImageAttachment]   - imageDescription: ''
[ImageAttachment]   - imgshow: '0'
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d5cc0
[ImageAttachment] 🖼️ setupPlaceholder - 设置占位符图片
[ImageAttachment] 🖼️ startLoadingImage 被调用
[ImageAttachment] 🖼️ 使用 fileId 加载: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment] 🖼️ loadImageFromLocalStorage 开始
[ImageAttachment]   - fileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment]   - folderId: 0（已废弃，不再使用）
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 1
[NativeEditorContext]   - nsAttributed.string: '￼'
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: jpg
[NativeEditorContext] 🖼️ 发现附件 1: ImageAttachment at range {0, 1}
[NativeEditorContext]   - ImageAttachment.fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[NativeEditorContext]   - ImageAttachment.src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 1 个是 ImageAttachment
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: jpeg
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpeg - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.jpeg
[LocalStorage] 🖼️ 加载图片（统一格式）:
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: png
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 97, 转换后文本长度: 1
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 97
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.png - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.png
[LocalStorage] 🖼️ 加载图片（统一格式）:
[NativeEditorWrapper] 初始加载内容 - 长度: 97
[LocalStorage]   - fullFileId: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[LocalStorage]   - fileType: gif
[LocalStorage] 🖼️ getImageURL: /Users/acckion/Library/Application Support/com.minote.MiNoteMac/images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.gif - 不存在
[LocalStorage] ❌ 加载失败: images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.gif
[NativeEditorView] 更新内容 - 当前长度: 1, 新长度: 1, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] setSelectedRange 被调用: location=1, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 1, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=1, length=0
[AttachmentSelectionManager] 检测到附件: ImageAttachment, index=0, position=afterAttachment
[AttachmentSelectionManager] 光标在附件右边，显示高亮并隐藏光标
[AttachmentSelectionManager] 附件显示区域: (19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 更新高亮视图，frame=(19.0, 14.0, 504.0, 670.0)
[AttachmentSelectionManager] 使用描边样式
[AttachmentSelectionManager] 显示高亮，alphaValue=1.0
[AttachmentSelectionManager] 已隐藏光标
[保存状态] 📝 内容变化 - 设置为未保存
[ImageAttachment] 🖼️ image(forBounds:) 首次调用
[ImageAttachment]   - 附件对象地址: 0x00000009cb8d5cc0
[ImageAttachment]   - imageBounds: (21.0, 682.0, 500.0, 666.0)
[ImageAttachment]   - characterIndex: 0
[ImageAttachment]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment]   - src: 'minote://image/1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[ImageAttachment] ❌ 无法加载图片: 1315204657.gqZFv_EaUwNHLKFNPKSGTw
[ImageAttachment] ❌ 仅尝试 images/1315204657.gqZFv_EaUwNHLKFNPKSGTw.{format} 格式，未找到图片文件
[CursorFormatManager] 执行更新 - range: {1, 0}
[UnifiedFormatManager] detectFormatState - position: 1, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 1, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 1
[NativeEditorContext]   - 光标位置: 1
[NativeEditorContext]   - 选中范围: location=1, length=0
[NativeEditorContext]   ✅ 有效位置: 0
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSAttachment", "NSColor", "NSOriginalFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: Helvetica
[NativeEditorContext]   - 字体大小: 12.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 12.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 48986921..., 标题: 新笔记
[预加载] 悬停预加载完成 - ID: 48986921...
[MemoryCache] 移除LRU缓存 - ID: 48716783..., 标题: 测试图片上
[MemoryCache] 添加缓存 - ID: 48978154..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48989473..., 标题: 旧版格式测试
[MemoryCache] 添加缓存 - ID: 48966095..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 更新缓存 - ID: 48978154..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48986921..., 标题: 新笔记
[预加载] 悬停预加载完成 - ID: 48986921...
[PinnedNoteRowContent] 点击笔记 - ID: 48986921..., 当前选中: 49003902, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48986921876472960
[PinnedNoteRowContent] 设置 selectedNote 为 48986921...
[NotesListView] 📊 selectedNote 变化: 49003902 -> 48986921
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d5cc0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 87
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 87
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 49003902... 切换到: 48986921...
[笔记切换] 📝 捕获的标题: 
[笔记切换] 📝 原始标题: 
[笔记切换] 📏 捕获的内容长度: 87
[笔记切换] 📏 lastSavedXMLContent 长度: 97
[笔记切换] ═══════════════════════════════════════
[AttributedStringToASTConverter] 📝 提取图片属性:
[AttributedStringToASTConverter]   - fileId: '1315204657.gqZFv_EaUwNHLKFNPKSGTw'
[AttributedStringToASTConverter]   - imageDescription: ''
[AttributedStringToASTConverter]   - imgshow: '0'
[AttributedStringToASTConverter]   - 附件对象地址: 0x00000009cb8d5cc0
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 87
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 97 到 0
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48986921876472960
[StateTransition] noteSelection: folder(0 -> 0), note(49003902292345696 -> 48986921876472960)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 87
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 87 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.10ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.14ms
[XMLNormalizer] 📏 规范化后内容长度: 62 字符
[XMLNormalizer] ⏱️ 总耗时: 0.34ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 97 字符
[XMLNormalizer] 🔍 检查 imgdes: '', isEmpty: true
[XMLNormalizer] ❌ 移除空 imgdes
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.13ms
[XMLNormalizer] 📏 规范化后内容长度: 62 字符
[XMLNormalizer] ⏱️ 总耗时: 0.25ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=87, 保存=97
[内容检测] 📏 规范化后长度: 当前=62, 保存=62
[内容检测] ⏱️ 检测耗时: 0.61ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ℹ️ 原始内容有差异（10 字符），但规范化后相同 - 这是格式化差异
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.80ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48986921..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48986921..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48986921..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48986921..., 标题: 新笔记
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorWrapper] 原生编辑器清空内容
[NativeEditorView] 更新内容 - 当前长度: 1, 新长度: 0, 版本变化: false
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1ed80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48986921...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 0
[快速切换] ✅ 从缓存加载完成 - ID: 48986921..., 标题: 新笔记, 内容长度: 0
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48986921...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48986921...
[NativeEditorContext] 验证内容持久化，预期内容长度: 0
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 0
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48986921...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 0
[快速切换] ✅ 从缓存加载完成 - ID: 48986921..., 标题: 新笔记, 内容长度: 0
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48986921...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48986921...
[NativeEditorContext] 验证内容持久化，预期内容长度: 0
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 0
[持久化验证] 原生编辑器验证结果: 失败
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 0.91ms
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[CursorFormatManager] 执行更新 - range: {0, 0}
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 0, state: FormatState(段落: 正文, 对齐: 左对齐)
[MemoryCache] 更新缓存 - ID: 48978154..., 标题: 新笔记
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 0
[NativeEditorContext]   - 光标位置: 0
[NativeEditorContext]   - 选中范围: location=0, length=0
[NativeEditorContext]   ⚠️ 文本为空，清除所有格式
[NativeEditorContext] ========================================
[PinnedNoteRowContent] 点击笔记 - ID: 48978154..., 当前选中: 48986921, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48978154174825504
[PinnedNoteRowContent] 设置 selectedNote 为 48978154...
[NotesListView] 📊 selectedNote 变化: 48986921 -> 48978154
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48986921..., 标题: 新笔记
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 0
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48986921... 切换到: 48978154...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 0
[笔记切换] 📏 lastSavedXMLContent 长度: 0
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 0 到 1302
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48978154174825504
[StateTransition] noteSelection: folder(0 -> 0), note(48986921876472960 -> 48978154174825504)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 0
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 0 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.00ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.05ms
[XMLNormalizer] 📏 规范化后内容长度: 0 字符
[XMLNormalizer] ⏱️ 总耗时: 0.15ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 0 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.00ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.04ms
[XMLNormalizer] 📏 规范化后内容长度: 0 字符
[XMLNormalizer] ⏱️ 总耗时: 0.09ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=0, 保存=0
[内容检测] 📏 规范化后长度: 当前=0, 保存=0
[内容检测] ⏱️ 检测耗时: 0.25ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.28ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48978154..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48978154..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48978154..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48978154..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 380
[NativeEditorContext]   - nsAttributed.string: '第一行1111111111111111111111111111111111111111111
111111
22323323232323232323232324322222222343454353554354545454545444444444444444435553453453453453453451212111121121213它啊发你手机发你f b sai u b fu id s b k f s d k f b1b j s d n f即老师的福利呢slainlsa dn la s l d111111111111n n1你奶奶121n
三大111
￼1

￼1

￼12111￼￼


￼11

￼33
￼1111
￼131

￼11
￼222
￼22
￼33
￼1
￼2
￼111
￼121
￼1232423若23r s d f v s d v11'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {279, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {283, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {287, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {298, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {303, 1}
[NativeEditorContext] 🖼️ 发现附件 6: BulletAttachment at range {307, 1}
[NativeEditorContext] 🖼️ 发现附件 7: BulletAttachment at range {313, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {319, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {323, 1}
[NativeEditorContext] 🖼️ 发现附件 10: OrderAttachment at range {328, 1}
[NativeEditorContext] 🖼️ 发现附件 11: OrderAttachment at range {332, 1}
[NativeEditorContext] 🖼️ 发现附件 12: OrderAttachment at range {336, 1}
[NativeEditorContext] 🖼️ 发现附件 13: OrderAttachment at range {339, 1}
[NativeEditorContext] 🖼️ 发现附件 14: OrderAttachment at range {342, 1}
[NativeEditorContext] 🖼️ 发现附件 15: OrderAttachment at range {347, 1}
[NativeEditorContext] 🖼️ 发现附件 16: InteractiveCheckboxAttachment at range {352, 1}
[NativeEditorContext] 🖼️ 总共发现 16 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 3}: '第一行'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {3, 11}: '11111111111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14, 32}: '11111111111111111111111111111111'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {47, 6}: '111111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {54, 218}: '22323323232323232323232324322222222343454353554354545454545444444444444444435553453453453453453451212111121121213它啊发你手机发你f b sai u b fu id s b k f s d k f b1b j s d n f即老师的福利呢slainlsa dn la s l d111111111111n n1你奶奶121n'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {273, 5}: '三大111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {280, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {284, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {288, 7}: '12111￼￼'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {299, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {304, 2}: '33'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {308, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {314, 3}: '131'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {320, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {324, 3}: '222'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {329, 2}: '22'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {333, 2}: '33'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {337, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {340, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {343, 3}: '111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {348, 3}: '121'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {353, 27}: '1232423若23r s d f v s d v11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 1302, 转换后文本长度: 380
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 1302
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 380, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=380, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1ed80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48978154...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 1302
[快速切换] ✅ 从缓存加载完成 - ID: 48978154..., 标题: 新笔记, 内容长度: 1302
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48978154...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48978154...
[NativeEditorContext] 验证内容持久化，预期内容长度: 1302
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 1302
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 1302
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48978154...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 1302
[快速切换] ✅ 从缓存加载完成 - ID: 48978154..., 标题: 新笔记, 内容长度: 1302
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48978154...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48978154...
[NativeEditorContext] 验证内容持久化，预期内容长度: 1302
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 1302
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 1302
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 380
[NativeEditorView]   - 加载前 范围 {0, 3}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {3, 11}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14, 32}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {47, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {54, 218}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {273, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {280, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {284, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {288, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {299, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {304, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {308, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {314, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {320, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {324, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {329, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {333, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {337, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {340, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {343, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {348, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {353, 27}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=380, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 3}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {3, 11}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14, 32}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {47, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {54, 218}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {273, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {280, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {284, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {288, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {299, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {304, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {308, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {314, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {320, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {324, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {329, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {333, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {337, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {340, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {343, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {348, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {353, 27}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 19.93ms
[NativeEditorView] 更新内容 - 当前长度: 380, 新长度: 380, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=380, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=380, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 380
[NativeEditorContext]   - nsAttributed.string: '第一行1111111111111111111111111111111111111111111
111111
22323323232323232323232324322222222343454353554354545454545444444444444444435553453453453453453451212111121121213它啊发你手机发你f b sai u b fu id s b k f s d k f b1b j s d n f即老师的福利呢slainlsa dn la s l d111111111111n n1你奶奶121n
三大111
￼1

￼1

￼12111￼￼


￼11

￼33
￼1111
￼131

￼11
￼222
￼22
￼33
￼1
￼2
￼111
￼121
￼1232423若23r s d f v s d v11'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {279, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {283, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {287, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {298, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {303, 1}
[NativeEditorContext] 🖼️ 发现附件 6: BulletAttachment at range {307, 1}
[NativeEditorContext] 🖼️ 发现附件 7: BulletAttachment at range {313, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {319, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {323, 1}
[NativeEditorContext] 🖼️ 发现附件 10: OrderAttachment at range {328, 1}
[NativeEditorContext] 🖼️ 发现附件 11: OrderAttachment at range {332, 1}
[NativeEditorContext] 🖼️ 发现附件 12: OrderAttachment at range {336, 1}
[NativeEditorContext] 🖼️ 发现附件 13: OrderAttachment at range {339, 1}
[NativeEditorContext] 🖼️ 发现附件 14: OrderAttachment at range {342, 1}
[NativeEditorContext] 🖼️ 发现附件 15: OrderAttachment at range {347, 1}
[NativeEditorContext] 🖼️ 发现附件 16: InteractiveCheckboxAttachment at range {352, 1}
[NativeEditorContext] 🖼️ 总共发现 16 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 3}: '第一行'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {3, 11}: '11111111111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14, 32}: '11111111111111111111111111111111'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {47, 6}: '111111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {54, 218}: '22323323232323232323232324322222222343454353554354545454545444444444444444435553453453453453453451212111121121213它啊发你手机发你f b sai u b fu id s b k f s d k f b1b j s d n f即老师的福利呢slainlsa dn la s l d111111111111n n1你奶奶121n'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {273, 5}: '三大111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {280, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {284, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {288, 7}: '12111￼￼'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {299, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {304, 2}: '33'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {308, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {314, 3}: '131'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {320, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {324, 3}: '222'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {329, 2}: '22'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {333, 2}: '33'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {337, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {340, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {343, 3}: '111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {348, 3}: '121'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {353, 27}: '1232423若23r s d f v s d v11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 1302, 转换后文本长度: 380
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 1302
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 380
[NativeEditorContext]   - nsAttributed.string: '第一行1111111111111111111111111111111111111111111
111111
22323323232323232323232324322222222343454353554354545454545444444444444444435553453453453453453451212111121121213它啊发你手机发你f b sai u b fu id s b k f s d k f b1b j s d n f即老师的福利呢slainlsa dn la s l d111111111111n n1你奶奶121n
三大111
￼1

￼1

￼12111￼￼


￼11

￼33
￼1111
￼131

￼11
￼222
￼22
￼33
￼1
￼2
￼111
￼121
￼1232423若23r s d f v s d v11'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {279, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {283, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {287, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {298, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {303, 1}
[NativeEditorContext] 🖼️ 发现附件 6: BulletAttachment at range {307, 1}
[NativeEditorContext] 🖼️ 发现附件 7: BulletAttachment at range {313, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {319, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {323, 1}
[NativeEditorContext] 🖼️ 发现附件 10: OrderAttachment at range {328, 1}
[NativeEditorContext] 🖼️ 发现附件 11: OrderAttachment at range {332, 1}
[NativeEditorContext] 🖼️ 发现附件 12: OrderAttachment at range {336, 1}
[NativeEditorContext] 🖼️ 发现附件 13: OrderAttachment at range {339, 1}
[NativeEditorContext] 🖼️ 发现附件 14: OrderAttachment at range {342, 1}
[NativeEditorContext] 🖼️ 发现附件 15: OrderAttachment at range {347, 1}
[NativeEditorContext] 🖼️ 发现附件 16: InteractiveCheckboxAttachment at range {352, 1}
[NativeEditorContext] 🖼️ 总共发现 16 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 3}: '第一行'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {3, 11}: '11111111111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14, 32}: '11111111111111111111111111111111'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {47, 6}: '111111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {54, 218}: '22323323232323232323232324322222222343454353554354545454545444444444444444435553453453453453453451212111121121213它啊发你手机发你f b sai u b fu id s b k f s d k f b1b j s d n f即老师的福利呢slainlsa dn la s l d111111111111n n1你奶奶121n'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {273, 5}: '三大111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {280, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {284, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {288, 7}: '12111￼￼'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {299, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {304, 2}: '33'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {308, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {314, 3}: '131'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {320, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {324, 3}: '222'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {329, 2}: '22'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {333, 2}: '33'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {337, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {340, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {343, 3}: '111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {348, 3}: '121'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {353, 27}: '1232423若23r s d f v s d v11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 1302, 转换后文本长度: 380
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 1302
[NativeEditorWrapper] 初始加载内容 - 长度: 1302
[NativeEditorView] 更新内容 - 当前长度: 380, 新长度: 380, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=380, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=380, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 380, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=380, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {380, 0}
[UnifiedFormatManager] detectFormatState - position: 380, state: FormatState(段落: 复选框, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 4
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["复选框"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 复选框, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 380, state: FormatState(段落: 复选框, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 380
[NativeEditorContext]   - 光标位置: 380
[NativeEditorContext]   - 选中范围: location=380, length=0
[NativeEditorContext]   ✅ 有效位置: 379
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 378
[NativeEditorContext]   📦 获取到 7 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "checkboxLevel", "NSParagraphStyle", "listIndent", "checkboxChecked", "listType", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext] detectListFormats - 检测到 listType: MiNoteLibrary.ListType.checkbox
[NativeEditorContext] detectListFormats - 检测到复选框 (ListType.checkbox)
[NativeEditorContext]   ✅ 列表格式检测完成: ["复选框"]
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["复选框"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["复选框"]
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["复选框"]
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] 检测到格式: 复选框
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 48966095..., 标题: 新笔记
[PinnedNoteRowContent] 点击笔记 - ID: 48966095..., 当前选中: 48978154, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48966095882175040
[PinnedNoteRowContent] 设置 selectedNote 为 48966095...
[NotesListView] 📊 selectedNote 变化: 48978154 -> 48966095
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48978154..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 1302
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 1302
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48978154... 切换到: 48966095...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 1302
[笔记切换] 📏 lastSavedXMLContent 长度: 1302
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 1302
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 1302 到 462
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48966095882175040
[StateTransition] noteSelection: folder(0 -> 0), note(48978154174825504 -> 48966095882175040)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 1302
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 1302 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.07ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.15ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.76ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 7.98ms
[XMLNormalizer] 📏 规范化后内容长度: 1302 字符
[XMLNormalizer] ⏱️ 总耗时: 9.01ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 1302 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.04ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.15ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.77ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 8.04ms
[XMLNormalizer] 📏 规范化后内容长度: 1302 字符
[XMLNormalizer] ⏱️ 总耗时: 9.06ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=1302, 保存=1302
[内容检测] 📏 规范化后长度: 当前=1302, 保存=1302
[内容检测] ⏱️ 检测耗时: 18.10ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 18.15ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48966095..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48966095..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48966095..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48966095..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 47
[NativeEditorContext]   - nsAttributed.string: '￼有
￼序1
￼77
￼2
￼
￼
￼1111
￼444
￼1
￼无序
￼2
￼3
￼
￼45'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {3, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {7, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {11, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {14, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {16, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {24, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {29, 1}
[NativeEditorContext] 🖼️ 发现附件 10: BulletAttachment at range {32, 1}
[NativeEditorContext] 🖼️ 发现附件 11: BulletAttachment at range {36, 1}
[NativeEditorContext] 🖼️ 发现附件 12: BulletAttachment at range {39, 1}
[NativeEditorContext] 🖼️ 发现附件 13: BulletAttachment at range {42, 1}
[NativeEditorContext] 🖼️ 发现附件 14: BulletAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 总共发现 14 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 1}: '有'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4, 2}: '序1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {25, 3}: '444'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {30, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {33, 2}: '无序'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {37, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {40, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {45, 2}: '45'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 462, 转换后文本长度: 47
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 462
[NativeEditorView] 更新内容 - 当前长度: 380, 新长度: 47, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48966095...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 462
[快速切换] ✅ 从缓存加载完成 - ID: 48966095..., 标题: 新笔记, 内容长度: 462
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48966095...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48966095...
[NativeEditorContext] 验证内容持久化，预期内容长度: 462
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 462
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48966095...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 462
[快速切换] ✅ 从缓存加载完成 - ID: 48966095..., 标题: 新笔记, 内容长度: 462
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48966095...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48966095...
[NativeEditorContext] 验证内容持久化，预期内容长度: 462
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 462
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 47
[NativeEditorView]   - 加载前 范围 {1, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {19, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {25, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {30, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {33, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {37, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {40, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {45, 2}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {1, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {19, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {25, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {30, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {33, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {37, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {40, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {45, 2}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 2.48ms
[NativeEditorView] 更新内容 - 当前长度: 47, 新长度: 47, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 47
[NativeEditorContext]   - nsAttributed.string: '￼有
￼序1
￼77
￼2
￼
￼
￼1111
￼444
￼1
￼无序
￼2
￼3
￼
￼45'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {3, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {7, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {11, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {14, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {16, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {24, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {29, 1}
[NativeEditorContext] 🖼️ 发现附件 10: BulletAttachment at range {32, 1}
[NativeEditorContext] 🖼️ 发现附件 11: BulletAttachment at range {36, 1}
[NativeEditorContext] 🖼️ 发现附件 12: BulletAttachment at range {39, 1}
[NativeEditorContext] 🖼️ 发现附件 13: BulletAttachment at range {42, 1}
[NativeEditorContext] 🖼️ 发现附件 14: BulletAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 总共发现 14 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 1}: '有'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4, 2}: '序1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {25, 3}: '444'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {30, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {33, 2}: '无序'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {37, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {40, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {45, 2}: '45'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 462, 转换后文本长度: 47
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 462
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 47
[NativeEditorContext]   - nsAttributed.string: '￼有
￼序1
￼77
￼2
￼
￼
￼1111
￼444
￼1
￼无序
￼2
￼3
￼
￼45'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {3, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {7, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {11, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {14, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {16, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {24, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {29, 1}
[NativeEditorContext] 🖼️ 发现附件 10: BulletAttachment at range {32, 1}
[NativeEditorContext] 🖼️ 发现附件 11: BulletAttachment at range {36, 1}
[NativeEditorContext] 🖼️ 发现附件 12: BulletAttachment at range {39, 1}
[NativeEditorContext] 🖼️ 发现附件 13: BulletAttachment at range {42, 1}
[NativeEditorContext] 🖼️ 发现附件 14: BulletAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 总共发现 14 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 1}: '有'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4, 2}: '序1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {25, 3}: '444'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {30, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {33, 2}: '无序'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {37, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {40, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {45, 2}: '45'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 462, 转换后文本长度: 47
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 462
[NativeEditorWrapper] 初始加载内容 - 长度: 462
[NativeEditorView] 更新内容 - 当前长度: 47, 新长度: 47, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {47, 0}
[UnifiedFormatManager] detectFormatState - position: 47, state: FormatState(段落: 无序列表, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 4
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["无序列表"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 无序列表, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 47, state: FormatState(段落: 无序列表, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 47
[NativeEditorContext]   - 光标位置: 47
[NativeEditorContext]   - 选中范围: location=47, length=0
[NativeEditorContext]   ✅ 有效位置: 46
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 45
[NativeEditorContext]   📦 获取到 5 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "listType", "listIndent", "NSParagraphStyle", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext] detectListFormats - 检测到 listType: MiNoteLibrary.ListType.bullet
[NativeEditorContext] detectListFormats - 检测到无序列表 (ListType.bullet)
[NativeEditorContext]   ✅ 列表格式检测完成: ["无序列表"]
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["无序列表"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["无序列表"]
[NativeEditorContext] ✅ 检测到 bulletList 格式，返回段落样式: 【unorderedList】(无序列表)
[NativeEditorContext] ========== 段落样式转换完成: unorderedList ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["无序列表"]
[NativeEditorContext] ✅ 检测到 bulletList 格式，返回段落样式: 【unorderedList】(无序列表)
[NativeEditorContext] ========== 段落样式转换完成: unorderedList ==========
[NativeEditorContext] 检测到格式: 无序列表
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 移除LRU缓存 - ID: 48989118..., 标题: 111测试1

[MemoryCache] 添加缓存 - ID: 48970847..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 49006034..., 标题: ceshi
[MemoryCache] 添加缓存 - ID: 48976637..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48978102..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 48977865..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 更新缓存 - ID: 48976637..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48970847..., 标题: 新笔记
[PinnedNoteRowContent] 点击笔记 - ID: 48970847..., 当前选中: 48966095, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48970847743525760
[PinnedNoteRowContent] 设置 selectedNote 为 48970847...
[NotesListView] 📊 selectedNote 变化: 48966095 -> 48970847
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48966095..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 462
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48966095... 切换到: 48970847...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 462
[笔记切换] 📏 lastSavedXMLContent 长度: 462
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 462 到 22931
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48970847743525760
[StateTransition] noteSelection: folder(0 -> 0), note(48966095882175040 -> 48970847743525760)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 462
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 462 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.38ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.43ms
[XMLNormalizer] 📏 规范化后内容长度: 462 字符
[XMLNormalizer] ⏱️ 总耗时: 0.97ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 462 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.33ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.42ms
[XMLNormalizer] 📏 规范化后内容长度: 462 字符
[XMLNormalizer] ⏱️ 总耗时: 0.86ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=462, 保存=462
[内容检测] 📏 规范化后长度: 当前=462, 保存=462
[内容检测] ⏱️ 检测耗时: 1.85ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 1.89ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48970847..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48970847..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48970847..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48970847..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 15237
[NativeEditorContext]   - nsAttributed.string: '[NativeEditorContext] 内1容变化检测 - 长度: 134, hasUnsavedChanges: true
[CursorFormatManager] 执行更新 - range: {60, 0}
[UnifiedFormatManager] detectFormatState - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["三级标题"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 三级标题, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSFont", "NSParagraphStyle", "NSOriginalFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
显示格式菜单
  - isUsingNativeEditor: true
  - 使用原生编辑器格式菜单
[NativeEditorContext] requestContentSync 被调用
[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示
[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示
[NativeEditorContext] requestContentSync 被调用
[NativeEditorView] syncContentToContext: 同步内容
[NativeEditorView]   - textStorage.length: 134
[NativeEditorView]   - 选择范围: {60, 0}
[NativeEditorView]   - 位置 60 的属性数量: 4
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs (
    28L,
    56L,
    84L,
    112L,
    140L,
    168L,
    196L,
    224L,
    252L,
    280L,
    308L,
    336L
), DefaultTabInterval 0, Blocks (
), Lists (
), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (
) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"
[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0
[NativeEditorView]     - 是否粗体: false
[NativeEditorView]     - 是否斜体: false
[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true
[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)
[NativeEditorView] syncContentToContext: 同步内容
[NativeEditorView]   - textStorage.length: 134
[NativeEditorView]   - 选择范围: {60, 0}
[NativeEditorView]   - 位置 60 的属性数量: 4
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs (
    28L,
    56L,
    84L,
    112L,
    140L,
    168L,
    196L,
    224L,
    252L,
    280L,
    308L,
    336L
), DefaultTabInterval 0, Blocks (
), Lists (
), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (
) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"
[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0
[NativeEditorView]     - 是否粗体: false
[NativeEditorView]     - 是否斜体: false
[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true
[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] forceUpdateFormats 被调用
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] 清除标题格式，恢复为正文样式
[NativeEditorContext] 开始重置字体大小为正文大小（14.0pt）
[NativeEditorContext]   ⚠️ 没有选中文本，跳过字体大小重置
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSParagraphStyle", "NSColor", "NSOriginalFont", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=subtitle
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 标题格式已清除，字体大小已重置为 13pt
[VIEWMODEL] 应用变为后台
[VIEWMODEL] 停止自动同步定时器'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 64}: '[NativeEditorContext] 内1容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {65, 43}: '[CursorFormatManager] 执行更新 - range: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {109, 94}: '[UnifiedFormatManager] detectFormatState - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {204, 52}: '[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {257, 41}: '[CursorFormatManager] 同步 typingAttributes'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {299, 50}: '[CursorFormatManager] typingAttributes 已更新，属性数量: 2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {350, 29}: '[CursorFormatManager] 更新工具栏状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {380, 45}: '[CursorFormatManager] 工具栏状态已更新，激活格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {426, 83}: '[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {510, 51}: '[CursorFormatManager] 已触发 NativeFormatProvider 状态更新'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {562, 84}: '[CursorFormatManager] 光标模式更新完成 - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {647, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {710, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {746, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {809, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {845, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {880, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {934, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {969, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1008, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1057, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1094, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1157, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1194, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1257, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1310, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSFont", "NSParagraphStyle", "NSOriginalFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1417, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1448, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1506, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1545, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1602, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1640, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1710, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1775, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1839, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1884, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1923, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1962, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2001, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2040, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2103, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2149, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2212, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2268, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2307, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2372, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2435, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2491, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2530, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2595, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2658, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2692, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2755, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2788, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2851, 6}: '显示格式菜单'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2858, 29}: '  - isUsingNativeEditor: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2888, 15}: '  - 使用原生编辑器格式菜单'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2904, 44}: '[NativeEditorContext] requestContentSync 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2949, 108}: '[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3058, 108}: '[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3167, 44}: '[NativeEditorContext] requestContentSync 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3212, 45}: '[NativeEditorView] syncContentToContext: 同步内容'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3258, 46}: '[NativeEditorView]   - textStorage.length: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3305, 36}: '[NativeEditorView]   - 选择范围: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3342, 37}: '[NativeEditorView]   - 位置 60 的属性数量: 4'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3380, 142}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3523, 100}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3624, 279}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3904, 8}: '    28L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3913, 8}: '    56L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3922, 8}: '    84L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3931, 9}: '    112L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3941, 9}: '    140L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3951, 9}: '    168L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3961, 9}: '    196L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3971, 9}: '    224L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3981, 9}: '    252L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3991, 9}: '    280L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4001, 9}: '    308L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4011, 8}: '    336L'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4020, 33}: '), DefaultTabInterval 0, Blocks ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4054, 10}: '), Lists ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4065, 138}: '), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4204, 52}: ') ListIntentOrdinal 0 CodeBlockIntentLanguageHint '''
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4257, 143}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4401, 57}: '[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4459, 36}: '[NativeEditorView]     - 是否粗体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4496, 36}: '[NativeEditorView]     - 是否斜体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4533, 63}: '[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4597, 71}: '[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4669, 45}: '[NativeEditorView] syncContentToContext: 同步内容'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4715, 46}: '[NativeEditorView]   - textStorage.length: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4762, 36}: '[NativeEditorView]   - 选择范围: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4799, 37}: '[NativeEditorView]   - 位置 60 的属性数量: 4'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4837, 142}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4980, 100}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5081, 279}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5361, 8}: '    28L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5370, 8}: '    56L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5379, 8}: '    84L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5388, 9}: '    112L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5398, 9}: '    140L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5408, 9}: '    168L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5418, 9}: '    196L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5428, 9}: '    224L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5438, 9}: '    252L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5448, 9}: '    280L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5458, 9}: '    308L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5468, 8}: '    336L'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5477, 33}: '), DefaultTabInterval 0, Blocks ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5511, 10}: '), Lists ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5522, 138}: '), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5661, 52}: ') ListIntentOrdinal 0 CodeBlockIntentLanguageHint '''
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5714, 143}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5858, 57}: '[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5916, 36}: '[NativeEditorView]     - 是否粗体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5953, 36}: '[NativeEditorView]     - 是否斜体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5990, 63}: '[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6054, 71}: '[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6126, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6189, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6225, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6288, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6324, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6359, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6413, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6448, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6487, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6536, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6573, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6636, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6673, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6736, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6789, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6896, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6927, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6985, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7024, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7081, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7119, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7189, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7254, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7318, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7363, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7402, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7441, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7480, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7519, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7582, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7628, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7691, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7747, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7786, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7851, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7914, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7970, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8009, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8074, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8137, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8171, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8234, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8267, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8330, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8393, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8429, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8492, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8528, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8563, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8617, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8652, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8691, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8740, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8777, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8840, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8877, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8940, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8993, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9100, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9131, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9189, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9228, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9285, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9323, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9393, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9458, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9522, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9567, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9606, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9645, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9684, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9723, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9786, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9832, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9895, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9951, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9990, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10055, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10118, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10174, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10213, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10278, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10341, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10375, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10438, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10471, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10534, 44}: '[NativeEditorContext] forceUpdateFormats 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10579, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10642, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10678, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10741, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10777, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10812, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10866, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10901, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10940, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10989, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11026, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11089, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11126, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11189, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11242, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11349, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11380, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11438, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11477, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11534, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11572, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11642, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11707, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11771, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11816, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11855, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11894, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11933, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11972, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12035, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12081, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12144, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12200, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12239, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12304, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12367, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12423, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12462, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12527, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12590, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12624, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12687, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12720, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12783, 36}: '[NativeEditorContext] 清除标题格式，恢复为正文样式'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12820, 43}: '[NativeEditorContext] 开始重置字体大小为正文大小（14.0pt）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12864, 42}: '[NativeEditorContext]   ⚠️ 没有选中文本，跳过字体大小重置'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12907, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12970, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13006, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13069, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13105, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13140, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13194, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13229, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13268, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13317, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13354, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13417, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13454, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13517, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13570, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSParagraphStyle", "NSColor", "NSOriginalFont", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13677, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13708, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13766, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13805, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13862, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13900, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13970, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14035, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14099, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14144, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14183, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14222, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14261, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14300, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14363, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14409, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14472, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14528, 32}: '[NativeEditorContext] 输入格式集合: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14561, 56}: '[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14618, 58}: '[NativeEditorContext] ========== 段落样式转换完成: body =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14677, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14733, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14772, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14837, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14900, 57}: '[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=subtitle'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14958, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14992, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15055, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15088, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15151, 45}: '[NativeEditorContext] ✅ 标题格式已清除，字体大小已重置为 13pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15197, 18}: '[VIEWMODEL] 应用变为后台'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15216, 21}: '[VIEWMODEL] 停止自动同步定时器'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 22931, 转换后文本长度: 15237
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 22931
[NativeEditorView] 更新内容 - 当前长度: 47, 新长度: 15237, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=15237, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=15237, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=15237, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c8d1d180> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48970847...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 22931
[快速切换] ✅ 从缓存加载完成 - ID: 48970847..., 标题: 新笔记, 内容长度: 22931
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48970847...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48970847...
[NativeEditorContext] 验证内容持久化，预期内容长度: 22931
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 22931
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 22931
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48970847...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 22931
[快速切换] ✅ 从缓存加载完成 - ID: 48970847..., 标题: 新笔记, 内容长度: 22931
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48970847...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48970847...
[NativeEditorContext] 验证内容持久化，预期内容长度: 22931
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 22931
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 22931
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 15237
[NativeEditorView]   - 加载前 范围 {0, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {65, 43}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {109, 94}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {204, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {257, 41}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {299, 50}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {350, 29}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {380, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {426, 83}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {510, 51}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {562, 84}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {647, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {710, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {746, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {809, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {845, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {880, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {934, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {969, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1008, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1057, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1094, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1157, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1194, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1257, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1310, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1417, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1448, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1506, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1545, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1602, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1640, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1710, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1775, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1839, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1884, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1923, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {1962, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2001, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2040, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2103, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2149, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2212, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2268, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2307, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2372, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2435, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2491, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2530, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2595, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2658, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2692, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2755, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2788, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2851, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2858, 29}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2888, 15}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2904, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {2949, 108}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3058, 108}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3167, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3212, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3258, 46}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3305, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3342, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3380, 142}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3523, 100}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3624, 279}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3904, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3913, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3922, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3931, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3941, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3951, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3961, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3971, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3981, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3991, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4001, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4011, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4020, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4054, 10}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4065, 138}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4204, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4257, 143}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4401, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4459, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4496, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4533, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4597, 71}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4669, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4715, 46}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4762, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4799, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4837, 142}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4980, 100}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5081, 279}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5361, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5370, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5379, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5388, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5398, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5408, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5418, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5428, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5438, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5448, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5458, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5468, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5477, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5511, 10}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5522, 138}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5661, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5714, 143}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5858, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5916, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5953, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {5990, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6054, 71}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6126, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6189, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6225, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6288, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6324, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6359, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6413, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6448, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6487, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6536, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6573, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6636, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6673, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6736, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6789, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6896, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6927, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {6985, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7024, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7081, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7119, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7189, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7254, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7318, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7363, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7402, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7441, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7480, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7519, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7582, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7628, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7691, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7747, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7786, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7851, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7914, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {7970, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8009, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8074, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8137, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8171, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8234, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8267, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8330, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8393, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8429, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8492, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8528, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8563, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8617, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8652, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8691, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8740, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8777, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8840, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8877, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8940, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8993, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9100, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9131, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9189, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9228, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9285, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9323, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9393, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9458, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9522, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9567, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9606, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9645, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9684, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9723, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9786, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9832, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9895, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9951, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {9990, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10055, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10118, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10174, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10213, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10278, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10341, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10375, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10438, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10471, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10534, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10579, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10642, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10678, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10741, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10777, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10812, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10866, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10901, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10940, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10989, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11026, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11089, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11126, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11189, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11242, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11349, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11380, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11438, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11477, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11534, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11572, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11642, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11707, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11771, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11816, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11855, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11894, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11933, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {11972, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12035, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12081, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12144, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12200, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12239, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12304, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12367, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12423, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12462, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12527, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12590, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12624, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12687, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12720, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12783, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12820, 43}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12864, 42}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12907, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12970, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13006, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13069, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13105, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13140, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13194, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13229, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13268, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13317, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13354, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13417, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13454, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13517, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13570, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13677, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13708, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13766, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13805, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13862, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13900, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {13970, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14035, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14099, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14144, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14183, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14222, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14261, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14300, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14363, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14409, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14472, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14528, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14561, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14618, 58}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14677, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14733, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14772, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14837, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14900, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14958, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {14992, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {15055, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {15088, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {15151, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {15197, 18}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {15216, 21}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=15237, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {65, 43}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {109, 94}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {204, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {257, 41}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {299, 50}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {350, 29}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {380, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {426, 83}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {510, 51}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {562, 84}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {647, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {710, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {746, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {809, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {845, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {880, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {934, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {969, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1008, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1057, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1094, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1157, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1194, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1257, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1310, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1417, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1448, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1506, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1545, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1602, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1640, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1710, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1775, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1839, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1884, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1923, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {1962, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2001, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2040, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2103, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2149, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2212, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2268, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2307, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2372, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2435, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2491, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2530, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2595, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2658, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2692, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2755, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2788, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2851, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2858, 29}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2888, 15}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2904, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {2949, 108}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3058, 108}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3167, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3212, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3258, 46}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3305, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3342, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3380, 142}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3523, 100}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3624, 279}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3904, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3913, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3922, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3931, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3941, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3951, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3961, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3971, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3981, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3991, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4001, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4011, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4020, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4054, 10}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4065, 138}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4204, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4257, 143}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4401, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4459, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4496, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4533, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4597, 71}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4669, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4715, 46}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4762, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4799, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4837, 142}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4980, 100}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5081, 279}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5361, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5370, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5379, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5388, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5398, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5408, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5418, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5428, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5438, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5448, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5458, 9}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5468, 8}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5477, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5511, 10}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5522, 138}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5661, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5714, 143}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5858, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5916, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5953, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {5990, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6054, 71}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6126, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6189, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6225, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6288, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6324, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6359, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6413, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6448, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6487, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6536, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6573, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6636, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6673, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6736, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6789, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6896, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6927, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {6985, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7024, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7081, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7119, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7189, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7254, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7318, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7363, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7402, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7441, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7480, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7519, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7582, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7628, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7691, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7747, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7786, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7851, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7914, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {7970, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8009, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8074, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8137, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8171, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8234, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8267, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8330, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8393, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8429, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8492, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8528, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8563, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8617, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8652, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8691, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8740, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8777, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8840, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8877, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8940, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8993, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9100, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9131, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9189, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9228, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9285, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9323, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9393, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9458, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9522, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9567, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9606, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9645, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9684, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9723, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9786, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9832, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9895, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9951, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {9990, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10055, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10118, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10174, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10213, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10278, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10341, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10375, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10438, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10471, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10534, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10579, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10642, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10678, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10741, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10777, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10812, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10866, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10901, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10940, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10989, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11026, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11089, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11126, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11189, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11242, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11349, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11380, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11438, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11477, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11534, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11572, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11642, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11707, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11771, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11816, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11855, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11894, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11933, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {11972, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12035, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12081, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12144, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12200, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12239, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12304, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12367, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12423, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12462, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12527, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12590, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12624, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12687, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12720, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12783, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12820, 43}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12864, 42}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12907, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12970, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13006, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13069, 35}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13105, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13140, 53}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13194, 34}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13229, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13268, 48}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13317, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13354, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13417, 36}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13454, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13517, 52}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13570, 106}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13677, 30}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13708, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13766, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13805, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13862, 37}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13900, 69}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {13970, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14035, 63}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14099, 44}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14144, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14183, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14222, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14261, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14300, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14363, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14409, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14472, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14528, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14561, 56}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14618, 58}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14677, 55}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14733, 38}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14772, 64}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14837, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14900, 57}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14958, 33}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {14992, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {15055, 32}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {15088, 62}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {15151, 45}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {15197, 18}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {15216, 21}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 23.72ms
[NativeEditorView] 更新内容 - 当前长度: 15237, 新长度: 15237, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=15237, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=15237, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=15237, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[PinnedNoteRowContent] 点击笔记 - ID: 48977865..., 当前选中: 48970847, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48977865941337632
[PinnedNoteRowContent] 设置 selectedNote 为 48977865...
[NotesListView] 📊 selectedNote 变化: 48970847 -> 48977865
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48970847..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 22931
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 22931
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48970847... 切换到: 48977865...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 22931
[笔记切换] 📏 lastSavedXMLContent 长度: 22931
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 22931
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 22931 到 101
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 15237
[NativeEditorContext]   - 光标位置: 15237
[NativeEditorContext]   - 选中范围: location=15237, length=0
[NativeEditorContext]   ✅ 有效位置: 15236
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 15235
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSColor", "NSParagraphStyle"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["无序列表"]
[NativeEditorContext] ✅ 检测到 bulletList 格式，返回段落样式: 【unorderedList】(无序列表)
[NativeEditorContext] ========== 段落样式转换完成: unorderedList ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=body
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 15237
[NativeEditorContext]   - nsAttributed.string: '[NativeEditorContext] 内1容变化检测 - 长度: 134, hasUnsavedChanges: true
[CursorFormatManager] 执行更新 - range: {60, 0}
[UnifiedFormatManager] detectFormatState - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["三级标题"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 三级标题, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSFont", "NSParagraphStyle", "NSOriginalFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
显示格式菜单
  - isUsingNativeEditor: true
  - 使用原生编辑器格式菜单
[NativeEditorContext] requestContentSync 被调用
[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示
[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示
[NativeEditorContext] requestContentSync 被调用
[NativeEditorView] syncContentToContext: 同步内容
[NativeEditorView]   - textStorage.length: 134
[NativeEditorView]   - 选择范围: {60, 0}
[NativeEditorView]   - 位置 60 的属性数量: 4
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs (
    28L,
    56L,
    84L,
    112L,
    140L,
    168L,
    196L,
    224L,
    252L,
    280L,
    308L,
    336L
), DefaultTabInterval 0, Blocks (
), Lists (
), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (
) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"
[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0
[NativeEditorView]     - 是否粗体: false
[NativeEditorView]     - 是否斜体: false
[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true
[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)
[NativeEditorView] syncContentToContext: 同步内容
[NativeEditorView]   - textStorage.length: 134
[NativeEditorView]   - 选择范围: {60, 0}
[NativeEditorView]   - 位置 60 的属性数量: 4
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs (
    28L,
    56L,
    84L,
    112L,
    140L,
    168L,
    196L,
    224L,
    252L,
    280L,
    308L,
    336L
), DefaultTabInterval 0, Blocks (
), Lists (
), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (
) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"
[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0
[NativeEditorView]     - 是否粗体: false
[NativeEditorView]     - 是否斜体: false
[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true
[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] forceUpdateFormats 被调用
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] 清除标题格式，恢复为正文样式
[NativeEditorContext] 开始重置字体大小为正文大小（14.0pt）
[NativeEditorContext]   ⚠️ 没有选中文本，跳过字体大小重置
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSParagraphStyle", "NSColor", "NSOriginalFont", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=subtitle
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 标题格式已清除，字体大小已重置为 13pt
[VIEWMODEL] 应用变为后台
[VIEWMODEL] 停止自动同步定时器'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 64}: '[NativeEditorContext] 内1容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {65, 43}: '[CursorFormatManager] 执行更新 - range: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {109, 94}: '[UnifiedFormatManager] detectFormatState - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {204, 52}: '[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {257, 41}: '[CursorFormatManager] 同步 typingAttributes'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {299, 50}: '[CursorFormatManager] typingAttributes 已更新，属性数量: 2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {350, 29}: '[CursorFormatManager] 更新工具栏状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {380, 45}: '[CursorFormatManager] 工具栏状态已更新，激活格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {426, 83}: '[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {510, 51}: '[CursorFormatManager] 已触发 NativeFormatProvider 状态更新'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {562, 84}: '[CursorFormatManager] 光标模式更新完成 - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {647, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {710, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {746, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {809, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {845, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {880, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {934, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {969, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1008, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1057, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1094, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1157, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1194, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1257, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1310, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSFont", "NSParagraphStyle", "NSOriginalFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1417, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1448, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1506, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1545, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1602, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1640, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1710, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1775, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1839, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1884, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1923, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1962, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2001, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2040, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2103, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2149, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2212, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2268, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2307, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2372, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2435, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2491, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2530, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2595, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2658, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2692, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2755, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2788, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2851, 6}: '显示格式菜单'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2858, 29}: '  - isUsingNativeEditor: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2888, 15}: '  - 使用原生编辑器格式菜单'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2904, 44}: '[NativeEditorContext] requestContentSync 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2949, 108}: '[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3058, 108}: '[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3167, 44}: '[NativeEditorContext] requestContentSync 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3212, 45}: '[NativeEditorView] syncContentToContext: 同步内容'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3258, 46}: '[NativeEditorView]   - textStorage.length: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3305, 36}: '[NativeEditorView]   - 选择范围: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3342, 37}: '[NativeEditorView]   - 位置 60 的属性数量: 4'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3380, 142}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3523, 100}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3624, 279}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3904, 8}: '    28L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3913, 8}: '    56L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3922, 8}: '    84L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3931, 9}: '    112L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3941, 9}: '    140L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3951, 9}: '    168L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3961, 9}: '    196L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3971, 9}: '    224L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3981, 9}: '    252L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3991, 9}: '    280L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4001, 9}: '    308L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4011, 8}: '    336L'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4020, 33}: '), DefaultTabInterval 0, Blocks ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4054, 10}: '), Lists ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4065, 138}: '), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4204, 52}: ') ListIntentOrdinal 0 CodeBlockIntentLanguageHint '''
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4257, 143}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4401, 57}: '[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4459, 36}: '[NativeEditorView]     - 是否粗体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4496, 36}: '[NativeEditorView]     - 是否斜体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4533, 63}: '[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4597, 71}: '[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4669, 45}: '[NativeEditorView] syncContentToContext: 同步内容'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4715, 46}: '[NativeEditorView]   - textStorage.length: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4762, 36}: '[NativeEditorView]   - 选择范围: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4799, 37}: '[NativeEditorView]   - 位置 60 的属性数量: 4'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4837, 142}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4980, 100}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5081, 279}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5361, 8}: '    28L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5370, 8}: '    56L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5379, 8}: '    84L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5388, 9}: '    112L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5398, 9}: '    140L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5408, 9}: '    168L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5418, 9}: '    196L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5428, 9}: '    224L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5438, 9}: '    252L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5448, 9}: '    280L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5458, 9}: '    308L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5468, 8}: '    336L'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5477, 33}: '), DefaultTabInterval 0, Blocks ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5511, 10}: '), Lists ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5522, 138}: '), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5661, 52}: ') ListIntentOrdinal 0 CodeBlockIntentLanguageHint '''
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5714, 143}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5858, 57}: '[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5916, 36}: '[NativeEditorView]     - 是否粗体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5953, 36}: '[NativeEditorView]     - 是否斜体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5990, 63}: '[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6054, 71}: '[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6126, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6189, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6225, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6288, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6324, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6359, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6413, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6448, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6487, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6536, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6573, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6636, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6673, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6736, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6789, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6896, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6927, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6985, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7024, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7081, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7119, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7189, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7254, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7318, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7363, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7402, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7441, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7480, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7519, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7582, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7628, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7691, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7747, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7786, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7851, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7914, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7970, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8009, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8074, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8137, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8171, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8234, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8267, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8330, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8393, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8429, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8492, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8528, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8563, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8617, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8652, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8691, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8740, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8777, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8840, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8877, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8940, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8993, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9100, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9131, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9189, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9228, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9285, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9323, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9393, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9458, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9522, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9567, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9606, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9645, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9684, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9723, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9786, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9832, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9895, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9951, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9990, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10055, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10118, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10174, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10213, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10278, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10341, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10375, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10438, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10471, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10534, 44}: '[NativeEditorContext] forceUpdateFormats 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10579, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10642, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10678, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10741, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10777, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10812, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10866, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10901, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10940, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10989, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11026, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11089, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11126, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11189, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11242, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11349, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11380, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11438, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11477, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11534, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11572, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11642, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11707, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11771, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11816, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11855, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11894, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11933, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11972, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12035, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12081, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12144, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12200, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12239, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12304, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12367, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12423, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12462, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12527, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12590, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12624, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12687, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12720, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12783, 36}: '[NativeEditorContext] 清除标题格式，恢复为正文样式'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12820, 43}: '[NativeEditorContext] 开始重置字体大小为正文大小（14.0pt）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12864, 42}: '[NativeEditorContext]   ⚠️ 没有选中文本，跳过字体大小重置'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12907, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12970, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13006, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13069, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13105, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13140, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13194, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13229, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13268, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13317, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13354, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13417, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13454, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13517, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13570, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSParagraphStyle", "NSColor", "NSOriginalFont", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13677, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13708, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13766, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13805, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13862, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13900, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13970, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14035, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14099, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14144, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14183, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14222, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14261, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14300, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14363, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14409, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14472, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14528, 32}: '[NativeEditorContext] 输入格式集合: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14561, 56}: '[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14618, 58}: '[NativeEditorContext] ========== 段落样式转换完成: body =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14677, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14733, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14772, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14837, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14900, 57}: '[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=subtitle'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14958, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14992, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15055, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15088, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15151, 45}: '[NativeEditorContext] ✅ 标题格式已清除，字体大小已重置为 13pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15197, 18}: '[VIEWMODEL] 应用变为后台'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15216, 21}: '[VIEWMODEL] 停止自动同步定时器'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 22931, 转换后文本长度: 15237
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 22931
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 15237
[NativeEditorContext]   - nsAttributed.string: '[NativeEditorContext] 内1容变化检测 - 长度: 134, hasUnsavedChanges: true
[CursorFormatManager] 执行更新 - range: {60, 0}
[UnifiedFormatManager] detectFormatState - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["三级标题"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 三级标题, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSFont", "NSParagraphStyle", "NSOriginalFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
显示格式菜单
  - isUsingNativeEditor: true
  - 使用原生编辑器格式菜单
[NativeEditorContext] requestContentSync 被调用
[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示
[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示
[NativeEditorContext] requestContentSync 被调用
[NativeEditorView] syncContentToContext: 同步内容
[NativeEditorView]   - textStorage.length: 134
[NativeEditorView]   - 选择范围: {60, 0}
[NativeEditorView]   - 位置 60 的属性数量: 4
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs (
    28L,
    56L,
    84L,
    112L,
    140L,
    168L,
    196L,
    224L,
    252L,
    280L,
    308L,
    336L
), DefaultTabInterval 0, Blocks (
), Lists (
), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (
) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"
[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0
[NativeEditorView]     - 是否粗体: false
[NativeEditorView]     - 是否斜体: false
[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true
[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)
[NativeEditorView] syncContentToContext: 同步内容
[NativeEditorView]   - textStorage.length: 134
[NativeEditorView]   - 选择范围: {60, 0}
[NativeEditorView]   - 位置 60 的属性数量: 4
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs (
    28L,
    56L,
    84L,
    112L,
    140L,
    168L,
    196L,
    224L,
    252L,
    280L,
    308L,
    336L
), DefaultTabInterval 0, Blocks (
), Lists (
), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (
) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''
[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"
[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0
[NativeEditorView]     - 是否粗体: false
[NativeEditorView]     - 是否斜体: false
[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true
[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] forceUpdateFormats 被调用
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] 清除标题格式，恢复为正文样式
[NativeEditorContext] 开始重置字体大小为正文大小（14.0pt）
[NativeEditorContext]   ⚠️ 没有选中文本，跳过字体大小重置
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 134
[NativeEditorContext]   - 光标位置: 60
[NativeEditorContext]   - 选中范围: location=60, length=0
[NativeEditorContext]   ✅ 有效位置: 60
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59
[NativeEditorContext]   📦 获取到 4 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSParagraphStyle", "NSColor", "NSOriginalFont", "NSFont"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular
[NativeEditorContext]   - 字体大小: 17.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】
[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["三级标题"]
[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)
[NativeEditorContext] ========== 段落样式转换完成: subtitle ==========
[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=subtitle
[NativeEditorContext] 检测到格式: 三级标题
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 标题格式已清除，字体大小已重置为 13pt
[VIEWMODEL] 应用变为后台
[VIEWMODEL] 停止自动同步定时器'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 15237, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 64}: '[NativeEditorContext] 内1容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {65, 43}: '[CursorFormatManager] 执行更新 - range: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {109, 94}: '[UnifiedFormatManager] detectFormatState - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {204, 52}: '[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {257, 41}: '[CursorFormatManager] 同步 typingAttributes'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {299, 50}: '[CursorFormatManager] typingAttributes 已更新，属性数量: 2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {350, 29}: '[CursorFormatManager] 更新工具栏状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {380, 45}: '[CursorFormatManager] 工具栏状态已更新，激活格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {426, 83}: '[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {510, 51}: '[CursorFormatManager] 已触发 NativeFormatProvider 状态更新'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {562, 84}: '[CursorFormatManager] 光标模式更新完成 - position: 60, state: FormatState(段落: 三级标题, 对齐: 左对齐)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {647, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {710, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {746, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {809, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {845, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {880, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {934, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {969, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1008, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1057, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1094, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1157, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1194, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1257, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1310, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSFont", "NSParagraphStyle", "NSOriginalFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1417, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1448, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1506, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1545, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1602, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1640, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1710, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1775, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1839, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1884, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1923, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {1962, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2001, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2040, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2103, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2149, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2212, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2268, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2307, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2372, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2435, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2491, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2530, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2595, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2658, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2692, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2755, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2788, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2851, 6}: '显示格式菜单'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2858, 29}: '  - isUsingNativeEditor: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2888, 15}: '  - 使用原生编辑器格式菜单'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2904, 44}: '[NativeEditorContext] requestContentSync 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {2949, 108}: '[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3058, 108}: '[2026-01-14 23:54:12.761] ℹ️ INFO [EditorState] [EditorStateConsistencyChecker] 状态变化: 可编辑 -> 可编辑, 原因: 格式菜单显示'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3167, 44}: '[NativeEditorContext] requestContentSync 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3212, 45}: '[NativeEditorView] syncContentToContext: 同步内容'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3258, 46}: '[NativeEditorView]   - textStorage.length: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3305, 36}: '[NativeEditorView]   - 选择范围: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3342, 37}: '[NativeEditorView]   - 位置 60 的属性数量: 4'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3380, 142}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3523, 100}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3624, 279}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3904, 8}: '    28L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3913, 8}: '    56L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3922, 8}: '    84L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3931, 9}: '    112L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3941, 9}: '    140L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3951, 9}: '    168L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3961, 9}: '    196L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3971, 9}: '    224L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3981, 9}: '    252L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3991, 9}: '    280L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4001, 9}: '    308L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4011, 8}: '    336L'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4020, 33}: '), DefaultTabInterval 0, Blocks ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4054, 10}: '), Lists ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4065, 138}: '), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4204, 52}: ') ListIntentOrdinal 0 CodeBlockIntentLanguageHint '''
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4257, 143}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4401, 57}: '[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4459, 36}: '[NativeEditorView]     - 是否粗体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4496, 36}: '[NativeEditorView]     - 是否斜体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4533, 63}: '[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4597, 71}: '[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4669, 45}: '[NativeEditorView] syncContentToContext: 同步内容'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4715, 46}: '[NativeEditorView]   - textStorage.length: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4762, 36}: '[NativeEditorView]   - 选择范围: {60, 0}'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4799, 37}: '[NativeEditorView]   - 位置 60 的属性数量: 4'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4837, 142}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSOriginalFont): "Helvetica 12.00 pt. P [] (0xca25f6d00) fobj=0xca4296800, spc=3.33"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4980, 100}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSColor): Catalog color: System labelColor'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5081, 279}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSParagraphStyle): Alignment Natural, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0 LineBreakMode WordWrapping, Tabs ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5361, 8}: '    28L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5370, 8}: '    56L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5379, 8}: '    84L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5388, 9}: '    112L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5398, 9}: '    140L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5408, 9}: '    168L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5418, 9}: '    196L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5428, 9}: '    224L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5438, 9}: '    252L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5448, 9}: '    280L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5458, 9}: '    308L,'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5468, 8}: '    336L'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5477, 33}: '), DefaultTabInterval 0, Blocks ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5511, 10}: '), Lists ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5522, 138}: '), BaseWritingDirection Natural, HyphenationFactor 0, TighteningForTruncation YES, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents ('
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5661, 52}: ') ListIntentOrdinal 0 CodeBlockIntentLanguageHint '''
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5714, 143}: '[NativeEditorView]     - NSAttributedStringKey(_rawValue: NSFont): ".AppleSystemUIFont 17.00 pt. P [] (0xca2d61e00) fobj=0xca2d61e00, spc=4.35"'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5858, 57}: '[NativeEditorView]     - 字体: .AppleSystemUIFont, 大小: 17.0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5916, 36}: '[NativeEditorView]     - 是否粗体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5953, 36}: '[NativeEditorView]     - 是否斜体: false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {5990, 63}: '[NativeEditorContext] 内容变化检测 - 长度: 134, hasUnsavedChanges: true'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6054, 71}: '[NativeEditorView] syncContentToContext: nsAttributedText 已更新 (长度: 134)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6126, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6189, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6225, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6288, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6324, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6359, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6413, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6448, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6487, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6536, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6573, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6636, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6673, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6736, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6789, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6896, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6927, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {6985, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7024, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7081, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7119, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7189, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7254, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7318, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7363, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7402, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7441, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7480, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7519, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7582, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7628, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7691, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7747, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7786, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7851, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7914, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {7970, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8009, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8074, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8137, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8171, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8234, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8267, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8330, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8393, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8429, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8492, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8528, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8563, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8617, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8652, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8691, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8740, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8777, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8840, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8877, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8940, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8993, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9100, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9131, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9189, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9228, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9285, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9323, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9393, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9458, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9522, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9567, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9606, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9645, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9684, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9723, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9786, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9832, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9895, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9951, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {9990, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10055, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10118, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10174, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10213, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10278, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10341, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10375, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10438, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10471, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10534, 44}: '[NativeEditorContext] forceUpdateFormats 被调用'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10579, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10642, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10678, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10741, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10777, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10812, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10866, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10901, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10940, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10989, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11026, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11089, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11126, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11189, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11242, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSOriginalFont", "NSColor", "NSParagraphStyle", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11349, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11380, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11438, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11477, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11534, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11572, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11642, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11707, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11771, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11816, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11855, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11894, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11933, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {11972, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12035, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12081, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12144, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12200, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12239, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12304, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12367, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12423, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12462, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12527, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12590, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12624, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12687, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12720, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12783, 36}: '[NativeEditorContext] 清除标题格式，恢复为正文样式'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12820, 43}: '[NativeEditorContext] 开始重置字体大小为正文大小（14.0pt）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12864, 42}: '[NativeEditorContext]   ⚠️ 没有选中文本，跳过字体大小重置'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12907, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12970, 35}: '[NativeEditorContext] 🔄 开始更新当前格式状态'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13006, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13069, 35}: '[NativeEditorContext]   - 文本长度: 134'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13105, 34}: '[NativeEditorContext]   - 光标位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13140, 53}: '[NativeEditorContext]   - 选中范围: location=60, length=0'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13194, 34}: '[NativeEditorContext]   ✅ 有效位置: 60'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13229, 38}: '[NativeEditorContext]   📍 光标模式（未选中文本）'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13268, 48}: '[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 59'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13317, 36}: '[NativeEditorContext]   📦 获取到 4 个属性'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13354, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13417, 36}: '[NativeEditorContext] 🔍 开始检测各类格式...'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13454, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13517, 52}: '[NativeEditorContext] ========== 开始检测字体格式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13570, 106}: '[NativeEditorContext] detectFontFormats - 属性键: ["NSParagraphStyle", "NSColor", "NSOriginalFont", "NSFont"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13677, 30}: '[NativeEditorContext] 📏 字体信息:'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13708, 57}: '[NativeEditorContext]   - 字体名称: .PingFangUITextSC-Regular'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13766, 38}: '[NativeEditorContext]   - 字体大小: 17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13805, 56}: '[NativeEditorContext]   - 字体特性: bold=false, italic=false'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13862, 37}: '[NativeEditorContext] 🔍 通过字体大小判断标题类型'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13900, 69}: '[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {13970, 64}: '[NativeEditorContext] ✅ 字体大小 17.0pt 在 [17.0, 20.0) 范围内，识别为【三级标题】'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14035, 63}: '[NativeEditorContext] ========== 检测结束，最终格式: ["三级标题"] =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14099, 44}: '[NativeEditorContext]   ✅ 字体格式检测完成: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14144, 38}: '[NativeEditorContext]   ✅ 装饰格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14183, 38}: '[NativeEditorContext]   ✅ 段落格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14222, 38}: '[NativeEditorContext]   ✅ 列表格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14261, 38}: '[NativeEditorContext]   ✅ 特殊格式检测完成: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14300, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14363, 45}: '[NativeEditorContext] 📊 最终检测到的所有格式: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14409, 62}: '[NativeEditorContext] ----------------------------------------'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14472, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14528, 32}: '[NativeEditorContext] 输入格式集合: []'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14561, 56}: '[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14618, 58}: '[NativeEditorContext] ========== 段落样式转换完成: body =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14677, 55}: '[NativeEditorContext] ========== 开始转换格式为段落样式 =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14733, 38}: '[NativeEditorContext] 输入格式集合: ["三级标题"]'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14772, 64}: '[NativeEditorContext] ✅ 检测到 heading3 格式，返回段落样式: 【subtitle】(三级标题)'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14837, 62}: '[NativeEditorContext] ========== 段落样式转换完成: subtitle =========='
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14900, 57}: '[NativeEditorContext] 发送段落样式变化通知: paragraphStyle=subtitle'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14958, 33}: '[NativeEditorContext] 检测到格式: 三级标题'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {14992, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15055, 32}: '[NativeEditorContext] ✅ 格式状态更新完成'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15088, 62}: '[NativeEditorContext] ========================================'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15151, 45}: '[NativeEditorContext] ✅ 标题格式已清除，字体大小已重置为 13pt'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15197, 18}: '[VIEWMODEL] 应用变为后台'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {15216, 21}: '[VIEWMODEL] 停止自动同步定时器'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 22931, 转换后文本长度: 15237
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 22931
[NativeEditorWrapper] 初始加载内容 - 长度: 22931
[MemoryCache] 更新缓存 - ID: 48977865..., 标题: 新笔记
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48977865941337632
[StateTransition] noteSelection: folder(0 -> 0), note(48970847743525760 -> 48977865941337632)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 22931
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 22931 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.36ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 2.67ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 42.26ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 22.40ms
[XMLNormalizer] 📏 规范化后内容长度: 22627 字符
[XMLNormalizer] ⏱️ 总耗时: 67.83ms
[XMLNormalizer] ⚠️ 警告：规范化耗时超过阈值（10ms）！
[XMLNormalizer] ⚠️ 实际耗时: 67.83ms
[XMLNormalizer] ⚠️ 内容长度: 22931 字符
[XMLNormalizer] ⚠️ 各步骤耗时详情：
[XMLNormalizer]    - 图片格式: 0.36ms
[XMLNormalizer]    - 空格处理: 2.67ms
[XMLNormalizer]    - 属性顺序: 42.26ms
[XMLNormalizer]    - 属性值: 22.40ms
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 22931 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.30ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 3.00ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 45.40ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 23.84ms
[XMLNormalizer] 📏 规范化后内容长度: 22627 字符
[XMLNormalizer] ⏱️ 总耗时: 72.67ms
[XMLNormalizer] ⚠️ 警告：规范化耗时超过阈值（10ms）！
[XMLNormalizer] ⚠️ 实际耗时: 72.67ms
[XMLNormalizer] ⚠️ 内容长度: 22931 字符
[XMLNormalizer] ⚠️ 各步骤耗时详情：
[XMLNormalizer]    - 图片格式: 0.30ms
[XMLNormalizer]    - 空格处理: 3.00ms
[XMLNormalizer]    - 属性顺序: 45.40ms
[XMLNormalizer]    - 属性值: 23.84ms
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=22931, 保存=22931
[内容检测] 📏 规范化后长度: 当前=22627, 保存=22627
[内容检测] ⏱️ 检测耗时: 140.92ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 141.35ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ⚠️ 警告: 后台保存耗时超过 100ms，可能影响用户体验
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48977865..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48977865..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48977865..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48977865..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 7
[NativeEditorContext]   - nsAttributed.string: '1
￼11
￼'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {2, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {6, 1}
[NativeEditorContext] 🖼️ 总共发现 2 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 101, 转换后文本长度: 7
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 101
[CursorFormatManager] 执行更新 - range: {15237, 0}
[UnifiedFormatManager] detectFormatState - position: 15237, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 15237, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorView] 更新内容 - 当前长度: 15237, 新长度: 7, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48977865...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 101
[快速切换] ✅ 从缓存加载完成 - ID: 48977865..., 标题: 新笔记, 内容长度: 101
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48977865...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48977865...
[NativeEditorContext] 验证内容持久化，预期内容长度: 101
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 101
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 101
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48977865...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 101
[快速切换] ✅ 从缓存加载完成 - ID: 48977865..., 标题: 新笔记, 内容长度: 101
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48977865...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48977865...
[NativeEditorContext] 验证内容持久化，预期内容长度: 101
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 101
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 101
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 7
[NativeEditorView]   - 加载前 范围 {0, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {3, 2}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {3, 2}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.73ms
[NativeEditorView] 更新内容 - 当前长度: 7, 新长度: 7, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 7
[NativeEditorContext]   - nsAttributed.string: '1
￼11
￼'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {2, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {6, 1}
[NativeEditorContext] 🖼️ 总共发现 2 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 101, 转换后文本长度: 7
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 101
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 7
[NativeEditorContext]   - nsAttributed.string: '1
￼11
￼'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {2, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {6, 1}
[NativeEditorContext] 🖼️ 总共发现 2 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {3, 2}: '11'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 101, 转换后文本长度: 7
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 101
[NativeEditorWrapper] 初始加载内容 - 长度: 101
[NativeEditorView] 更新内容 - 当前长度: 7, 新长度: 7, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 7, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 检测到附件: OrderAttachment, index=6, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {7, 0}
[UnifiedFormatManager] detectFormatState - position: 7, state: FormatState(段落: 有序列表, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 5
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["有序列表"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 有序列表, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 7, state: FormatState(段落: 有序列表, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 7
[NativeEditorContext]   - 光标位置: 7
[NativeEditorContext]   - 选中范围: location=7, length=0
[NativeEditorContext]   ✅ 有效位置: 6
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 5
[NativeEditorContext]   📦 获取到 2 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSColor", "NSParagraphStyle"]
[NativeEditorContext] ❌ 没有找到 .font 属性，无法继续检测
[NativeEditorContext] ========== 检测结束（无字体） ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext] detectListFormats - 检测到 listType: MiNoteLibrary.ListType.ordered
[NativeEditorContext] detectListFormats - 检测到有序列表 (ListType.ordered)
[NativeEditorContext]   ✅ 列表格式检测完成: ["有序列表"]
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["有序列表"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["有序列表"]
[NativeEditorContext] ✅ 检测到 numberedList 格式，返回段落样式: 【orderedList】(有序列表)
[NativeEditorContext] ========== 段落样式转换完成: orderedList ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["有序列表"]
[NativeEditorContext] ✅ 检测到 numberedList 格式，返回段落样式: 【orderedList】(有序列表)
[NativeEditorContext] ========== 段落样式转换完成: orderedList ==========
[NativeEditorContext] 检测到格式: 有序列表
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 48976637..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48970847..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48976637..., 标题: 新笔记
[PinnedNoteRowContent] 点击笔记 - ID: 48976637..., 当前选中: 48977865, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48976637720412768
[PinnedNoteRowContent] 设置 selectedNote 为 48976637...
[NotesListView] 📊 selectedNote 变化: 48977865 -> 48976637
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48977865..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 101
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 101
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48977865... 切换到: 48976637...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 101
[笔记切换] 📏 lastSavedXMLContent 长度: 101
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 101
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 101 到 254
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48976637720412768
[StateTransition] noteSelection: folder(0 -> 0), note(48977865941337632 -> 48976637720412768)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 101
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 101 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.10ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.14ms
[XMLNormalizer] 📏 规范化后内容长度: 101 字符
[XMLNormalizer] ⏱️ 总耗时: 0.35ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 101 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.07ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.12ms
[XMLNormalizer] 📏 规范化后内容长度: 101 字符
[XMLNormalizer] ⏱️ 总耗时: 0.25ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=101, 保存=101
[内容检测] 📏 规范化后长度: 当前=101, 保存=101
[内容检测] ⏱️ 检测耗时: 0.62ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.65ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48976637..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48976637..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48976637..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48976637..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 39
[NativeEditorContext]   - nsAttributed.string: '￼1121332
￼5555
￼343434
￼yi uu
￼77
￼9
￼8'
[NativeEditorContext] 🖼️ 发现附件 1: BulletAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: BulletAttachment at range {9, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {15, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {23, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {30, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {34, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {37, 1}
[NativeEditorContext] 🖼️ 总共发现 7 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 7}: '1121332'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 4}: '5555'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 6}: '343434'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {24, 5}: 'yi uu'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {31, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {35, 1}: '9'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {38, 1}: '8'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 254, 转换后文本长度: 39
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 254
[NativeEditorView] 更新内容 - 当前长度: 7, 新长度: 39, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=7, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=7, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48976637...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 254
[快速切换] ✅ 从缓存加载完成 - ID: 48976637..., 标题: 新笔记, 内容长度: 254
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48976637...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48976637...
[NativeEditorContext] 验证内容持久化，预期内容长度: 254
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 254
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48976637...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 254
[快速切换] ✅ 从缓存加载完成 - ID: 48976637..., 标题: 新笔记, 内容长度: 254
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48976637...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48976637...
[NativeEditorContext] 验证内容持久化，预期内容长度: 254
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 254
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 39
[NativeEditorView]   - 加载前 范围 {1, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {16, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {24, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {31, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {35, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {38, 1}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {1, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {16, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {24, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {31, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {35, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {38, 1}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 2.03ms
[NativeEditorView] 更新内容 - 当前长度: 39, 新长度: 39, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 39
[NativeEditorContext]   - nsAttributed.string: '￼1121332
￼5555
￼343434
￼yi uu
￼77
￼9
￼8'
[NativeEditorContext] 🖼️ 发现附件 1: BulletAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: BulletAttachment at range {9, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {15, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {23, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {30, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {34, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {37, 1}
[NativeEditorContext] 🖼️ 总共发现 7 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 7}: '1121332'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 4}: '5555'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 6}: '343434'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {24, 5}: 'yi uu'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {31, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {35, 1}: '9'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {38, 1}: '8'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 254, 转换后文本长度: 39
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 254
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 39
[NativeEditorContext]   - nsAttributed.string: '￼1121332
￼5555
￼343434
￼yi uu
￼77
￼9
￼8'
[NativeEditorContext] 🖼️ 发现附件 1: BulletAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: BulletAttachment at range {9, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {15, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {23, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {30, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {34, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {37, 1}
[NativeEditorContext] 🖼️ 总共发现 7 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 7}: '1121332'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 4}: '5555'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 6}: '343434'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {24, 5}: 'yi uu'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {31, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {35, 1}: '9'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {38, 1}: '8'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 254, 转换后文本长度: 39
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 254
[NativeEditorWrapper] 初始加载内容 - 长度: 254
[NativeEditorView] 更新内容 - 当前长度: 39, 新长度: 39, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {39, 0}
[UnifiedFormatManager] detectFormatState - position: 39, state: FormatState(段落: 有序列表, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 5
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["有序列表"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 有序列表, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 39, state: FormatState(段落: 有序列表, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 39
[NativeEditorContext]   - 光标位置: 39
[NativeEditorContext]   - 选中范围: location=39, length=0
[NativeEditorContext]   ✅ 有效位置: 38
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 37
[NativeEditorContext]   📦 获取到 6 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["listType", "listIndent", "NSColor", "NSParagraphStyle", "listNumber", "NSAttachment"]
[NativeEditorContext] ❌ 没有找到 .font 属性，无法继续检测
[NativeEditorContext] ========== 检测结束（无字体） ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext] detectListFormats - 检测到 listType: MiNoteLibrary.ListType.ordered
[NativeEditorContext] detectListFormats - 检测到有序列表 (ListType.ordered)
[NativeEditorContext]   ✅ 列表格式检测完成: ["有序列表"]
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["有序列表"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["有序列表"]
[NativeEditorContext] ✅ 检测到 numberedList 格式，返回段落样式: 【orderedList】(有序列表)
[NativeEditorContext] ========== 段落样式转换完成: orderedList ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["有序列表"]
[NativeEditorContext] ✅ 检测到 numberedList 格式，返回段落样式: 【orderedList】(有序列表)
[NativeEditorContext] ========== 段落样式转换完成: orderedList ==========
[NativeEditorContext] 检测到格式: 有序列表
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 48970847..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48966095..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48970847..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48966095..., 标题: 新笔记
[PinnedNoteRowContent] 点击笔记 - ID: 48966095..., 当前选中: 48976637, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48966095882175040
[PinnedNoteRowContent] 设置 selectedNote 为 48966095...
[NotesListView] 📊 selectedNote 变化: 48976637 -> 48966095
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48976637..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 254
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48976637... 切换到: 48966095...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 254
[笔记切换] 📏 lastSavedXMLContent 长度: 254
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 254 到 462
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48966095882175040
[StateTransition] noteSelection: folder(0 -> 0), note(48976637720412768 -> 48966095882175040)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 254
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 254 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.18ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.24ms
[XMLNormalizer] 📏 规范化后内容长度: 254 字符
[XMLNormalizer] ⏱️ 总耗时: 0.54ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 254 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.15ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.24ms
[XMLNormalizer] 📏 规范化后内容长度: 254 字符
[XMLNormalizer] ⏱️ 总耗时: 0.46ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=254, 保存=254
[内容检测] 📏 规范化后长度: 当前=254, 保存=254
[内容检测] ⏱️ 检测耗时: 13.05ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 13.10ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48966095..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48966095..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48966095..., 标题: 新笔记
[MemoryCache] 缓存命中 - ID: 48966095..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 47
[NativeEditorContext]   - nsAttributed.string: '￼有
￼序1
￼77
￼2
￼
￼
￼1111
￼444
￼1
￼无序
￼2
￼3
￼
￼45'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {3, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {7, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {11, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {14, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {16, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {24, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {29, 1}
[NativeEditorContext] 🖼️ 发现附件 10: BulletAttachment at range {32, 1}
[NativeEditorContext] 🖼️ 发现附件 11: BulletAttachment at range {36, 1}
[NativeEditorContext] 🖼️ 发现附件 12: BulletAttachment at range {39, 1}
[NativeEditorContext] 🖼️ 发现附件 13: BulletAttachment at range {42, 1}
[NativeEditorContext] 🖼️ 发现附件 14: BulletAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 总共发现 14 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 1}: '有'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4, 2}: '序1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {25, 3}: '444'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {30, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {33, 2}: '无序'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {37, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {40, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {45, 2}: '45'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 462, 转换后文本长度: 47
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 462
[NativeEditorView] 更新内容 - 当前长度: 39, 新长度: 47, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 检测到附件: BulletAttachment, index=39, position=beforeAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 检测到附件: BulletAttachment, index=39, position=beforeAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[ListBehaviorHandler] 光标位置调整: 39 -> 40
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=40, length=0
[AttachmentSelectionManager] 检测到附件: BulletAttachment, index=39, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[AttachmentSelectionManager] 处理选择变化: location=40, length=0
[AttachmentSelectionManager] 检测到附件: BulletAttachment, index=39, position=afterAttachment
[AttachmentSelectionManager] 附件不支持选择高亮
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48966095...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 462
[快速切换] ✅ 从缓存加载完成 - ID: 48966095..., 标题: 新笔记, 内容长度: 462
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48966095...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48966095...
[NativeEditorContext] 验证内容持久化，预期内容长度: 462
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 462
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48966095...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 462
[快速切换] ✅ 从缓存加载完成 - ID: 48966095..., 标题: 新笔记, 内容长度: 462
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48966095...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48966095...
[NativeEditorContext] 验证内容持久化，预期内容长度: 462
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 462
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 47
[NativeEditorView]   - 加载前 范围 {1, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {4, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {8, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {12, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {19, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {25, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {30, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {33, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {37, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {40, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {45, 2}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {1, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {4, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {8, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {12, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {19, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {25, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {30, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {33, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {37, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {40, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {45, 2}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 2.30ms
[NativeEditorView] 更新内容 - 当前长度: 47, 新长度: 47, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 47
[NativeEditorContext]   - nsAttributed.string: '￼有
￼序1
￼77
￼2
￼
￼
￼1111
￼444
￼1
￼无序
￼2
￼3
￼
￼45'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {3, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {7, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {11, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {14, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {16, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {24, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {29, 1}
[NativeEditorContext] 🖼️ 发现附件 10: BulletAttachment at range {32, 1}
[NativeEditorContext] 🖼️ 发现附件 11: BulletAttachment at range {36, 1}
[NativeEditorContext] 🖼️ 发现附件 12: BulletAttachment at range {39, 1}
[NativeEditorContext] 🖼️ 发现附件 13: BulletAttachment at range {42, 1}
[NativeEditorContext] 🖼️ 发现附件 14: BulletAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 总共发现 14 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 1}: '有'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4, 2}: '序1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {25, 3}: '444'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {30, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {33, 2}: '无序'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {37, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {40, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {45, 2}: '45'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 462, 转换后文本长度: 47
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 462
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 47
[NativeEditorContext]   - nsAttributed.string: '￼有
￼序1
￼77
￼2
￼
￼
￼1111
￼444
￼1
￼无序
￼2
￼3
￼
￼45'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: OrderAttachment at range {3, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {7, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {11, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {14, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {16, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {18, 1}
[NativeEditorContext] 🖼️ 发现附件 8: OrderAttachment at range {24, 1}
[NativeEditorContext] 🖼️ 发现附件 9: OrderAttachment at range {29, 1}
[NativeEditorContext] 🖼️ 发现附件 10: BulletAttachment at range {32, 1}
[NativeEditorContext] 🖼️ 发现附件 11: BulletAttachment at range {36, 1}
[NativeEditorContext] 🖼️ 发现附件 12: BulletAttachment at range {39, 1}
[NativeEditorContext] 🖼️ 发现附件 13: BulletAttachment at range {42, 1}
[NativeEditorContext] 🖼️ 发现附件 14: BulletAttachment at range {44, 1}
[NativeEditorContext] 🖼️ 总共发现 14 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 1}: '有'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {4, 2}: '序1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {8, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {12, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {19, 4}: '1111'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {25, 3}: '444'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {30, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {33, 2}: '无序'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {37, 1}: '2'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {40, 1}: '3'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {45, 2}: '45'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 462, 转换后文本长度: 47
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 462
[NativeEditorWrapper] 初始加载内容 - 长度: 462
[NativeEditorView] 更新内容 - 当前长度: 47, 新长度: 47, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=47, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 47, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=47, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {47, 0}
[UnifiedFormatManager] detectFormatState - position: 47, state: FormatState(段落: 无序列表, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 4
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["无序列表"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 无序列表, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 47, state: FormatState(段落: 无序列表, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 47
[NativeEditorContext]   - 光标位置: 47
[NativeEditorContext]   - 选中范围: location=47, length=0
[NativeEditorContext]   ✅ 有效位置: 46
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 45
[NativeEditorContext]   📦 获取到 5 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "listIndent", "NSParagraphStyle", "listType", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext] detectListFormats - 检测到 listType: MiNoteLibrary.ListType.bullet
[NativeEditorContext] detectListFormats - 检测到无序列表 (ListType.bullet)
[NativeEditorContext]   ✅ 列表格式检测完成: ["无序列表"]
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["无序列表"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["无序列表"]
[NativeEditorContext] ✅ 检测到 bulletList 格式，返回段落样式: 【unorderedList】(无序列表)
[NativeEditorContext] ========== 段落样式转换完成: unorderedList ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["无序列表"]
[NativeEditorContext] ✅ 检测到 bulletList 格式，返回段落样式: 【unorderedList】(无序列表)
[NativeEditorContext] ========== 段落样式转换完成: unorderedList ==========
[NativeEditorContext] 检测到格式: 无序列表
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 48970847..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48976637..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48977865..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48976637..., 标题: 新笔记
[PinnedNoteRowContent] 点击笔记 - ID: 48976637..., 当前选中: 48966095, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48976637720412768
[PinnedNoteRowContent] 设置 selectedNote 为 48976637...
[NotesListView] 📊 selectedNote 变化: 48966095 -> 48976637
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48966095..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 462
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48966095... 切换到: 48976637...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 462
[笔记切换] 📏 lastSavedXMLContent 长度: 462
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 462
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 462 到 254
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48976637720412768
[StateTransition] noteSelection: folder(0 -> 0), note(48966095882175040 -> 48976637720412768)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 462
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 462 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.38ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.43ms
[XMLNormalizer] 📏 规范化后内容长度: 462 字符
[XMLNormalizer] ⏱️ 总耗时: 0.98ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 462 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.33ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.42ms
[XMLNormalizer] 📏 规范化后内容长度: 462 字符
[XMLNormalizer] ⏱️ 总耗时: 0.86ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=462, 保存=462
[内容检测] 📏 规范化后长度: 当前=462, 保存=462
[内容检测] ⏱️ 检测耗时: 1.86ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 1.89ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48976637..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48976637..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48976637..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48976637..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 39
[NativeEditorContext]   - nsAttributed.string: '￼1121332
￼5555
￼343434
￼yi uu
￼77
￼9
￼8'
[NativeEditorContext] 🖼️ 发现附件 1: BulletAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: BulletAttachment at range {9, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {15, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {23, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {30, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {34, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {37, 1}
[NativeEditorContext] 🖼️ 总共发现 7 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 7}: '1121332'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 4}: '5555'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 6}: '343434'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {24, 5}: 'yi uu'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {31, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {35, 1}: '9'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {38, 1}: '8'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 254, 转换后文本长度: 39
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 254
[NativeEditorView] 更新内容 - 当前长度: 47, 新长度: 39, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[快速切换] ✅ 内存缓存命中 - ID: 48976637...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 254
[快速切换] ✅ 从缓存加载完成 - ID: 48976637..., 标题: 新笔记, 内容长度: 254
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48976637...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48976637...
[NativeEditorContext] 验证内容持久化，预期内容长度: 254
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 254
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48976637...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 254
[快速切换] ✅ 从缓存加载完成 - ID: 48976637..., 标题: 新笔记, 内容长度: 254
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48976637...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48976637...
[NativeEditorContext] 验证内容持久化，预期内容长度: 254
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 254
[持久化验证] 原生编辑器验证结果: 失败
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 39
[NativeEditorView]   - 加载前 范围 {1, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {16, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {24, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {31, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {35, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {38, 1}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {1, 7}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10, 4}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {16, 6}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {24, 5}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {31, 2}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {35, 1}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {38, 1}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 2.15ms
[NativeEditorView] 更新内容 - 当前长度: 39, 新长度: 39, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 39
[NativeEditorContext]   - nsAttributed.string: '￼1121332
￼5555
￼343434
￼yi uu
￼77
￼9
￼8'
[NativeEditorContext] 🖼️ 发现附件 1: BulletAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: BulletAttachment at range {9, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {15, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {23, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {30, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {34, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {37, 1}
[NativeEditorContext] 🖼️ 总共发现 7 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 7}: '1121332'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 4}: '5555'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 6}: '343434'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {24, 5}: 'yi uu'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {31, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {35, 1}: '9'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {38, 1}: '8'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 254, 转换后文本长度: 39
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 254
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 39
[NativeEditorContext]   - nsAttributed.string: '￼1121332
￼5555
￼343434
￼yi uu
￼77
￼9
￼8'
[NativeEditorContext] 🖼️ 发现附件 1: BulletAttachment at range {0, 1}
[NativeEditorContext] 🖼️ 发现附件 2: BulletAttachment at range {9, 1}
[NativeEditorContext] 🖼️ 发现附件 3: OrderAttachment at range {15, 1}
[NativeEditorContext] 🖼️ 发现附件 4: OrderAttachment at range {23, 1}
[NativeEditorContext] 🖼️ 发现附件 5: OrderAttachment at range {30, 1}
[NativeEditorContext] 🖼️ 发现附件 6: OrderAttachment at range {34, 1}
[NativeEditorContext] 🖼️ 发现附件 7: OrderAttachment at range {37, 1}
[NativeEditorContext] 🖼️ 总共发现 7 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {1, 7}: '1121332'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 4}: '5555'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {16, 6}: '343434'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {24, 5}: 'yi uu'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {31, 2}: '77'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {35, 1}: '9'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {38, 1}: '8'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 254, 转换后文本长度: 39
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 254
[NativeEditorWrapper] 初始加载内容 - 长度: 254
[NativeEditorView] 更新内容 - 当前长度: 39, 新长度: 39, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=39, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 39, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=39, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {39, 0}
[UnifiedFormatManager] detectFormatState - position: 39, state: FormatState(段落: 有序列表, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 5
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: ["有序列表"]
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 有序列表, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 39, state: FormatState(段落: 有序列表, 对齐: 左对齐)
[MemoryCache] 更新缓存 - ID: 48977865..., 标题: 新笔记
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 39
[NativeEditorContext]   - 光标位置: 39
[NativeEditorContext]   - 选中范围: location=39, length=0
[NativeEditorContext]   ✅ 有效位置: 38
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 37
[NativeEditorContext]   📦 获取到 6 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSAttachment", "listType", "NSParagraphStyle", "listNumber", "listIndent", "NSColor"]
[NativeEditorContext] ❌ 没有找到 .font 属性，无法继续检测
[NativeEditorContext] ========== 检测结束（无字体） ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext] detectListFormats - 检测到 listType: MiNoteLibrary.ListType.ordered
[NativeEditorContext] detectListFormats - 检测到有序列表 (ListType.ordered)
[NativeEditorContext]   ✅ 列表格式检测完成: ["有序列表"]
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: ["有序列表"]
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["有序列表"]
[NativeEditorContext] ✅ 检测到 numberedList 格式，返回段落样式: 【orderedList】(有序列表)
[NativeEditorContext] ========== 段落样式转换完成: orderedList ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: ["有序列表"]
[NativeEditorContext] ✅ 检测到 numberedList 格式，返回段落样式: 【orderedList】(有序列表)
[NativeEditorContext] ========== 段落样式转换完成: orderedList ==========
[NativeEditorContext] 检测到格式: 有序列表
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 移除LRU缓存 - ID: 49006032..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 48969392..., 标题: 未命名笔记_48969392250438496, 当前缓存数: 10
[PinnedNoteRowContent] 点击笔记 - ID: 48969392..., 当前选中: 48976637, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48969392250438496
[PinnedNoteRowContent] 设置 selectedNote 为 48969392...
[NotesListView] 📊 selectedNote 变化: 48976637 -> 48969392
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48976637..., 标题: 新笔记
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 254
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48976637... 切换到: 48969392...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 254
[笔记切换] 📏 lastSavedXMLContent 长度: 254
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 254
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 254 到 184
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48969392250438496
[StateTransition] noteSelection: folder(0 -> 0), note(48976637720412768 -> 48969392250438496)
[ViewStateCoordinator] 笔记选择完成: 未命名笔记_48969392250438496
[笔记切换] 📝 后台保存内容 - 长度: 254
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 254 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.04ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.17ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.22ms
[XMLNormalizer] 📏 规范化后内容长度: 254 字符
[XMLNormalizer] ⏱️ 总耗时: 0.50ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 254 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.13ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.22ms
[XMLNormalizer] 📏 规范化后内容长度: 254 字符
[XMLNormalizer] ⏱️ 总耗时: 0.42ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=254, 保存=254
[内容检测] 📏 规范化后长度: 当前=254, 保存=254
[内容检测] ⏱️ 检测耗时: 0.94ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.97ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[MemoryCache] 缓存命中 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 16
[NativeEditorContext]   - nsAttributed.string: '1
12
￼112
121212'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {5, 1}
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 23.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {2, 2}: '12'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 20.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {6, 3}: '112'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 6}: '121212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 184, 转换后文本长度: 16
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 184
[NativeEditorView] 更新内容 - 当前长度: 39, 新长度: 16, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
[快速切换] ✅ 内存缓存命中 - ID: 48969392...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 184
[快速切换] ✅ 从缓存加载完成 - ID: 48969392..., 标题: , 内容长度: 184
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48969392...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48969392...
[NativeEditorContext] 验证内容持久化，预期内容长度: 184
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 171
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 171
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48969392...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 184
[快速切换] ✅ 从缓存加载完成 - ID: 48969392..., 标题: , 内容长度: 184
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48969392...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48969392...
[NativeEditorContext] 验证内容持久化，预期内容长度: 184
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 171
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 171
[持久化验证] 原生编辑器验证结果: 失败
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 16
[NativeEditorView]   - 加载前 范围 {0, 1}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {2, 2}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {6, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10, 6}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 1}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {2, 2}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {6, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10, 6}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.97ms
[NativeEditorView] 更新内容 - 当前长度: 16, 新长度: 16, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 16
[NativeEditorContext]   - nsAttributed.string: '1
12
￼112
121212'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {5, 1}
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 23.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {2, 2}: '12'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 20.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {6, 3}: '112'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 6}: '121212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 184, 转换后文本长度: 16
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 184
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 16
[NativeEditorContext]   - nsAttributed.string: '1
12
￼112
121212'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {5, 1}
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 23.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {2, 2}: '12'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 20.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {6, 3}: '112'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 6}: '121212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 184, 转换后文本长度: 16
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 184
[NativeEditorWrapper] 初始加载内容 - 长度: 184
[NativeEditorView] 更新内容 - 当前长度: 16, 新长度: 16, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {16, 0}
[UnifiedFormatManager] detectFormatState - position: 16, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 16, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 16
[NativeEditorContext]   - 光标位置: 16
[NativeEditorContext]   - 选中范围: location=16, length=0
[NativeEditorContext]   ✅ 有效位置: 15
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 14
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSColor", "NSParagraphStyle"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 移除LRU缓存 - ID: 49006046..., 标题: 测ceshi
[MemoryCache] 添加缓存 - ID: 48966438..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 49005878..., 标题: 新笔记121
[MemoryCache] 添加缓存 - ID: 48759929..., 标题: 最终稿, 当前缓存数: 10
[MemoryCache] 更新缓存 - ID: 48966438..., 标题: 新笔记
[PinnedNoteRowContent] 点击笔记 - ID: 48966438..., 当前选中: 48969392, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48966438869550624
[PinnedNoteRowContent] 设置 selectedNote 为 48966438...
[NotesListView] 📊 selectedNote 变化: 48969392 -> 48966438
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 171
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 171
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48969392... 切换到: 48966438...
[笔记切换] 📝 捕获的标题: 
[笔记切换] 📝 原始标题: 
[笔记切换] 📏 捕获的内容长度: 171
[笔记切换] 📏 lastSavedXMLContent 长度: 184
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 171
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 184 到 24
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48966438869550624
[StateTransition] noteSelection: folder(0 -> 0), note(48969392250438496 -> 48966438869550624)
[ViewStateCoordinator] 笔记选择完成: 新笔记
[笔记切换] 📝 后台保存内容 - 长度: 171
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 171 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.12ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.14ms
[XMLNormalizer] 📏 规范化后内容长度: 171 字符
[XMLNormalizer] ⏱️ 总耗时: 0.38ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 184 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.09ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.15ms
[XMLNormalizer] 📏 规范化后内容长度: 184 字符
[XMLNormalizer] ⏱️ 总耗时: 0.30ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=true, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=171, 保存=184
[内容检测] 📏 规范化后长度: 当前=171, 保存=184
[内容检测] ⏱️ 检测耗时: 0.70ms
[内容检测] 📝 原始内容长度差异: 13 字符
[内容检测] 📝 规范化后长度差异: 13 字符
[内容检测] ⚠️ 规范化后仍有显著差异，这是实际内容变化
[内容检测] 🔍 当前内容完整: <text indent="1"><size><b>1</b></size></text> <text indent="1"><mid-size><b>12</b></mid-size></text> <order indent="1" inputNumber="0" />112 <text indent="1">121212</text>
[内容检测] 🔍 保存内容完整: <new-format/><text indent="1"><size><b>1</b></size></text> <text indent="1"><mid-size><b>12</b></mid-size></text> <order indent="1" inputNumber="0" />112 <text indent="1">121212</text>
[内容检测] 🔍 第一个不同的位置: 1
[内容检测] 🔍 当前内容上下文: <text indent="1"><siz
[内容检测] 🔍 保存内容上下文: <new-format/><text in
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 需要更新
[内容检测] ═══════════════════════════════════════
[笔记切换] 💾 后台保存 - 检测到实际内容变化
[buildUpdatedNote] ═══════════════════════════════════════
[buildUpdatedNote] 📝 笔记ID: 48969392...
[buildUpdatedNote] 📝 标题: 
[buildUpdatedNote] 📏 内容长度: 171
[buildUpdatedNote] 🕐 shouldUpdateTimestamp: true
[buildUpdatedNote] 🕐 原始时间戳: 2026-01-14 15:13:42 +0000
[buildUpdatedNote] 🕐 新时间戳: 2026-01-18 11:05:11 +0000
[buildUpdatedNote] 🕐 时间戳决策: 更新为当前时间
[buildUpdatedNote] ═══════════════════════════════════════
[MemoryCache] 更新缓存 - ID: 48969392..., 标题: 
[快速切换] 🔄 开始切换到笔记 - ID: 48966438..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48966438..., 标题: 新笔记
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 新笔记
[MemoryCache] 缓存命中 - ID: 48966438..., 标题: 新笔记
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48966438..., 标题: 新笔记
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 0
[NativeEditorContext]   - nsAttributed.string: ''
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 24, 转换后文本长度: 0
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 24
[NativeEditorView] 更新内容 - 当前长度: 16, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 8.46ms
[性能监控] 📊 保存决策: 执行保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] ✅ 内存缓存命中 - ID: 48966438...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 24
[快速切换] ✅ 从缓存加载完成 - ID: 48966438..., 标题: 新笔记, 内容长度: 24
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48966438...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48966438...
[NativeEditorContext] 验证内容持久化，预期内容长度: 24
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 0
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48966438...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 24
[快速切换] ✅ 从缓存加载完成 - ID: 48966438..., 标题: 新笔记, 内容长度: 24
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48966438...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48966438...
[NativeEditorContext] 验证内容持久化，预期内容长度: 24
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 0
[持久化验证] 原生编辑器验证结果: 失败
[保存流程] ✅ Tier 1 异步保存笔记到数据库成功，ID: 48969392..., 标题: 
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[笔记切换] ✅ 后台保存成功 - 笔记ID: 48969392...
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.00ms
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 0
[NativeEditorContext]   - nsAttributed.string: ''
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 24, 转换后文本长度: 0
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 24
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 0
[NativeEditorContext]   - nsAttributed.string: ''
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 24, 转换后文本长度: 0
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 24
[NativeEditorWrapper] 初始加载内容 - 长度: 24
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 0, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 0, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {0, 0}
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 0, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 0
[NativeEditorContext]   - 光标位置: 0
[NativeEditorContext]   - 选中范围: location=0, length=0
[NativeEditorContext]   ⚠️ 文本为空，清除所有格式
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 48759929..., 标题: 最终稿
[PinnedNoteRowContent] 点击笔记 - ID: 48759929..., 当前选中: 48966438, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48759929648727328
[PinnedNoteRowContent] 设置 selectedNote 为 48759929...
[NotesListView] 📊 selectedNote 变化: 48966438 -> 48759929
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48966438..., 标题: 新笔记
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 0
[笔记切换] 📝 使用 currentXMLContent - 长度: 24
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48966438... 切换到: 48759929...
[笔记切换] 📝 捕获的标题: 新笔记
[笔记切换] 📝 原始标题: 新笔记
[笔记切换] 📏 捕获的内容长度: 24
[笔记切换] 📏 lastSavedXMLContent 长度: 24
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 内容为空，返回空字符串
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 24 到 884
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48759929648727328
[StateTransition] noteSelection: folder(0 -> 0), note(48966438869550624 -> 48759929648727328)
[ViewStateCoordinator] 笔记选择完成: 最终稿
[笔记切换] 📝 后台保存内容 - 长度: 24
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 24 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.01ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.05ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.06ms
[XMLNormalizer] 📏 规范化后内容长度: 24 字符
[XMLNormalizer] ⏱️ 总耗时: 0.19ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 24 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.02ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.00ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 0.05ms
[XMLNormalizer] 📏 规范化后内容长度: 24 字符
[XMLNormalizer] ⏱️ 总耗时: 0.12ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=24, 保存=24
[内容检测] 📏 规范化后长度: 当前=24, 保存=24
[内容检测] ⏱️ 检测耗时: 0.32ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 0.44ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48759929..., 标题: 最终稿
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 最终稿
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48759929..., 标题: 最终稿
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 最终稿
[MemoryCache] 缓存命中 - ID: 48759929..., 标题: 最终稿
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48759929..., 标题: 最终稿
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 805
[NativeEditorContext]   - nsAttributed.string: '145再次测试服务器刷新逻辑我是启明2401班的方博涵。进入大学以来，随着思想政治理论学习的系统推进和实践认识的不断深化，我对中国共产党的认识逐步由朴素认同转向理性1认同和自觉认同。中国共产党是中国工人阶级的先锋队，同时是中国各族人民利益的忠实代表，是实现中华民族伟大复兴的坚强领导核心。党的宗旨是全心全意为人民服务，百余年来，党始终坚持以人民为中心，团结带领中国人民不断推进革命、建设和改革事业1。通过学习习近平新时1代中1国特色社会主义思想，特别是对党的二十大和二十届四中全会精神的系统理解，我更加深刻地认识到，中国式现代化道路的成功推进，根本在于党的坚强领导和科学理论指引。
大学阶段的学习和思考中，我开始更加自觉地将个人发展与国家前途、民族命运联系起来。通过对党的创新理论的深入学习，我逐步认识到产党之所以能够在复杂多变的2国内外环境中始终保持战略定力，关键在于其坚持真理、坚守初心，并不断推进自我革命。相较于以往更多停留在情感层面的认同，大学阶段的思想锻炼使我更加注重从理论逻辑、制度优势和实践成效相统一的角度理解党的领导。这一过程也不断促使我反思自身成长中的功利化倾1向，逐渐确立起将个人理想融入民族复兴进程的价值追求。作为计算机科学与技术专业的学生，我对国家强调科技自立自强、加快建设科技强国的战略部署有了更加深刻的理解，也更加坚定了将专业学习与国家需求相结合、以科技报国的志向。
3在对待入党的态1度上，我始终保持严肃、慎重的立场。我清醒地认识到，自己在理论学习的系统性、联系群众的实践经验以及组织协调能力等方面仍有不足，需要在今后的学习和实践中不断锤炼和提升。入党不是一时的目标，更不是荣誉的象征，而是一项需要长期践行的政治承诺。今后，我将以党员标准严格要求自己，持续用党的创新理论武装头11脑，在学习、科研和服务集体中主动担当，自觉接受党组织的教育、考察和监督，用实践来践行入党誓言。333'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 290}: '145再次测试服务器刷新逻辑我是启明2401班的方博涵。进入大学以来，随着思想政治理论学习的系统推进和实践认识的不断深化，我对中国共产党的认识逐步由朴素认同转向理性1认同和自觉认同。中国共产党是中国工人阶级的先锋队，同时是中国各族人民利益的忠实代表，是实现中华民族伟大复兴的坚强领导核心。党的宗旨是全心全意为人民服务，百余年来，党始终坚持以人民为中心，团结带领中国人民不断推进革命、建设和改革事业1。通过学习习近平新时1代中1国特色社会主义思想，特别是对党的二十大和二十届四中全会精神的系统理解，我更加深刻地认识到，中国式现代化道路的成功推进，根本在于党的坚强领导和科学理论指引。'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {291, 306}: '大学阶段的学习和思考中，我开始更加自觉地将个人发展与国家前途、民族命运联系起来。通过对党的创新理论的深入学习，我逐步认识到产党之所以能够在复杂多变的2国内外环境中始终保持战略定力，关键在于其坚持真理、坚守初心，并不断推进自我革命。相较于以往更多停留在情感层面的认同，大学阶段的思想锻炼使我更加注重从理论逻辑、制度优势和实践成效相统一的角度理解党的领导。这一过程也不断促使我反思自身成长中的功利化倾1向，逐渐确立起将个人理想融入民族复兴进程的价值追求。作为计算机科学与技术专业的学生，我对国家强调科技自立自强、加快建设科技强国的战略部署有了更加深刻的理解，也更加坚定了将专业学习与国家需求相结合、以科技报国的志向。'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {598, 174}: '3在对待入党的态1度上，我始终保持严肃、慎重的立场。我清醒地认识到，自己在理论学习的系统性、联系群众的实践经验以及组织协调能力等方面仍有不足，需要在今后的学习和实践中不断锤炼和提升。入党不是一时的目标，更不是荣誉的象征，而是一项需要长期践行的政治承诺。今后，我将以党员标准严格要求自己，持续用党的创新理论武装头11脑，在学习、科研和服务集体中主动担'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {772, 4}: '当，自觉'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {776, 29}: '接受党组织的教育、考察和监督，用实践来践行入党誓言。333'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 884, 转换后文本长度: 805
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 884
[NativeEditorView] 更新内容 - 当前长度: 0, 新长度: 805, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=805, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=0, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=0, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
[快速切换] ✅ 内存缓存命中 - ID: 48759929...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 884
[快速切换] ✅ 从缓存加载完成 - ID: 48759929..., 标题: 最终稿, 内容长度: 884
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48759929...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48759929...
[NativeEditorContext] 验证内容持久化，预期内容长度: 884
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 884
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 884
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48759929...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 884
[快速切换] ✅ 从缓存加载完成 - ID: 48759929..., 标题: 最终稿, 内容长度: 884
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48759929...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48759929...
[NativeEditorContext] 验证内容持久化，预期内容长度: 884
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 884
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 884
[持久化验证] 原生编辑器验证结果: 失败
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c09f80> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 805
[NativeEditorView]   - 加载前 范围 {0, 290}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {291, 306}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {598, 174}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {772, 4}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {776, 29}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=805, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 290}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {291, 306}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {598, 174}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {772, 4}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {776, 29}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.94ms
[NativeEditorView] 更新内容 - 当前长度: 805, 新长度: 805, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=805, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=805, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 805
[NativeEditorContext]   - nsAttributed.string: '145再次测试服务器刷新逻辑我是启明2401班的方博涵。进入大学以来，随着思想政治理论学习的系统推进和实践认识的不断深化，我对中国共产党的认识逐步由朴素认同转向理性1认同和自觉认同。中国共产党是中国工人阶级的先锋队，同时是中国各族人民利益的忠实代表，是实现中华民族伟大复兴的坚强领导核心。党的宗旨是全心全意为人民服务，百余年来，党始终坚持以人民为中心，团结带领中国人民不断推进革命、建设和改革事业1。通过学习习近平新时1代中1国特色社会主义思想，特别是对党的二十大和二十届四中全会精神的系统理解，我更加深刻地认识到，中国式现代化道路的成功推进，根本在于党的坚强领导和科学理论指引。
大学阶段的学习和思考中，我开始更加自觉地将个人发展与国家前途、民族命运联系起来。通过对党的创新理论的深入学习，我逐步认识到产党之所以能够在复杂多变的2国内外环境中始终保持战略定力，关键在于其坚持真理、坚守初心，并不断推进自我革命。相较于以往更多停留在情感层面的认同，大学阶段的思想锻炼使我更加注重从理论逻辑、制度优势和实践成效相统一的角度理解党的领导。这一过程也不断促使我反思自身成长中的功利化倾1向，逐渐确立起将个人理想融入民族复兴进程的价值追求。作为计算机科学与技术专业的学生，我对国家强调科技自立自强、加快建设科技强国的战略部署有了更加深刻的理解，也更加坚定了将专业学习与国家需求相结合、以科技报国的志向。
3在对待入党的态1度上，我始终保持严肃、慎重的立场。我清醒地认识到，自己在理论学习的系统性、联系群众的实践经验以及组织协调能力等方面仍有不足，需要在今后的学习和实践中不断锤炼和提升。入党不是一时的目标，更不是荣誉的象征，而是一项需要长期践行的政治承诺。今后，我将以党员标准严格要求自己，持续用党的创新理论武装头11脑，在学习、科研和服务集体中主动担当，自觉接受党组织的教育、考察和监督，用实践来践行入党誓言。333'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 290}: '145再次测试服务器刷新逻辑我是启明2401班的方博涵。进入大学以来，随着思想政治理论学习的系统推进和实践认识的不断深化，我对中国共产党的认识逐步由朴素认同转向理性1认同和自觉认同。中国共产党是中国工人阶级的先锋队，同时是中国各族人民利益的忠实代表，是实现中华民族伟大复兴的坚强领导核心。党的宗旨是全心全意为人民服务，百余年来，党始终坚持以人民为中心，团结带领中国人民不断推进革命、建设和改革事业1。通过学习习近平新时1代中1国特色社会主义思想，特别是对党的二十大和二十届四中全会精神的系统理解，我更加深刻地认识到，中国式现代化道路的成功推进，根本在于党的坚强领导和科学理论指引。'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {291, 306}: '大学阶段的学习和思考中，我开始更加自觉地将个人发展与国家前途、民族命运联系起来。通过对党的创新理论的深入学习，我逐步认识到产党之所以能够在复杂多变的2国内外环境中始终保持战略定力，关键在于其坚持真理、坚守初心，并不断推进自我革命。相较于以往更多停留在情感层面的认同，大学阶段的思想锻炼使我更加注重从理论逻辑、制度优势和实践成效相统一的角度理解党的领导。这一过程也不断促使我反思自身成长中的功利化倾1向，逐渐确立起将个人理想融入民族复兴进程的价值追求。作为计算机科学与技术专业的学生，我对国家强调科技自立自强、加快建设科技强国的战略部署有了更加深刻的理解，也更加坚定了将专业学习与国家需求相结合、以科技报国的志向。'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {598, 174}: '3在对待入党的态1度上，我始终保持严肃、慎重的立场。我清醒地认识到，自己在理论学习的系统性、联系群众的实践经验以及组织协调能力等方面仍有不足，需要在今后的学习和实践中不断锤炼和提升。入党不是一时的目标，更不是荣誉的象征，而是一项需要长期践行的政治承诺。今后，我将以党员标准严格要求自己，持续用党的创新理论武装头11脑，在学习、科研和服务集体中主动担'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {772, 4}: '当，自觉'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {776, 29}: '接受党组织的教育、考察和监督，用实践来践行入党誓言。333'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 884, 转换后文本长度: 805
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 884
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 805
[NativeEditorContext]   - nsAttributed.string: '145再次测试服务器刷新逻辑我是启明2401班的方博涵。进入大学以来，随着思想政治理论学习的系统推进和实践认识的不断深化，我对中国共产党的认识逐步由朴素认同转向理性1认同和自觉认同。中国共产党是中国工人阶级的先锋队，同时是中国各族人民利益的忠实代表，是实现中华民族伟大复兴的坚强领导核心。党的宗旨是全心全意为人民服务，百余年来，党始终坚持以人民为中心，团结带领中国人民不断推进革命、建设和改革事业1。通过学习习近平新时1代中1国特色社会主义思想，特别是对党的二十大和二十届四中全会精神的系统理解，我更加深刻地认识到，中国式现代化道路的成功推进，根本在于党的坚强领导和科学理论指引。
大学阶段的学习和思考中，我开始更加自觉地将个人发展与国家前途、民族命运联系起来。通过对党的创新理论的深入学习，我逐步认识到产党之所以能够在复杂多变的2国内外环境中始终保持战略定力，关键在于其坚持真理、坚守初心，并不断推进自我革命。相较于以往更多停留在情感层面的认同，大学阶段的思想锻炼使我更加注重从理论逻辑、制度优势和实践成效相统一的角度理解党的领导。这一过程也不断促使我反思自身成长中的功利化倾1向，逐渐确立起将个人理想融入民族复兴进程的价值追求。作为计算机科学与技术专业的学生，我对国家强调科技自立自强、加快建设科技强国的战略部署有了更加深刻的理解，也更加坚定了将专业学习与国家需求相结合、以科技报国的志向。
3在对待入党的态1度上，我始终保持严肃、慎重的立场。我清醒地认识到，自己在理论学习的系统性、联系群众的实践经验以及组织协调能力等方面仍有不足，需要在今后的学习和实践中不断锤炼和提升。入党不是一时的目标，更不是荣誉的象征，而是一项需要长期践行的政治承诺。今后，我将以党员标准严格要求自己，持续用党的创新理论武装头11脑，在学习、科研和服务集体中主动担当，自觉接受党组织的教育、考察和监督，用实践来践行入党誓言。333'
[NativeEditorContext] 🖼️ 总共发现 0 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 290}: '145再次测试服务器刷新逻辑我是启明2401班的方博涵。进入大学以来，随着思想政治理论学习的系统推进和实践认识的不断深化，我对中国共产党的认识逐步由朴素认同转向理性1认同和自觉认同。中国共产党是中国工人阶级的先锋队，同时是中国各族人民利益的忠实代表，是实现中华民族伟大复兴的坚强领导核心。党的宗旨是全心全意为人民服务，百余年来，党始终坚持以人民为中心，团结带领中国人民不断推进革命、建设和改革事业1。通过学习习近平新时1代中1国特色社会主义思想，特别是对党的二十大和二十届四中全会精神的系统理解，我更加深刻地认识到，中国式现代化道路的成功推进，根本在于党的坚强领导和科学理论指引。'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {291, 306}: '大学阶段的学习和思考中，我开始更加自觉地将个人发展与国家前途、民族命运联系起来。通过对党的创新理论的深入学习，我逐步认识到产党之所以能够在复杂多变的2国内外环境中始终保持战略定力，关键在于其坚持真理、坚守初心，并不断推进自我革命。相较于以往更多停留在情感层面的认同，大学阶段的思想锻炼使我更加注重从理论逻辑、制度优势和实践成效相统一的角度理解党的领导。这一过程也不断促使我反思自身成长中的功利化倾1向，逐渐确立起将个人理想融入民族复兴进程的价值追求。作为计算机科学与技术专业的学生，我对国家强调科技自立自强、加快建设科技强国的战略部署有了更加深刻的理解，也更加坚定了将专业学习与国家需求相结合、以科技报国的志向。'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {598, 174}: '3在对待入党的态1度上，我始终保持严肃、慎重的立场。我清醒地认识到，自己在理论学习的系统性、联系群众的实践经验以及组织协调能力等方面仍有不足，需要在今后的学习和实践中不断锤炼和提升。入党不是一时的目标，更不是荣誉的象征，而是一项需要长期践行的政治承诺。今后，我将以党员标准严格要求自己，持续用党的创新理论武装头11脑，在学习、科研和服务集体中主动担'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {772, 4}: '当，自觉'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 14.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {776, 29}: '接受党组织的教育、考察和监督，用实践来践行入党誓言。333'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 884, 转换后文本长度: 805
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 884
[NativeEditorWrapper] 初始加载内容 - 长度: 884
[NativeEditorView] 更新内容 - 当前长度: 805, 新长度: 805, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=805, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=805, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 805, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=805, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {805, 0}
[UnifiedFormatManager] detectFormatState - position: 805, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 805, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 805
[NativeEditorContext]   - 光标位置: 805
[NativeEditorContext]   - 选中范围: location=805, length=0
[NativeEditorContext]   ✅ 有效位置: 804
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 803
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSColor", "NSParagraphStyle"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 移除LRU缓存 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[MemoryCache] 添加缓存 - ID: 47075179..., 标题: sjjx.ulearning.cnnewpc#login_47075179581817280, 当前缓存数: 10
[MemoryCache] 更新缓存 - ID: 48759929..., 标题: 最终稿
[MemoryCache] 更新缓存 - ID: 48966438..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48977865..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48976637..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48970847..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48966095..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48978154..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 48986921..., 标题: 新笔记
[预加载] 悬停预加载完成 - ID: 48986921...
[MemoryCache] 移除LRU缓存 - ID: 48969392..., 标题: 
[MemoryCache] 添加缓存 - ID: 49003902..., 标题: 未命名笔记_49003902292345696, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 47075179..., 标题: sjjx.ulearning.cnnewpc#login_47075179581817280
[MemoryCache] 添加缓存 - ID: 49005878..., 标题: 新笔记121, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48759929..., 标题: 最终稿
[MemoryCache] 添加缓存 - ID: 49006046..., 标题: 测ceshi, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48966438..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 49006032..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48977865..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 48978102..., 标题: 新笔记, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48976637..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 49006034..., 标题: ceshi, 当前缓存数: 10
[MemoryCache] 更新缓存 - ID: 48978102..., 标题: 新笔记
[MemoryCache] 更新缓存 - ID: 49006034..., 标题: ceshi
[MemoryCache] 移除LRU缓存 - ID: 48970847..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 48989118..., 标题: 111测试1
, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48966095..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 48989473..., 标题: 旧版格式测试, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 48978154..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 48716783..., 标题: 测试图片上, 当前缓存数: 10
[MemoryCache] 更新缓存 - ID: 48989473..., 标题: 旧版格式测试
[MemoryCache] 更新缓存 - ID: 48989118..., 标题: 111测试1

[MemoryCache] 更新缓存 - ID: 49006034..., 标题: ceshi
[MemoryCache] 更新缓存 - ID: 48989118..., 标题: 111测试1

[MemoryCache] 更新缓存 - ID: 48989473..., 标题: 旧版格式测试
[MemoryCache] 更新缓存 - ID: 48716783..., 标题: 测试图片上
[MemoryCache] 移除LRU缓存 - ID: 48986921..., 标题: 新笔记
[MemoryCache] 添加缓存 - ID: 49013776..., 标题: 112你哈, 当前缓存数: 10
[MemoryCache] 移除LRU缓存 - ID: 49003902..., 标题: 未命名笔记_49003902292345696
[MemoryCache] 添加缓存 - ID: 48969392..., 标题: 未命名笔记_48969392250438496, 当前缓存数: 10
[PinnedNoteRowContent] 点击笔记 - ID: 48969392..., 当前选中: 48759929, isSelected: false
[AudioPanelState] 处理笔记切换: nil -> 48969392250438496
[PinnedNoteRowContent] 设置 selectedNote 为 48969392...
[NotesListView] 📊 selectedNote 变化: 48759929 -> 48969392
[NotesListView] 🔄 选择 ID 变化，通知 coordinator
[笔记切换] 💾 保存当前笔记 - ID: 48759929..., 标题: 最终稿
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 884
[笔记切换] 📝 立即捕获原生编辑器内容 - 长度: 884
[笔记切换] ═══════════════════════════════════════
[笔记切换] 🔄 开始保存当前笔记
[笔记切换] 📝 从笔记ID: 48759929... 切换到: 48969392...
[笔记切换] 📝 捕获的标题: 最终稿
[笔记切换] 📝 原始标题: 最终稿
[笔记切换] 📏 捕获的内容长度: 884
[笔记切换] 📏 lastSavedXMLContent 长度: 884
[笔记切换] ═══════════════════════════════════════
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 884
[NativeEditorWrapper] xmlContent 变化（切换笔记）- 从长度 884 到 184
[ViewStateCoordinator] 状态已保存到 UserDefaults: folder=0, note=48969392250438496
[StateTransition] noteSelection: folder(0 -> 0), note(48759929648727328 -> 48969392250438496)
[ViewStateCoordinator] 笔记选择完成: 未命名笔记_48969392250438496
[笔记切换] 📝 后台保存内容 - 长度: 884
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 884 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.06ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.13ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.13ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 2.21ms
[XMLNormalizer] 📏 规范化后内容长度: 884 字符
[XMLNormalizer] ⏱️ 总耗时: 2.57ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[XMLNormalizer] 🚀 开始规范化 XML 内容
[XMLNormalizer] 📏 原始内容长度: 884 字符
[XMLNormalizer] ✅ 图片格式规范化完成，耗时: 0.03ms
[XMLNormalizer] ✅ 空格规范化完成，耗时: 0.12ms
[XMLNormalizer] ✅ 属性顺序规范化完成，耗时: 0.10ms
[XMLNormalizer] ✅ 属性值规范化完成，耗时: 2.21ms
[XMLNormalizer] 📏 规范化后内容长度: 884 字符
[XMLNormalizer] ⏱️ 总耗时: 2.50ms
[XMLNormalizer] ✅ 规范化完成，性能良好（< 10ms）
[内容检测] ═══════════════════════════════════════
[内容检测] 📊 检测结果: 内容变化=false, 标题变化=false
[内容检测] 📏 原始内容长度: 当前=884, 保存=884
[内容检测] 📏 规范化后长度: 当前=884, 保存=884
[内容检测] ⏱️ 检测耗时: 5.11ms
[内容检测] ✅ 内容无变化（规范化后相同）
[内容检测] ✅ 标题无变化
[内容检测] 🕐 时间戳决策: 保持不变
[内容检测] ═══════════════════════════════════════
[笔记切换] ⏭️ 内容无实际变化，跳过保存
[性能监控] ═══════════════════════════════════════
[性能监控] ⏱️ 笔记切换后台保存总耗时: 5.17ms
[性能监控] 📊 保存决策: 跳过保存
[性能监控] ✅ 后台保存性能正常
[性能监控] ═══════════════════════════════════════
[快速切换] 🔄 开始切换到笔记 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[笔记切换] ⏭️ 无需保存 - 无当前编辑笔记或笔记ID相同
[快速切换] 🔄 开始切换到笔记 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[保存状态] 🔄 笔记切换 - 重置为已保存
[快速切换] 📝 标题已更新: 
[快速切换] 📝 重置内容状态，lastSavedXMLContent 已清空
[MemoryCache] 缓存命中 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[MemoryCache] 缓存命中 - ID: 48969392..., 标题: 未命名笔记_48969392250438496
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 16
[NativeEditorContext]   - nsAttributed.string: '1
12
￼112
121212'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {5, 1}
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 23.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {2, 2}: '12'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 20.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {6, 3}: '112'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 6}: '121212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 184, 转换后文本长度: 16
[NativeEditorWrapper] 原生编辑器重新加载内容 - 长度: 184
[NativeEditorView] 更新内容 - 当前长度: 805, 新长度: 16, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 取消注册
[NativeEditorView] CursorFormatManager 已取消注册
[UnifiedFormatManager] 取消注册
[NativeEditorView] UnifiedFormatManager 已取消注册
[AttachmentSelectionManager] 已取消注册
[NativeEditorView] AttachmentSelectionManager 已取消注册
[快速切换] ✅ 内存缓存命中 - ID: 48969392...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 184
[快速切换] ✅ 从缓存加载完成 - ID: 48969392..., 标题: , 内容长度: 184
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48969392...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48969392...
[NativeEditorContext] 验证内容持久化，预期内容长度: 184
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 171
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 171
[持久化验证] 原生编辑器验证结果: 失败
[快速切换] ✅ 内存缓存命中 - ID: 48969392...
[快速切换] 📝 从缓存加载内容，lastSavedXMLContent 已同步 - 长度: 184
[快速切换] ✅ 从缓存加载完成 - ID: 48969392..., 标题: , 内容长度: 184
[持久化验证] 🔍 开始验证音频附件 - 笔记ID: 48969392...
[持久化验证] ℹ️ 无音频附件 - 笔记ID: 48969392...
[NativeEditorContext] 验证内容持久化，预期内容长度: 184
[NativeEditorContext] exportToXML: 成功导出 XML - 长度: 171
[NativeEditorContext] 内容持久化验证结果: 失败
[NativeEditorContext] 当前XML长度: 171
[持久化验证] 原生编辑器验证结果: 失败
<_TtGC7SwiftUI22AppKitPlatformViewHostGVS_P10$1cd16295432PlatformViewRepresentableAdaptorVS_18AppKitProgressView__: 0x9c7c08380> has an maximum length (32.083333) that doesn't satisfy min (32.083333) <= max (32.083333).
[NativeEditorView] 🔍 加载初始内容到 NSTextView
[NativeEditorView]   - 内容长度: 16
[NativeEditorView]   - 加载前 范围 {0, 1}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {2, 2}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载前 范围 {6, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载前 范围 {10, 6}: .AppleSystemUIFont, italic=false
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 错误: textView 或 textStorage 为 nil
[NativeEditorView]   - 加载后 范围 {0, 1}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {2, 2}: .AppleSystemUIFontBold, italic=false
[NativeEditorView]   - 加载后 范围 {6, 3}: .AppleSystemUIFont, italic=false
[NativeEditorView]   - 加载后 范围 {10, 6}: .AppleSystemUIFont, italic=false
[CustomRenderer] 缓存预热完成，当前缓存数量: 19
[CursorFormatManager] 注册编辑器组件
[NativeEditorView] CursorFormatManager 已注册
[UnifiedFormatManager] 注册编辑器组件
[NativeEditorView] UnifiedFormatManager 已注册
[AttachmentSelectionManager] 已注册 textView
[NativeEditorView] AttachmentSelectionManager 已注册
[NativeEditorView] 初始化完成，耗时: 1.89ms
[NativeEditorView] 更新内容 - 当前长度: 16, 新长度: 16, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 16
[NativeEditorContext]   - nsAttributed.string: '1
12
￼112
121212'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {5, 1}
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 0 个是 ImageAttachment
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 23.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {2, 2}: '12'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 20.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {6, 3}: '112'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 6}: '121212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 184, 转换后文本长度: 16
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 184
[NativeEditorContext] 🖼️ NSAttributedString 转换完成（直接转换）
[NativeEditorContext]   - nsAttributed.length: 16
[NativeEditorContext]   - nsAttributed.string: '1
12
￼112
121212'
[NativeEditorContext] 🖼️ 发现附件 1: OrderAttachment at range {5, 1}
[NativeEditorContext] 🖼️ 总共发现 1 个附件，其中 0 个是 ImageAttachment
[保存状态] 📝 内容变化 - 设置为未保存
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
[NativeEditorContext] 🔍 loadFromXML 完成后检查字体属性:
[NativeEditorContext]   - 范围 {0, 1}: '1'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 23.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {2, 2}: '12'
[NativeEditorContext]     字体: .AppleSystemUIFontBold, 大小: 20.0
[NativeEditorContext]     特性: bold=true, italic=false
[NativeEditorContext]   - 范围 {6, 3}: '112'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext]   - 范围 {10, 6}: '121212'
[NativeEditorContext]     字体: .AppleSystemUIFont, 大小: 14.0
[NativeEditorContext]     特性: bold=false, italic=false
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = false
[NativeEditorContext] ✅ 加载 XML 成功 - 长度: 184, 转换后文本长度: 16
[NativeEditorWrapper] 原生编辑器加载内容 - 长度: 184
[NativeEditorWrapper] 初始加载内容 - 长度: 184
[NativeEditorView] 更新内容 - 当前长度: 16, 新长度: 16, 版本变化: true
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 保存状态变化: hasUnsavedChanges = true
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] setSelectedRange 被调用: location=16, length=0
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[NativeEditorContext] 内容变化检测 - 长度: 16, hasUnsavedChanges: true
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
Publishing changes from within view updates is not allowed, this will cause undefined behavior.
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[NativeTextView] 通知 AttachmentSelectionManager
[AttachmentSelectionManager] 处理选择变化: location=16, length=0
[AttachmentSelectionManager] 未检测到附件
[AttachmentSelectionManager] 已显示光标
[保存状态] 📝 内容变化 - 设置为未保存
[CursorFormatManager] 执行更新 - range: {16, 0}
[UnifiedFormatManager] detectFormatState - position: 16, state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 使用 UnifiedFormatManager 检测格式状态
[CursorFormatManager] 同步 typingAttributes
[CursorFormatManager] typingAttributes 已更新，属性数量: 2
[CursorFormatManager] 更新工具栏状态
[CursorFormatManager] 工具栏状态已更新，激活格式: []
[CursorFormatManager] 通知 FormatStateManager - state: FormatState(段落: 正文, 对齐: 左对齐)
[CursorFormatManager] 已触发 NativeFormatProvider 状态更新
[CursorFormatManager] 光标模式更新完成 - position: 16, state: FormatState(段落: 正文, 对齐: 左对齐)
[NativeEditorContext] ========================================
[NativeEditorContext] 🔄 开始更新当前格式状态
[NativeEditorContext] ========================================
[NativeEditorContext]   - 文本长度: 16
[NativeEditorContext]   - 光标位置: 16
[NativeEditorContext]   - 选中范围: location=16, length=0
[NativeEditorContext]   ✅ 有效位置: 15
[NativeEditorContext]   📍 光标模式（未选中文本）
[NativeEditorContext]   💡 光标模式：使用前一个字符的属性位置: 14
[NativeEditorContext]   📦 获取到 3 个属性
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 🔍 开始检测各类格式...
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始检测字体格式 ==========
[NativeEditorContext] detectFontFormats - 属性键: ["NSFont", "NSParagraphStyle", "NSColor"]
[NativeEditorContext] 📏 字体信息:
[NativeEditorContext]   - 字体名称: .AppleSystemUIFont
[NativeEditorContext]   - 字体大小: 14.0pt
[NativeEditorContext]   - 字体特性: bold=false, italic=false
[NativeEditorContext] 🔍 通过字体大小判断标题类型
[NativeEditorContext]   当前阈值: 大标题>=23.0pt, 二级标题>=20.0pt, 三级标题>=17.0pt
[NativeEditorContext] ✅ 字体大小 14.0pt < 17.0pt，识别为【正文】（不添加标题格式）
[NativeEditorContext] ========== 检测结束，最终格式: [] ==========
[NativeEditorContext]   ✅ 字体格式检测完成: []
[NativeEditorContext]   ✅ 装饰格式检测完成: []
[NativeEditorContext]   ✅ 段落格式检测完成: []
[NativeEditorContext]   ✅ 列表格式检测完成: []
[NativeEditorContext]   ✅ 特殊格式检测完成: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] 📊 最终检测到的所有格式: []
[NativeEditorContext] ----------------------------------------
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========== 开始转换格式为段落样式 ==========
[NativeEditorContext] 输入格式集合: []
[NativeEditorContext] ✅ 没有检测到任何块级格式，返回默认段落样式: 【body】(正文)
[NativeEditorContext] ========== 段落样式转换完成: body ==========
[NativeEditorContext] ========================================
[NativeEditorContext] ✅ 格式状态更新完成
[NativeEditorContext] ========================================
[MemoryCache] 更新缓存 - ID: 49013776..., 标题: 112你哈
[VIEWMODEL] 应用变为后台
[VIEWMODEL] 停止自动同步定时器