{
  "info": {
    "name": "小米笔记 API 测试集合",
    "description": "小米笔记 macOS 客户端 API 测试集合，基于 MiNoteService.swift 中的 API 端点",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "auth": {
    "type": "noauth"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// 设置时间戳",
          "pm.globals.set('timestamp', Date.now());"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://i.mi.com",
      "type": "string"
    },
    {
      "key": "serviceToken",
      "value": "请在此处填入有效的 serviceToken",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "1315204657",
      "type": "string"
    },
    {
      "key": "testNoteId",
      "value": "48926433520534752",
      "type": "string",
      "description": "测试用笔记 ID"
    },
    {
      "key": "testFolderId",
      "value": "0",
      "type": "string",
      "description": "测试用文件夹 ID（0 表示根目录）"
    }
  ],
  "item": [
    {
      "name": "1. 笔记列表和同步",
      "item": [
        {
          "name": "获取笔记列表（分页）",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/note/full/page?ts={{timestamp}}&limit=200&syncTag=",
              "host": ["{{baseUrl}}"],
              "path": ["note", "full", "page"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}",
                  "description": "时间戳（毫秒）"
                },
                {
                  "key": "limit",
                  "value": "200",
                  "description": "每页数量"
                },
                {
                  "key": "syncTag",
                  "value": "",
                  "description": "同步标签，用于增量同步"
                }
              ]
            },
            "description": "获取笔记和文件夹列表，支持增量同步"
          },
          "response": []
        },
        {
          "name": "获取私密笔记列表",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/note/full/folder?ts={{timestamp}}&limit=200&folderId=2",
              "host": ["{{baseUrl}}"],
              "path": ["note", "full", "folder"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                },
                {
                  "key": "limit",
                  "value": "200"
                },
                {
                  "key": "folderId",
                  "value": "2",
                  "description": "私密笔记文件夹 ID"
                }
              ]
            },
            "description": "获取私密笔记列表"
          },
          "response": []
        }
      ]
    },
    {
      "name": "2. 笔记操作",
      "item": [
        {
          "name": "获取笔记详情",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/note/note/{{testNoteId}}/?ts={{timestamp}}",
              "host": ["{{baseUrl}}"],
              "path": ["note", "note", "{{testNoteId}}", ""],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                }
              ]
            },
            "description": "获取指定笔记的详细内容"
          },
          "response": []
        },
        {
          "name": "创建新笔记",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "entry",
                  "value": "{\"id\":\"0\",\"folderId\":\"{{testFolderId}}\",\"subject\":\"测试笔记\",\"content\":\"<text indent=\\\"1\\\">测试内容</text>\",\"createDate\":{{timestamp}},\"modifyDate\":{{timestamp}},\"extraInfo\":\"{}\"}",
                  "type": "text",
                  "description": "笔记数据 JSON"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/note",
              "host": ["{{baseUrl}}"],
              "path": ["note", "note"]
            },
            "description": "创建新笔记"
          },
          "response": []
        },
        {
          "name": "更新笔记",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "entry",
                  "value": "{\"id\":\"{{testNoteId}}\",\"folderId\":\"{{testFolderId}}\",\"subject\":\"更新的标题\",\"content\":\"<text indent=\\\"1\\\">更新的内容</text>\",\"tag\":\"\",\"createDate\":{{timestamp}},\"modifyDate\":{{timestamp}},\"extraInfo\":\"{}\"}",
                  "type": "text"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/note/{{testNoteId}}",
              "host": ["{{baseUrl}}"],
              "path": ["note", "note", "{{testNoteId}}"]
            },
            "description": "更新现有笔记"
          },
          "response": []
        },
        {
          "name": "删除笔记",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "tag",
                  "value": "",
                  "type": "text",
                  "description": "笔记的 tag 值"
                },
                {
                  "key": "purge",
                  "value": "false",
                  "type": "text",
                  "description": "是否彻底删除"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/full/{{testNoteId}}/delete",
              "host": ["{{baseUrl}}"],
              "path": ["note", "full", "{{testNoteId}}", "delete"]
            },
            "description": "删除笔记（移到回收站或彻底删除）"
          },
          "response": []
        }
      ]
    },
    {
      "name": "3. 文件夹操作",
      "item": [
        {
          "name": "创建文件夹",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "entry",
                  "value": "{\"id\":\"0\",\"subject\":\"测试文件夹\",\"createDate\":{{timestamp}},\"modifyDate\":{{timestamp}}}",
                  "type": "text"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/folder",
              "host": ["{{baseUrl}}"],
              "path": ["note", "folder"]
            },
            "description": "创建新文件夹"
          },
          "response": []
        },
        {
          "name": "更新文件夹",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "entry",
                  "value": "{\"id\":\"{{testFolderId}}\",\"subject\":\"更新的文件夹名\",\"tag\":\"\",\"createDate\":{{timestamp}},\"modifyDate\":{{timestamp}}}",
                  "type": "text"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/folder/{{testFolderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["note", "folder", "{{testFolderId}}"]
            },
            "description": "更新文件夹名称"
          },
          "response": []
        },
        {
          "name": "删除文件夹",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "tag",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "purge",
                  "value": "false",
                  "type": "text"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/full/{{testFolderId}}/delete",
              "host": ["{{baseUrl}}"],
              "path": ["note", "full", "{{testFolderId}}", "delete"]
            },
            "description": "删除文件夹"
          },
          "response": []
        }
      ]
    },
    {
      "name": "4. 历史版本",
      "item": [
        {
          "name": "获取笔记历史版本列表",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/note/full/history/times?ts={{timestamp}}&noteId={{testNoteId}}",
              "host": ["{{baseUrl}}"],
              "path": ["note", "full", "history", "times"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                },
                {
                  "key": "noteId",
                  "value": "{{testNoteId}}"
                }
              ]
            },
            "description": "获取笔记的所有历史版本时间戳"
          },
          "response": []
        },
        {
          "name": "获取指定历史版本内容",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/note/full/history?ts={{timestamp}}&noteId={{testNoteId}}&version=0",
              "host": ["{{baseUrl}}"],
              "path": ["note", "full", "history"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                },
                {
                  "key": "noteId",
                  "value": "{{testNoteId}}"
                },
                {
                  "key": "version",
                  "value": "0",
                  "description": "历史版本时间戳"
                }
              ]
            },
            "description": "获取指定历史版本的笔记内容"
          },
          "response": []
        },
        {
          "name": "恢复历史版本",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "version",
                  "value": "0",
                  "type": "text",
                  "description": "要恢复的版本时间戳"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/note/note/{{testNoteId}}/history",
              "host": ["{{baseUrl}}"],
              "path": ["note", "note", "{{testNoteId}}", "history"]
            },
            "description": "恢复笔记到指定历史版本"
          },
          "response": []
        }
      ]
    },
    {
      "name": "5. 文件操作",
      "item": [
        {
          "name": "下载文件（图片/音频）",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/file/full?type=note_img&fileid=1315204657.jgHyouv563iSF_XCE4jhAg&ts={{timestamp}}",
              "host": ["{{baseUrl}}"],
              "path": ["file", "full"],
              "query": [
                {
                  "key": "type",
                  "value": "note_img",
                  "description": "文件类型：note_img（图片和音频都用这个）"
                },
                {
                  "key": "fileid",
                  "value": "1315204657.jgHyouv563iSF_XCE4jhAg",
                  "description": "文件 ID"
                },
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                }
              ]
            },
            "description": "下载图片或音频文件"
          },
          "response": []
        },
        {
          "name": "请求文件上传（第一步）",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "data",
                  "value": "{\"type\":\"note_img\",\"fileName\":\"test.jpg\",\"fileSize\":1024,\"sha1\":\"abc123\",\"md5\":\"def456\",\"mimeType\":\"image/jpeg\"}",
                  "type": "text"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/file/v2/user/request_upload_file",
              "host": ["{{baseUrl}}"],
              "path": ["file", "v2", "user", "request_upload_file"]
            },
            "description": "请求文件上传，获取上传 URL 和 uploadId"
          },
          "response": []
        },
        {
          "name": "提交文件上传（第三步）",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded; charset=UTF-8"
              },
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "data",
                  "value": "{\"uploadId\":\"xxx\",\"fileSize\":1024,\"sha1\":\"abc123\",\"fileMeta\":\"{}\",\"commitMeta\":\"{}\"}",
                  "type": "text"
                },
                {
                  "key": "serviceToken",
                  "value": "{{serviceToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/file/v2/user/commit",
              "host": ["{{baseUrl}}"],
              "path": ["file", "v2", "user", "commit"]
            },
            "description": "提交文件上传，完成上传流程"
          },
          "response": []
        },
        {
          "name": "获取文件上传 URL",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/file/full/v2?ts={{timestamp}}&type=note_img&fileid=1315204657.test",
              "host": ["{{baseUrl}}"],
              "path": ["file", "full", "v2"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                },
                {
                  "key": "type",
                  "value": "note_img"
                },
                {
                  "key": "fileid",
                  "value": "1315204657.test"
                }
              ]
            },
            "description": "获取文件的上传/下载 URL"
          },
          "response": []
        }
      ]
    },
    {
      "name": "6. 用户信息",
      "item": [
        {
          "name": "获取用户资料",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/status/lite/profile?ts={{timestamp}}",
              "host": ["{{baseUrl}}"],
              "path": ["status", "lite", "profile"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                }
              ]
            },
            "description": "获取当前用户的基本信息"
          },
          "response": []
        },
        {
          "name": "获取存储空间详情",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Cookie",
                "value": "serviceToken={{serviceToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/status/lite/alldetail?ts={{timestamp}}",
              "host": ["{{baseUrl}}"],
              "path": ["status", "lite", "alldetail"],
              "query": [
                {
                  "key": "ts",
                  "value": "{{timestamp}}"
                }
              ]
            },
            "description": "获取云空间使用详情"
          },
          "response": []
        }
      ]
    }
  ]
}
