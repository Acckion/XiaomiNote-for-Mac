<!DOCTYPE html>
<html>
<head>
    <title>测试图片解析</title>
    <script src="Sources/MiNoteLibrary/Web/xml-to-html.js"></script>
    <script src="Sources/MiNoteLibrary/Web/html-to-xml.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .input { background: #f0f0f0; padding: 10px; margin: 5px 0; }
        .output { background: #e0ffe0; padding: 10px; margin: 5px 0; }
        .error { background: #ffe0e0; padding: 10px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>测试小米笔记图片格式解析</h1>
    
    <div class="test-case">
        <h2>测试1: 格式1 (☺ 格式)</h2>
        <div class="input">
            <strong>输入XML:</strong><br>
            <code>☺ 1315204657.bsdv_GVbvnWDW50jmD3Xmg<0/><\/></code>
        </div>
        <div id="test1-output" class="output">
            等待测试...
        </div>
    </div>
    
    <div class="test-case">
        <h2>测试2: 格式2 (img标签格式)</h2>
        <div class="input">
            <strong>输入XML:</strong><br>
            <code><img fileid="1315204657.VIPdLGYl2LBbqzOIsAjQcA" imgshow="0" imgdes="111111" /></code>
        </div>
        <div id="test2-output" class="output">
            等待测试...
        </div>
    </div>
    
    <div class="test-case">
        <h2>测试3: 双向转换 (XML → HTML → XML)</h2>
        <div class="input">
            <strong>输入XML (格式1):</strong><br>
            <code>☺ 1315204657.bsdv_GVbvnWDW50jmD3Xmg<0/><\/></code>
        </div>
        <div id="test3-output" class="output">
            等待测试...
        </div>
    </div>
    
    <script>
        // 等待页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const xmlToHtmlConverter = new XMLToHTMLConverter();
                const htmlToXmlConverter = new HTMLToXMLConverter();
                
                // 测试1: 格式1
                const format1XML = '☺ 1315204657.bsdv_GVbvnWDW50jmD3Xmg<0/><\/>';
                const format1HTML = xmlToHtmlConverter.convert(format1XML);
                document.getElementById('test1-output').innerHTML = 
                    `<strong>输出HTML:</strong><br><code>${escapeHTML(format1HTML)}</code>`;
                
                // 测试2: 格式2
                const format2XML = '<img fileid="1315204657.VIPdLGYl2LBbqzOIsAjQcA" imgshow="0" imgdes="111111" />';
                const format2HTML = xmlToHtmlConverter.convert(format2XML);
                document.getElementById('test2-output').innerHTML = 
                    `<strong>输出HTML:</strong><br><code>${escapeHTML(format2HTML)}</code>`;
                
                // 测试3: 双向转换
                const roundTripHTML = xmlToHtmlConverter.convert(format1XML);
                const roundTripXML = htmlToXmlConverter.convert(roundTripHTML);
                document.getElementById('test3-output').innerHTML = 
                    `<strong>中间HTML:</strong><br><code>${escapeHTML(roundTripHTML)}</code><br><br>` +
                    `<strong>输出XML (应该为格式2):</strong><br><code>${escapeHTML(roundTripXML)}</code>`;
                    
            } catch (error) {
                document.body.innerHTML = `<div class="error">错误: ${error.message}<br>${error.stack}</div>`;
            }
        });
        
        function escapeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
