# 新架构测试Bug修复 - 任务列表

## 任务概览

- [x] 1. 修复笔记历史预览
- [x] 2. 修复回收站预览
- [x] 3. 添加回收站操作按钮
- [x] 4. 验证排序功能
- [x] 5. 测试和验证

---

## 1. 修复笔记历史预览

### 1.1 添加 NativeEditorView 只读模式支持
- [ ] 1.1.1 在 NativeEditorView 中添加 `isReadOnly` 参数
- [ ] 1.1.2 实现只读模式下的交互禁用
- [ ] 1.1.3 添加只读模式的视觉提示(降低透明度)
- [ ] 1.1.4 测试只读模式功能

### 1.2 修改 NoteHistoryView 使用原生编辑器
- [ ] 1.2.1 查找 NoteHistoryView 文件位置
- [ ] 1.2.2 移除 XMLToHTMLConverter 相关代码
- [ ] 1.2.3 使用 NativeEditorView 替代 WKWebView
- [ ] 1.2.4 设置为只读模式
- [ ] 1.2.5 添加加载状态指示器
- [ ] 1.2.6 添加错误处理
- [ ] 1.2.7 测试历史版本预览功能

### 1.3 测试历史版本恢复功能
- [ ] 1.3.1 测试恢复历史版本
- [ ] 1.3.2 验证恢复后内容正确
- [ ] 1.3.3 验证恢复后格式正确

---

## 2. 修复回收站预览

### 2.1 修改 DeletedNotesView 使用原生编辑器
- [ ] 2.1.1 查找 DeletedNotesView 文件位置
- [ ] 2.1.2 移除 XMLToHTMLConverter 相关代码
- [ ] 2.1.3 使用 NativeEditorView 替代 WKWebView
- [ ] 2.1.4 设置为只读模式
- [ ] 2.1.5 添加加载状态指示器
- [ ] 2.1.6 添加错误处理
- [ ] 2.1.7 测试回收站预览功能

---

## 3. 添加回收站操作按钮

### 3.1 设计UI布局
- [ ] 3.1.1 设计操作按钮位置
- [ ] 3.1.2 设计按钮样式
- [ ] 3.1.3 设计确认对话框

### 3.2 实现恢复功能
- [ ] 3.2.1 在 DeletedNotesView 中添加"恢复"按钮
- [ ] 3.2.2 添加恢复确认对话框
- [ ] 3.2.3 在 NotesViewModel/NotesViewModelAdapter 中实现 `restoreDeletedNote` 方法
- [ ] 3.2.4 在 MiNoteService 中实现 `restoreNote` API调用
- [ ] 3.2.5 测试恢复功能
- [ ] 3.2.6 验证恢复后笔记列表更新

### 3.3 实现永久删除功能
- [ ] 3.3.1 在 DeletedNotesView 中添加"永久删除"按钮
- [ ] 3.3.2 添加永久删除确认对话框(二次确认)
- [ ] 3.3.3 在 NotesViewModel/NotesViewModelAdapter 中实现 `permanentlyDeleteNote` 方法
- [ ] 3.3.4 在 MiNoteService 中实现 `permanentlyDeleteNote` API调用
- [ ] 3.3.5 测试永久删除功能
- [ ] 3.3.6 验证删除后回收站列表更新

---

## 4. 验证排序功能

### 4.1 验证排序逻辑
- [ ] 4.1.1 检查 NotesListView 中的 `groupNotesByDate` 方法
- [ ] 4.1.2 验证按创建时间排序逻辑
- [ ] 4.1.3 验证按编辑时间排序逻辑
- [ ] 4.1.4 验证按标题排序逻辑

### 4.2 验证UI显示
- [ ] 4.2.1 验证排序菜单状态显示
- [ ] 4.2.2 验证笔记列表排序结果
- [ ] 4.2.3 验证日期分组与排序的配合

### 4.3 修复发现的问题
- [ ] 4.3.1 记录发现的问题
- [ ] 4.3.2 修复问题
- [ ] 4.3.3 重新测试

---

## 5. 测试和验证

### 5.1 单元测试
- [ ] 5.1.1 编写历史版本预览测试
- [ ] 5.1.2 编写回收站预览测试
- [ ] 5.1.3 编写恢复功能测试
- [ ] 5.1.4 编写永久删除功能测试
- [ ] 5.1.5 编写排序功能测试
- [ ] 5.1.6 运行所有单元测试

### 5.2 集成测试
- [ ] 5.2.1 编写历史版本工作流集成测试
- [ ] 5.2.2 编写回收站工作流集成测试
- [ ] 5.2.3 编写排序功能集成测试
- [ ] 5.2.4 运行所有集成测试

### 5.3 手动测试
- [ ] 5.3.1 按照 MANUAL_TEST_GUIDE.md 测试7 - 笔记历史
- [ ] 5.3.2 按照 MANUAL_TEST_GUIDE.md 测试8 - 回收站
- [ ] 5.3.3 按照 MANUAL_TEST_GUIDE.md 测试2 - 笔记排序
- [ ] 5.3.4 验证所有bug已修复
- [ ] 5.3.5 验证不影响其他功能

### 5.4 性能测试
- [ ] 5.4.1 测试历史版本预览加载时间
- [ ] 5.4.2 测试回收站预览加载时间
- [ ] 5.4.3 测试排序性能
- [ ] 5.4.4 优化性能问题

### 5.5 文档更新
- [ ] 5.5.1 更新 MANUAL_TEST_GUIDE.md
- [ ] 5.5.2 更新 Phase7.3-进度总结.md
- [ ] 5.5.3 更新相关代码注释

### 5.6 代码审查和提交
- [ ] 5.6.1 代码自审
- [ ] 5.6.2 提交代码
- [ ] 5.6.3 更新任务状态

---

## 任务优先级

### P0 (最高优先级)
- 1.2 修改 NoteHistoryView 使用原生编辑器
- 2.1 修改 DeletedNotesView 使用原生编辑器
- 3.2 实现恢复功能
- 3.3 实现永久删除功能

### P1 (高优先级)
- 1.1 添加 NativeEditorView 只读模式支持
- 4.1 验证排序逻辑
- 5.3 手动测试

### P2 (中优先级)
- 4.2 验证UI显示
- 5.1 单元测试
- 5.2 集成测试

### P3 (低优先级)
- 5.4 性能测试
- 5.5 文档更新

---

## 预计工作量

- **任务1**: 2小时
- **任务2**: 1小时
- **任务3**: 2小时
- **任务4**: 30分钟
- **任务5**: 1.5小时

**总计**: 约7小时

---

## 依赖关系

```
1.1 (NativeEditorView只读模式)
  ↓
1.2 (NoteHistoryView修改) ← 依赖 1.1
  ↓
2.1 (DeletedNotesView修改) ← 依赖 1.1
  ↓
3.2 (恢复功能) ← 依赖 2.1
  ↓
3.3 (永久删除功能) ← 依赖 2.1
  ↓
4.1-4.3 (排序验证) ← 可并行
  ↓
5.1-5.6 (测试和验证) ← 依赖所有前置任务
```

---

## 风险和注意事项

### 风险1: 原生编辑器兼容性
- **描述**: 原生编辑器可能不支持某些历史版本格式
- **缓解**: 添加格式检测和降级处理
- **负责任务**: 1.2, 2.1

### 风险2: API调用失败
- **描述**: 恢复和永久删除API可能失败
- **缓解**: 添加错误处理和重试机制
- **负责任务**: 3.2, 3.3

### 风险3: 数据丢失
- **描述**: 永久删除操作不可逆
- **缓解**: 添加二次确认对话框
- **负责任务**: 3.3

---

## 完成标准

- [ ] 所有任务完成
- [ ] 所有测试通过
- [ ] 手动测试确认bug已修复
- [ ] 代码审查通过
- [ ] 文档更新完成
- [ ] 性能满足要求
